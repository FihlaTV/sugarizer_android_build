/*! Sugarizer 2017-08-25 */
function sorted(a){var b=[];for(var c in a)b.push(a[c]);return b.sort(function(a,b){return a.name==b.name?0:a.name>b.name?1:-1}),b}enyo.kind({name:"Sugar.DesktopListView",kind:"Scroller",published:{activities:[]},components:[{name:"nomatch",classes:"listview-nomatch",showing:!1},{name:"message",classes:"listview-message",showing:!1},{name:"nofilter",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"dialog-cancel.svg"},classes:"listview-button",ontap:"nofilter",showing:!1},{name:"activityPopup",kind:"Sugar.Popup",showing:!1},{name:"activityList",classes:"activity-list",kind:"Repeater",onSetupItem:"setupItem",onresize:"computeSize",components:[{name:"item",classes:"activity-list-item",components:[{name:"favorite",kind:"Sugar.Icon",x:10,y:14,size:constant.iconSizeFavorite,ontap:"doSwitchFavorite"},{name:"activity",kind:"Sugar.Icon",x:60,y:5,size:constant.iconSizeList,ontap:"doRunNewActivity"},{name:"name",classes:"activity-name"},{name:"version",classes:"activity-version"}]}]}],handlers:{onScroll:"onscroll"},create:function(){if(this.inherited(arguments),this.realLength=0,window.sugarizerOS){var a=this;sugarizerOS.initActivitiesPreferences(function(){a.activitiesChanged(),a.computeSize(),a.draw()})}else this.activitiesChanged(),this.computeSize(),this.draw()},computeSize:function(){var a=(document.getElementById("toolbar"),document.getElementById("canvas")),b=a.offsetHeight;this.applyStyle("height",b+"px")},getToolbar:function(){return app.getToolbar()},draw:function(){var a=util.getCanvasCenter();this.$.nomatch.applyStyle("margin-left",a.x-constant.sizeEmpty/4+"px");var b=a.y-constant.sizeEmpty/4;this.$.nomatch.applyStyle("margin-top",b+"px"),this.$.message.setContent(l10n.get("NoMatchingActivities")),this.$.nofilter.setText(l10n.get("ClearSearch"))},activitiesChanged:function(){var a=0==app.getToolbar().getSearchText().length,b=a&&this.activities.length>constant.listInitCount?constant.listInitCount:this.activities.length;this.realLength=this.activities.length,this.$.activityList.set("count",b,!0),0==this.activities.length?(this.$.nomatch.show(),this.$.message.show(),this.$.nofilter.show()):(this.$.nomatch.hide(),this.$.message.hide(),this.$.nofilter.hide())},setupItem:function(a,b){var c=sorted(this.activities);"undefined"!==c[b.index].type&&"native"==c[b.index].type&&(c[b.index].isNative=!0),0==b.index&&tutorial.setElement("favoriteitembutton",b.item.$.favorite.getAttribute("id")),b.item.$.activity.setIcon(c[b.index]),b.item.$.activity.setPopupShow(enyo.bind(this,"showActivityPopup")),b.item.$.activity.setPopupHide(enyo.bind(this,"hideActivityPopup")),b.item.$.favorite.setIcon({directory:"icons",icon:"emblem-favorite.svg"}),b.item.$.favorite.setColorized(c[b.index].favorite),b.item.$.name.setContent(c[b.index].name),b.item.$.version.setContent(l10n.get("VersionNumber",{number:c[b.index].version})),"rtl"==l10n.language.direction&&(b.item.$.name.addClass("rtl-14"),b.item.$.version.addClass("rtl-14"))},onscroll:function(a,b){var c=b.scrollBounds,d=this.$.activityList.get("count");if(0==app.getToolbar().getSearchText().length&&c&&c.maxTop-c.top<constant.listScrollLimit&&this.realLength>d){var e=Math.min(d+constant.listStepCount,this.activities.length);humane.log(l10n.get("Loading")),this.$.activityList.set("count",e,!0)}},doSwitchFavorite:function(a,b){var c=sorted(this.activities);this.switchFavorite(b.dispatchTarget.container,c[b.index])},switchFavorite:function(a,b){util.vibrate(),a.setColorized(preferences.switchFavoriteActivity(b)),a.container.render(),preferences.save(),preferences.saveToServer(myserver),this.getToolbar().askRedraw(),this.$.activityPopup.hidePopup()},doRunNewActivity:function(a,b){var c=sorted(this.activities);this.runNewActivity(c[b.index])},runNewActivity:function(a){util.vibrate(),this.$.activityPopup.hidePopup(),preferences.runActivity(a,null)},showActivityPopup:function(a){var b=a.icon;this.$.activityPopup.setHeader({icon:b,colorized:!0,name:b.name,title:null,action:null});var c=[];c.push({icon:a.parent.container.$.favorite.icon,colorized:!b.favorite,name:b.favorite?l10n.get("RemoveFavorite"):l10n.get("MakeFavorite"),action:enyo.bind(this,"switchFavorite"),data:[a.parent.container.$.favorite,a.icon]}),c.push({icon:b,colorized:!1,name:l10n.get("StartNew"),action:enyo.bind(this,"runNewActivity"),data:[b,null]}),this.$.activityPopup.setFooter(c),this.$.activityPopup.setMargin({left:0,top:60*a.owner.index+20-mouse.position.y}),this.$.activityPopup.showPopup()},hideActivityPopup:function(a){return!this.$.activityPopup.cursorIsInside()&&!a.cursorIsInside()&&(this.$.activityPopup.hidePopup(),!0)},nofilter:function(){app.getToolbar().setSearchText(""),app.filterActivities()}});