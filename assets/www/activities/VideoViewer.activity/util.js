/*! Sugarizer 2016-12-28 */
Util={};var app;Util.context={filter:{category:"",text:"",favorite:!1},libraries:constant.libraries,library:null,favorites:{},readtimes:{},currentindex:0},Util.saveContext=function(){if(!Util.onSugar()&&app&&app.activity){var a=app.activity.getDatastoreObject(),b=JSON.stringify(Util.context);a.setDataAsText(b),a.save(function(){})}},Util.loadContext=function(a,b){if(Util.onSugar())Util.context=b,app.loadDatabase(),app.hideLibraries();else{var c=app.activity.getDatastoreObject();app.showLibraries(),c.loadAsText(function(b,c,d){var e=JSON.parse(d);e&&(Util.context=e,app.loadDatabase(),app.hideLibraries()),a()})}},Util.setFilter=function(a){void 0!==a.favorite&&(Util.context.filter.favorite=a.favorite),void 0!==a.category&&(Util.context.filter.category=a.category),void 0!==a.text&&(Util.context.filter.text=a.text),app.filterChanged()},Util.getFilter=function(){return Util.context.filter},Util.getCollection=function(){for(var a=Util.database,b=[],c=0;c<a.length;c++)Util.context.filter.favorite&&!Util.getFavorite(a[c].id)||Util.context.filter.category.length>0&&a[c].category!=Util.context.filter.category||Util.context.filter.text.length>0&&a[c].title.toLowerCase().indexOf(Util.context.filter.text.toLowerCase())==-1||b.push(a[c]);return b},Util.setFavorite=function(a,b){b?Util.context.favorites[a]=b:Util.context.favorites[a]=void 0},Util.getFavorite=function(a){return Util.context.favorites[a]},Util.setReadTime=function(a,b){b?Util.context.readtimes[a]=b:Util.context.readtimes[a]=void 0},Util.getReadTime=function(a){return Util.context.readtimes[a]},Util.database=[],Util.categories=[],Util.loadDatabase=function(a,b){null!=Util.context.library&&Util.getLanguage(function(c){var d=new enyo.Ajax({url:Util.context.library.database.replace(new RegExp("%language%","g"),c),method:"GET",handleAs:"json"});d.response(function(b,c){Util.database=c,Util.categories=[];for(var d=0;d<c.length;d++){var e=c[d].category;if(void 0!==e){for(var f=!1,g=0;!f&&g<Util.categories.length;g++)e==Util.categories[g].id&&(f=!0);f||Util.categories.push({id:e,title:e})}}app.getFilter().setCategories(Util.categories),a(c)}),d.error(b),d.go()})},Util.getDatabase=function(){return Util.database},Util.getVideos=function(){return Util.context.library.videos},Util.getImages=function(){return Util.context.library.images},Util.setIndex=function(a){Util.context.currentindex=a},Util.getIndex=function(){return Util.context.currentindex},Util.setLibrary=function(a){Util.context.library=a},Util.getLibrary=function(){return Util.context.library},Util.addLibrary=function(a){Util.context.libraries.push(a)},Util.removeLibrary=function(a){if(Util.context.library!=a&&1!=Util.context.libraries.length){for(var b=[],c=0;c<Util.context.libraries.length;c++)Util.context.libraries[c]!=a&&b.push(Util.context.libraries[c]);Util.context.libraries=b}},Util.onSugar=function(){var a=function(a){var b=RegExp("[?&]"+a+"=([^&]*)").exec(window.location.search);return b&&decodeURIComponent(b[1].replace(/\+/g," "))};return a("onsugar")},Util.getLanguage=function(a){return Util.onSugar()?void a(navigator.language):void("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.storage.local.get("sugar_settings",function(b){a(JSON.parse(b.sugar_settings).language)}):a(JSON.parse(localStorage.sugar_settings).language))};