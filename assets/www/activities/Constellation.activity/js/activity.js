/*! Sugarizer 2019-09-21 */
define(["sugar-web/activity/activity","sugar-web/env","worldpalette","viewpalette","webL10n"],function(a,b,c,d,e){requirejs(["domReady!"],function(f){a.setup();var g,h=document.getElementById("canvas");a.getXOColor(function(a,b){g=b}),h.style.backgroundColor=g.fill;var i=a.getDatastoreObject(),j=document.getElementById("world-button"),k=(new c.ActivityPalette(j,i),document.getElementById("view-button"));new d.ActivityPalette(k,i);$(document).ready(function(){function c(){document.getElementById("add-button").title=e.get("AddDay"),document.getElementById("minus-button").title=e.get("MinusDay"),document.getElementById("const-button").title=e.get("ToggleConst"),document.getElementById("star-button").title=e.get("ToggleStar"),document.getElementById("location-button").title=e.get("Location"),document.getElementById("world-button").title=e.get("WorldList"),document.getElementById("view-button").title=e.get("View"),document.getElementById("55.3781,-3.4360").innerHTML=e.get("Britain"),document.getElementById("23.6345,-102.5528").innerHTML=e.get("Mexico"),document.getElementById("40.4637,-3.7492").innerHTML=e.get("Spain"),document.getElementById("51.1657,10.4515").innerHTML=e.get("Germany"),document.getElementById("40.3399,127.5101").innerHTML=e.get("NorthKorea"),document.getElementById("23.8859,45.0792").innerHTML=e.get("SaudiArabia"),document.getElementById("35.9078,127.7669").innerHTML=e.get("SouthKorea"),document.getElementById("46.2276,2.2137").innerHTML=e.get("France"),document.getElementById("51.9194,19.1451").innerHTML=e.get("Poland"),document.getElementById("41.8719,12.5674").innerHTML=e.get("Italy"),document.getElementById("20.5937,78.9629").innerHTML=e.get("India"),document.getElementById("9.0820,8.6753").innerHTML=e.get("Nigeria"),document.getElementById("0.7893,113.9213").innerHTML=e.get("Indonesia"),document.getElementById("-14.2350,-51.9253").innerHTML=e.get("Brazil"),document.getElementById("54.5260,-105.2551").innerHTML=e.get("NorthAmerica"),document.getElementById("-8.7832,-55.4915").innerHTML=e.get("SouthAmerica"),document.getElementById("-8.7832,34.5085").innerHTML=e.get("Africa"),document.getElementById("-25.2744,133.7751").innerHTML=e.get("Australia"),document.getElementById("12.8797,121.7740").innerHTML=e.get("Philippines"),document.getElementById("4.2105,101.9758").innerHTML=e.get("Malaysia"),document.getElementById("36.2048,138.2529").innerHTML=e.get("Japan"),document.getElementById("39.9042,116.4074").innerHTML=e.get("China")}function d(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(f)}function f(a){$("button#location-button").on("click",function(){console.log(i);try{document.getElementById(i).style.backgroundColor="black"}catch(a){}i=a.coords.latitude+","+a.coords.longitude,j=g.setLatitude(parseFloat(i.split(",")[0])),k=g.setLongitude(parseFloat(i.split(",")[1])),g.setGeo($(j,k)).setClock(0).draw(),h[2]=i,console.log(h)})}var g=$.virtualsky({id:"starmap",projection:"stereo",keyboard:!1,showposition:!1,showstars:!0,constellations:!0,constellationlabels:!0,showplanets:!0,showplanetlabels:!0,live:!0,clock:new Date});b.getEnvironment(function(b,d){currentenv=d;var f="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18.getUILanguage():navigator.language,i=d.user?d.user.language:f;e.language.code=i,g.loadLanguage(i),document.getElementById("locale-date").innerHTML=i,window.addEventListener("localized",function(){c()}),d.objectId?a.getDatastoreObject().loadAsText(function(a,b,c){if(null==a&&null!=c){h=JSON.parse(c),j=g.setLatitude(parseFloat(h[2].split(",")[0])),k=g.setLongitude(parseFloat(h[2].split(",")[1])),g.setGeo($(j,k)).setClock(0).draw();try{document.getElementById(h[2]).style.backgroundColor="grey"}catch(a){console.log("User location used")}g.selectProjection(h[3]),document.getElementById(h[3]).style.backgroundColor="grey",0==h[0]?(document.getElementById("const-button").classList.remove("active"),g.toggleConstellationLines(),g.toggleConstellationLabels()):1==h[0]&&document.getElementById("const-button").classList.add("active"),1==h[1]&&(document.getElementById("star-button").classList.add("active"),g.toggleStarLabels())}}):(console.log("New instance"),document.getElementById(h[2]).style.backgroundColor="grey",document.getElementById(h[3]).style.backgroundColor="grey")});var h=[!0,!1,"55.3781,-3.4360","stereo"],i=document.getElementById("worldConst").innerHTML,j=g.setLatitude(parseFloat(i.split(",")[0])),k=g.setLongitude(parseFloat(i.split(",")[1]));document.getElementById("const-button").classList.add("active"),d(),$("button#add-button").on("click",function(){g.clock.setDate(g.clock.getDate()+1),g.updateClock(g.clock),g.draw()}),$("button#minus-button").on("click",function(){g.clock.setDate(g.clock.getDate()-1),g.updateClock(g.clock),g.draw()}),$("button#const-button").on("click",function(){g.toggleConstellationLines(),g.toggleConstellationLabels(),1==h[0]?(document.getElementById("const-button").classList.remove("active"),h[0]=!1):(document.getElementById("const-button").classList.add("active"),h[0]=!0),console.log(h[0])}),$("button#star-button").on("click",function(){g.toggleStarLabels(),1==h[1]?(document.getElementById("star-button").classList.remove("active"),h[1]=!1):(document.getElementById("star-button").classList.add("active"),h[1]=!0),console.log(h[1])}),$("button.country").on("click",function(){i=document.getElementById("worldConst").innerHTML,j=g.setLatitude(parseFloat(i.split(",")[0])),k=g.setLongitude(parseFloat(i.split(",")[1])),g.setGeo($(j,k)).setClock(0).draw(),h[2]=i,console.log(h)}),$("button.view").on("click",function(){var a=document.getElementById("projection-view").innerHTML;g.selectProjection(a),h[3]=a,g.draw(),console.log(h)}),document.getElementById("stop-button").addEventListener("click",function(b){console.log("writing...");var c=JSON.stringify(h);a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?(console.log("write done."),console.log(c)):console.log("write failed.")})})})})});