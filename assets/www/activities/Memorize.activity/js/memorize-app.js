/*! Sugarizer 2017-09-04 */
define(["activity/sample-ressources","activity/palettes/template-palette","activity/palettes/size-palette","activity/lz-string"],function(a,b,c,d){function e(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a}function f(a){P.presence.isConnected()&&(P.inEditMode=!1,E(),F(),P.game.multiplayer=!0,P.isHost=a,P.me=P.presence.userInfo,P.game.currentPlayer=P.me.networkId,P.ui.gamePlayers.style.display="block")}function g(a){if(P.game.cards=[],P.game.selectedCards=[],P.game.template){P.game.mode=P.game.template.mode;var b={name:P.game.template.name,cards:[]};b.cards=JSON.parse(JSON.stringify(e(P.game.template.cards)));var c=0;if(c=P.game.size%2==0?P.game.size*P.game.size:P.game.size*P.game.size-2,P.game.mode==H){for(var d=[],f=0;f<b.cards.length&&f<c/2;f++){var g=b.cards[f][0],h=b.cards[f][1];g.id=f,h.id=f,d.push(g),d.push(h)}P.game.cards=e(d)}if(P.game.mode==I){for(var i=[],j=[],f=0;f<c/2&&f<b.cards.length;f++){var g=b.cards[f][0],h=b.cards[f][1];g.id=f,h.id=f,i.push(g),j.push(h)}for(var k=e(i),f=0;f<k.length;f++)P.game.cards.push(k[f]);for(var l=e(j),f=0;f<l.length;f++)P.game.cards.push(l[f])}a||o()}}function h(){for(var a=document.getElementsByClassName("textCard"),b=0;b<a.length;b++){for(var c=a[b];c.scrollHeight>c.offsetHeight;)c.style.fontSize=parseInt(c.style.fontSize)-1+"px";for(;c.scrollWidth>c.offsetWidth;)c.style.fontSize=parseInt(c.style.fontSize)-1+"px"}}function i(b,c){if(b.image){0==b.image.indexOf(L)&&(b.image=a[b.image.slice(L.length)]);var d=document.createElement("div");return d.style.background="url('"+b.image+"')",d.style.backgroundRepeat="no-repeat",d.style.backgroundSize="contain",d.style.webkitBackgroundSize="contain",d.style.backgroundPosition="center center",d.style.height=c+"px",d.style.width=c+"px",d}if(b.text){0==b.text.indexOf(L)&&(b.text=a[b.text.slice(L.length)]);var d=document.createElement("div");return d.className="textCard",d.style.textAlign="center",d.style.display="block",d.innerHTML=b.text,d.style.lineHeight=c+"px",d.style.fontSize=c+"px",d.style.color="#000",d.style.width=c+"px",d.style.height=c+"px",d}}function j(){if(!P.context){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;if(a){a=new a,P.context=a;var b=a.createBuffer(1,1,22050),c=a.createBufferSource();P.source=c,c.buffer=b,c.connect(a.destination),c.start(0)}}}function k(a,b,c){var d=document.createElement("div");return d.cardPosition=a,d.webkitPerspective="500px",d.perspective="500px",d.style.border="3px solid #fff",d.style.borderRadius="6px",d.style.margin="5px",d.style.webkitTransition="transform 0.5s",d.style.transition="transform 0.5s",d.style.transitionDuration="0.5s",d.style.webkitTransitionDuration="0.5s",d.style.transformStyle="preserve-3d",d.style.webkitTransformStyle="preserve-3d",d.style.position="relative",d.style.float="left",d.style.height=b+"px",d.style.width=b+"px",c.solved?(d.style.webkitTransform="rotateY(180deg)",d.style.transform="rotateY(180deg)"):(d.style.webkitTransform="",d.style.transform=""),0!=P.game.selectedCards.length&&P.game.selectedCards[0].cardPosition==d.cardPosition&&(d.style.webkitTransform="",d.style.transform=""),d}function l(a,b,c){var d=document.createElement("div");return P.game.mode==H&&(d.style.background="#777"),P.game.mode==I&&(a<b?d.style.background="#777 url(icons/number1.svg)":d.style.background="#777 url(icons/number2.svg)"),d.zIndex=2,d.style.borderRadius="6px",d.style.webkitBackfaceVisibility="hidden",d.style.backfaceVisibility="hidden",d.style.backgroundPosition="center center",d.style.backgroundRepeat="no-repeat",d.style.height=c+"px",d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.width=c+"px",d}function m(a,b,c){var d=document.createElement("div"),e=i(P.game.cards[a],b);return d.appendChild(e),d.style.height=b+"px",d.style.webkitBackfaceVisibility="hidden",d.style.backfaceVisibility="hidden",d.style.mozBackfaceVisibility="hidden",d.style.position="absolute",d.style.webkitTransform="rotateY(180deg)",d.style.transform="rotateY(180deg)",d.style.top="0px",d.style.left="0px",d.style.borderRadius="6px",d.style.width=b+"px",d.style.background="#fff",c.solved&&(d.style.backgroundColor=G),d}function n(b,c,d){var e=P.game.cards.length/2;j();var f=b;if(!f.card.solved&&2!=P.game.selectedCards.length){if(P.game.mode==I&&1==P.game.selectedCards.length){if(f.cardPosition<e&&P.game.selectedCards[0].cardPosition<e)return;if(f.cardPosition>=e&&P.game.selectedCards[0].cardPosition>=e)return}if(f.style.webkitTransform="rotateY(180deg)",f.style.transform="rotateY(180deg)",P.game.selectedCards.push(f),f.card.sound){0==f.card.sound.indexOf(L)&&(f.card.sound=a[f.card.sound.slice(L.length)]);var g=f.card.sound.split("base64,")[1];g=R.decodeArrayBuffer(btoa(atob(g))),P.context&&P.context.decodeAudioData(g,function(a){var b=P.context.createBufferSource();if(P.source)if(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)try{P.source.noteOff(0)}catch(a){}else try{P.source.stop(0)}catch(a){}if(P.source=b,b.buffer=a,b.connect(P.context.destination),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream)try{b.noteOn(0)}catch(a){}else try{b.start(0)}catch(a){}},function(a){console.log("err(decodeAudioData): "+a)})}if(1!=P.game.selectedCards.length){if(P.game.selectedCards[0].card.id==f.card.id){P.game.selectedCards[0].card.solved=!0,f.card.solved=!0;for(var h=0;h<P.game.players.length;h++)P.game.players[h].networkId==d.networkId&&(P.game.players[h].score=P.game.players[h].score+1);t();var i=P.game.selectedCards[0].resultDiv,k=f.resultDiv;return setTimeout(function(){i.style.backgroundColor=G,k.style.backgroundColor=G},1e3),P.game.selectedCards=[],void o()}P.game.currentPlayer="",setTimeout(function(){try{f.style.webkitTransform="",f.style.transform="",P.game.selectedCards[0].style.webkitTransform="",P.game.selectedCards[0].style.transform="",P.game.selectedCards=[],setTimeout(function(){if(c)for(var a=0;a<P.game.players.length;a++)if(P.game.players[a].online&&P.game.players[a].networkId!=P.me.networkId){P.game.currentPlayer=P.game.players[a].networkId,s({action:"updateCurrentPlayer",currentPlayer:P.game.currentPlayer}),t();break}},300)}catch(a){}},2e3)}}}function o(){P.activity.getDatastoreObject().setDataAsText(JSON.stringify({game:P.game})),P.activity.getDatastoreObject().save(function(a,b){})}function p(){if(P.game.multiplayer){if(P.game.currentPlayer!=P.me.networkId)return;s({action:"cardClick",position:this.cardPosition}),0!=P.game.players.length&&1!=P.game.players.length||n(this,!0);for(var a=0;a<P.game.players.length;a++)P.game.players[a].networkId==P.me.networkId&&n(this,!0,P.game.players[a])}else n(this,!0)}function q(){P.editor.pairMode==J?P.ui.gameEditorInsertModeButton.style.backgroundImage="url(icons/pair-non-equals.svg)":P.ui.gameEditorInsertModeButton.style.backgroundImage="url(icons/pair-equals.svg)",P.game.template.mode==H?P.ui.gameEditorPlayModeButton.style.backgroundImage="url(icons/grouped_game1.svg)":P.ui.gameEditorPlayModeButton.style.backgroundImage="url(icons/grouped_game2.svg)",P.ui.gameSizeButton.style.background="url(icons/"+P.game.size+"x"+P.game.size+".svg)",P.ui.gameTemplatesButton.style.backgroundImage="url(icons/"+P.game.template.icon+")",P.ui.gameGrid.innerHTML="";var a=P.ui.gameGrid,b=document.body.clientWidth,c=document.body.clientHeight,d=P.game.cards.length/2,e=c;b<c&&(e=b),e-=228,e/=P.game.size;for(var f=0;f<P.game.cards.length;f++){var g=P.game.cards[f];if(f%P.game.size==0&&f>0){var i=document.createElement("div");i.style.clear="both",a.appendChild(i)}var j=k(f,e,g),n=l(f,d,e),i=m(f,e,g);j.card=g,j.resultDiv=i;var o="click";/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(o="touchstart"),j.addEventListener(o,p,!1),j.appendChild(i),j.appendChild(n),a.appendChild(j)}a.style.width=parseInt(e+10)*parseInt(P.game.size+1)+"px",a.style.marginLeft="auto",a.style.marginRight="auto",h()}function r(a){if(a.user.networkId!=P.me.networkId&&(a.content=JSON.parse(d.decompressFromUTF16(a.content)),"updateCurrentPlayer"==a.content.action&&(P.game.currentPlayer=a.content.currentPlayer,t()),"updateGame"==a.content.action&&(P.game=a.content.game,P.ui.gameSizeButton.style.background="url(icons/"+P.game.size+"x"+P.game.size+".svg)",P.ui.gameTemplatesButton.style.backgroundImage="url(icons/"+P.game.template.icon+")",P.drawGame(),t(),o()),"cardClick"==a.content.action)){for(var b=P.ui.gameGrid.childNodes,c=[],e=0;e<b.length;e++)b[e].style.clear&&""!=b[e].style.clear||c.push(b[e]);for(var e=0;e<P.game.players.length;e++)P.game.players[e].networkId==a.user.networkId&&n(c[a.content.position],!1,P.game.players[e])}}function s(a){if(P.game.multiplayer){var b=window.top.sugar.environment.sharedId;b||(b=P.presence.getSharedInfo().id),P.presence.sendMessage(b,{user:P.presence.getUserInfo(),content:d.compressToUTF16(JSON.stringify(a))})}}function t(){if(0!=P.game.players.length){var a=document.createElement("div"),b=!1;P.game.currentPlayer==P.me.networkId&&(b=!0);var c=document.createElement("div");c.style.float="left",c.style.marginTop="10px",c.style.width="30px",c.style.marginRight="3px",c.style.borderRight="1px solid #fff",c.style.height="30px",b?c.style.backgroundImage="url(icons/play.svg)":c.style.backgroundImage="url(icons/sandclock.svg)",c.style.backgroundPosition="center center",c.style.backgroundRepeat="no-repeat",a.appendChild(c);for(var d=0;d<P.game.players.length;d++){var e=P.game.players[d],f=document.createElement("div");f.style.paddingTop="15px";for(var g=v(e.colorvalue),h="",i=0;i<e.score;i++)h+='<img style="height:13px;" src="icons/pair-add.svg">';f.innerHTML='<img style="height:23px; vertical-align:middle; " src="'+g+'"><span style="color:#fff;">'+e.name+"</span> "+h,f.style.float="left",0!=d&&(f.style.marginLeft="10px"),a.appendChild(f)}P.ui.gamePlayers.innerHTML="",P.ui.gamePlayers.appendChild(a)}}function u(a){for(var b=0;b<P.game.players.length;b++)P.game.players[b].online=!1;if(!P.hasLoadedMultiplayer&&a.length>=3)return void document.getElementById("stop-button").click();if(P.hasLoadedMultiplayer=!0,1==a.length)return P.isHost=!0,P.game.currentPlayer=P.me.networkId,P.game.selectedCards=[],q(),void t();for(var b=0;b<a.length;b++){for(var c=!1,d=0;d<P.game.players.length;d++)if(P.game.players[d].networkId==a[b].networkId){P.game.players[d].online=!0,c=!0;break}if(!c){var e=a[b];e.score=0,e.online=!0,P.game.players.push(e)}}P.isHost&&s({action:"updateGame",game:P.game}),t()}function v(a){var b=Q;return b=b.replace("#010101",a.stroke),b=b.replace("#FFFFFF",a.fill),"data:image/svg+xml;base64,"+btoa(b)}function w(a){P.ui.gameGrid=document.getElementById("game-grid"),P.ui.gamePlayers=document.getElementById("game-players"),P.ui.gameEditor=document.getElementById("game-editor"),P.ui.gameTemplatesButton=document.getElementById("game-templates-button");var d=new b.TemplatePalette(P.ui.gameTemplatesButton,void 0,P.templates);d.addEventListener("template",function(a){for(var b=0;b<P.game.players.length;b++)P.game.players[b].score=0;P.game.template=a.detail.value,P.ui.gameTemplatesButton.style.backgroundImage="url(icons/"+a.detail.value.icon+")",P.computeCards(),P.drawGame(),s({action:"updateGame",game:P.game})}),P.ui.gameSizeButton=document.getElementById("game-size-button");var e=new c.SizePalette(P.ui.gameSizeButton);e.addEventListener("size",function(a){for(var b=0;b<P.game.players.length;b++)P.game.players[b].score=0;P.game.size=a.detail.value,P.ui.gameSizeButton.style.background="url(icons/"+a.detail.value+"x"+a.detail.value+".svg)",P.computeCards(),P.drawGame(),s({action:"updateGame",game:P.game})}),P.ui.gameResetButton=document.getElementById("game-reset-button"),P.ui.gameResetButton.addEventListener("click",function(){for(var a=0;a<P.game.players.length;a++)P.game.players[a].score=0;P.game.selectedCards=[],P.game.cards=[],t(),P.computeCards(),P.drawGame(),s({action:"updateGame",game:P.game})}),P.ui.gameEditorButton=document.getElementById("game-editor-button"),P.ui.gameEditorInsertModeButton=document.getElementById("game-editor-insert-mode-button"),P.ui.gameEditorPlayModeButton=document.getElementById("game-editor-play-mode-button"),P.ui.gameEditorPlayModeButton.addEventListener("click",function(){P.game.template.mode==H?(P.game.template.mode=I,P.ui.gameEditorPlayModeButton.style.backgroundImage="url(icons/grouped_game2.svg)"):(P.game.template.mode=H,P.ui.gameEditorPlayModeButton.style.backgroundImage="url(icons/grouped_game1.svg)"),o(),D()}),P.ui.gameEditorClearButton=document.getElementById("game-editor-clear-button"),P.ui.gameEditorInsertModeButton.addEventListener("click",function(){P.editor.pairMode==J?(P.editor.pairMode=K,P.ui.gameEditorInsertModeButton.style.backgroundImage="url(icons/pair-non-equals.svg)"):(P.editor.pairMode=J,P.ui.gameEditorInsertModeButton.style.backgroundImage="url(icons/pair-equals.svg)"),o(),D()}),P.ui.gameEditorClearButton.addEventListener("click",function(){P.game.template.cards=[],o(),D()}),P.ui.gameEditorButton.addEventListener("click",function(){P.inEditMode?E():x()}),P.ui.gameEditorInsertModeButton.disabled=!0,P.ui.gameEditorInsertModeButton.style.opacity=.3,P.ui.gameEditorPlayModeButton.disabled=!0,P.ui.gameEditorPlayModeButton.style.opacity=.3,P.ui.gameEditorClearButton.disabled=!0,P.ui.gameEditorClearButton.style.opacity=.3,a&&a()}function x(){P.inEditMode=!0,P.ui.gameGrid.innerHTML="",P.ui.gameGrid.style.display="none",P.ui.gameEditor.style.display="block",P.game.selectedCards=[],P.editor.selectedPair=-1,P.ui.gameTemplatesButton.disabled=!0,P.ui.gameTemplatesButton.style.opacity=.3,P.ui.gameSizeButton.disabled=!0,P.ui.gameSizeButton.style.opacity=.3,P.ui.gameResetButton.disabled=!0,P.ui.gameResetButton.style.opacity=.3,P.ui.gameEditorInsertModeButton.disabled=!1,P.ui.gameEditorInsertModeButton.style.opacity=1,P.ui.gameEditorPlayModeButton.disabled=!1,P.ui.gameEditorPlayModeButton.style.opacity=1,P.ui.gameEditorClearButton.disabled=!1,P.ui.gameEditorClearButton.style.opacity=1,P.ui.gameEditorButton.style.backgroundImage="url(icons/play.svg)",D()}function y(a){var b=document.body.clientWidth;b>document.body.clientHeight&&(b=document.body.clientHeight);var c=document.createElement("div");c.style.width=parseInt(b/3.5)+"px",c.style.marginLeft="25px",c.style.float="left",c.style.marginTop="7px";var d=document.createElement("div");d.style.width=parseInt(b/3.5)-10+"px",d.style.height=parseInt(b/3.5)-10+"px",d.style.background="rgb(119, 119, 119)",d.style.border="4px solid #000",d.style.textAlign="center",d.style.borderRadius="9px",d.style.color="#fff",d.style.fontSize=parseInt(b/3.5)-10+"px",d.style.lineHeight=parseInt(b/3.5)-10+"px",d.className="textCard",a&&a.text&&(d.innerHTML=a.text);var e=document.createElement("input");return e.setAttribute("type","text"),e.style.marginRight="auto",e.style.marginLeft="auto",e.style.width=parseInt(b/3.5)-10+"px",e.style.marginTop="5px",e.card=a,a&&a.text&&(e.value=a.text),e.linkedDiv=d,e.onkeyup=function(){this.linkedDiv.innerHTML=this.value,this.linkedDiv.style.fontSize=this.linkedDiv.style.width,this.card.text=this.value,h()},c.appendChild(d),c.appendChild(e),c}function z(){var a=document.createElement("div"),b=document.body.clientWidth;b>document.body.clientHeight&&(b=document.body.clientHeight),a.style.float="right",a.style.height=parseInt(b/3.5)+"px",a.style.marginRight="20px",a.style.marginTop="7px";var c=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),f=parseInt(b/3.5/5)+"px";return c.style.padding="5px",c.style.userSelect="none",c.style.webkitUserSelect="none",c.style.mozUserSelect="none",c.innerHTML="<img style='height:"+f+"; width:"+f+";' src='icons/pair-add.svg'><br/>"+P.strings.add,c.onmouseover=function(){this.style.background="#888"},c.onmouseout=function(){this.style.background="transparent"},c.addEventListener("click",function(){var a=[];P.editor.pairMode==J&&(a[0]=P.editor.card1,a[1]=P.editor.card1),P.editor.pairMode==K&&(a[0]=P.editor.card1,a[1]=P.editor.card2),(a[0].text||a[0].image||a[0].sound)&&(a[1].text||a[1].image||a[1].sound)&&(a=JSON.parse(JSON.stringify(a)),P.editor.card1={},P.editor.card2={},P.game.template.cards.push(a),P.editor.selectedPair=-1,o(),D())}),d.style.padding="5px",d.style.userSelect="none",d.style.webkitUserSelect="none",d.style.mozUserSelect="none",d.innerHTML="<img style='height:"+f+"; width:"+f+";' src='icons/pair-update.svg'><br/>"+P.strings.update,d.onmouseover=function(){this.style.background="#888"},d.onmouseout=function(){this.style.background="transparent"},d.addEventListener("click",function(){var a=[];P.editor.pairMode==J&&(a[0]=P.editor.card1,a[1]=P.editor.card1),P.editor.pairMode==K&&(a[0]=P.editor.card1,a[1]=P.editor.card2),(a[0].text||a[0].image||a[0].sound)&&(a[1].text||a[1].image||a[1].sound)&&(a=JSON.parse(JSON.stringify(a)),P.editor.selectedPair>-1&&(P.game.template.cards[P.editor.selectedPair]=a),o(),D())}),e.style.padding="5px",e.style.userSelect="none",e.style.webkitUserSelect="none",e.style.mozUserSelect="none",e.innerHTML="<img style='height:"+f+"; width:"+f+";' src='icons/remove.svg'><br/>"+P.strings.remove,e.onmouseover=function(){this.style.background="#888"},e.onmouseout=function(){this.style.background="transparent"},e.addEventListener("click",function(){P.editor.selectedPair>-1&&P.game.template.cards.splice(P.editor.selectedPair,1),P.editor.selectedPair=-1,P.editor.card1={},P.editor.card2={},o(),D()}),a.appendChild(c),a.appendChild(d),a.appendChild(e),a}function A(b,c,d){c-=10;var e=document.createElement("div");e.style.display="inline-block",e.style.height=c+"px",e.style.marginLeft="5px",d==P.editor.selectedPair&&(e.style.border="3px solid #00f");var f=document.createElement("div");f.style.backgroundRepeat="no-repeat",f.style.backgroundSize="cover",f.style.backgroundPosition="center center",f.innerHTML="&nbsp;",f.style.backgroundColor="#666",f.className="textCard",b[0].text?(0==b[0].text.indexOf(L)&&(b[0].text=a[b[0].image.slice(L.length)]),f.innerHTML=b[0].text):b[0].image&&(0==b[0].image.indexOf(L)&&(b[0].image=a[b[0].image.slice(L.length)]),f.style.backgroundImage="url('"+b[0].image+"')"),f.style.width=parseInt(c/2)+"px",f.style.height=parseInt(c/2)+"px",f.style.lineHeight=f.style.width+"",f.style.borderRadius="6px",f.style.textAlign="center",f.style.fontSize=parseInt(c/8)+"px",f.style.border="1px solid #000",f.style.color="#fff",f.style.marginBottom="5px";var g=document.createElement("div");return g.style.backgroundRepeat="no-repeat",g.style.backgroundPosition="center center",g.style.backgroundSize="cover",g.innerHTML="&nbsp;",g.style.backgroundColor="#666",g.className="textCard",b[1].text?(0==b[1].text.indexOf(L)&&(b[1].text=a[b[1].image.slice(L.length)]),g.innerHTML=b[1].text):b[1].image&&(0==b[1].image.indexOf(L)&&(b[1].image=a[b[1].image.slice(L.length)]),g.style.backgroundImage="url('"+b[1].image+"')"),g.style.width=parseInt(c/2)+"px",g.style.height=parseInt(c/2)+"px",g.style.textAlign="center",g.style.lineHeight=g.style.width+"",g.style.borderRadius="6px",g.style.fontSize=parseInt(c/8)+"px",g.style.border="1px solid #000",g.style.color="#fff",e.appendChild(f),e.appendChild(g),e}function B(){var a=document.createElement("div"),b=document.body.clientWidth;b>document.body.clientHeight&&(b=document.body.clientHeight),a.style.position="fixed",a.style.bottom=0,a.style.width=document.body.clientWidth+"px",a.style.height=parseInt(b/3)+"px",a.style.padding="10px",a.style.paddingBottom="20px",a.style.marginTop="7px",a.style.background="#eee",a.style.overflowX="auto",a.style.whiteSpace="nowrap",a.style.overflowY="hidden";for(var c=0;c<P.game.template.cards.length;c++){var d=P.game.template.cards[c],e=A(d,parseInt(b/3),c);e.cards=d,e.index=c,e.addEventListener("click",function(){P.editor.selectedPair=this.index,P.editor.pairMode=K,P.editor.card1=this.cards[0],P.editor.card2=this.cards[1],D()}),a.appendChild(e)}var f=document.createElement("div");return f.style.height=parseInt(b/6)+"px",f.style.width="30px",f.style.display="inline-block",a.appendChild(f),a}function C(){var a=document.createElement("div");return a.style.clear="both",a}function D(){P.ui.gameEditor.innerHTML="",P.editor.pairMode==J&&P.ui.gameEditor.appendChild(y(P.editor.card1)),P.editor.pairMode==K&&(P.ui.gameEditor.appendChild(y(P.editor.card1)),P.ui.gameEditor.appendChild(y(P.editor.card2))),P.ui.gameEditor.appendChild(z()),P.ui.gameEditor.appendChild(C()),P.ui.gameEditor.appendChild(B()),h()}function E(){P.editor.card1={},P.editor.card2={},P.inEditMode=!1,P.ui.gameEditor.innerHTML="",P.ui.gameEditor.style.display="none",P.ui.gameGrid.style.display="block",P.ui.gameTemplatesButton.disabled=!1,P.ui.gameTemplatesButton.style.opacity=1,P.ui.gameSizeButton.disabled=!1,P.ui.gameSizeButton.style.opacity=1,P.ui.gameResetButton.disabled=!1,P.ui.gameResetButton.style.opacity=1,P.ui.gameEditorInsertModeButton.disabled=!0,P.ui.gameEditorInsertModeButton.style.opacity=.3,P.ui.gameEditorPlayModeButton.disabled=!0,P.ui.gameEditorPlayModeButton.style.opacity=.3,P.ui.gameEditorClearButton.disabled=!0,P.ui.gameEditorClearButton.style.opacity=.3,P.ui.gameEditorButton.style.backgroundImage="url(icons/cog.svg)",P.drawGame()}function F(){P.ui.gameEditorButton.disabled=!0,P.ui.gameEditorButton.style.opacity=.3,P.ui.gameEditorButton.style.backgroundImage="url(icons/cog.svg)",P.ui.gameEditorInsertModeButton.disabled=!0,P.ui.gameEditorInsertModeButton.style.opacity=.3,P.ui.gameEditorPlayModeButton.disabled=!0,P.ui.gameEditorPlayModeButton.style.opacity=.3,P.ui.gameEditorClearButton.disabled=!0,P.ui.gameEditorClearButton.style.opacity=.3}var G="#84f060",H="classic",I="splitted",J="equal",K="non_equal",L="#inline#",M={name:"Addition",icon:"addition.svg",cards:[[{text:"3+4"},{text:"7"}],[{text:"5+5"},{text:"10"}],[{text:"5+6"},{text:"11"}],[{text:"4+4"},{text:"8"}],[{text:"4+5"},{text:"9"}],[{text:"3+3"},{text:"6"}],[{text:"2+2"},{text:"4"}],[{text:"1+1"},{text:"2"}],[{text:"1+2"},{text:"3"}],[{text:"9+9"},{text:"18"}],[{text:"10+9"},{text:"19"}],[{text:"8+8"},{text:"16"}],[{text:"8+9"},{text:"17"}],[{text:"7+7"},{text:"14"}],[{text:"7+8"},{text:"15"}],[{text:"6+6"},{text:"12"}]],mode:I},N={name:"Letters",icon:"letters.svg",cards:[[{text:"A"},{text:"a"}],[{text:"B"},{text:"b"}],[{text:"C"},{text:"c"}],[{text:"D"},{text:"d"}],[{text:"E"},{text:"e"}],[{text:"F"},{text:"f"}],[{text:"G"},{text:"g"}],[{text:"H"},{text:"h"}],[{text:"I"},{text:"i"}],[{text:"J"},{text:"j"}],[{text:"K"},{text:"k"}],[{text:"L"},{text:"l"}],[{text:"M"},{text:"m"}],[{text:"N"},{text:"n"}],[{text:"O"},{text:"o"}],[{text:"P"},{text:"p"}],[{text:"Q"},{text:"q"}],[{text:"R"},{text:"r"}],[{text:"S"},{text:"s"}],[{text:"T"},{text:"t"}],[{text:"U"},{text:"u"}],[{text:"V"},{text:"v"}],[{text:"W"},{text:"w"}],[{text:"X"},{text:"x"}],[{text:"Y"},{text:"y"}],[{text:"Z"},{text:"z"}]],mode:I},O={name:"Sounds",icon:"sounds.svg",cards:[[{image:L+"drumkit1_b",sound:L+"beat1_a"},{image:L+"drumkit1_b",sound:L+"beat1_a"}],[{image:L+"drumkit2_b",sound:L+"beat1_b"},{image:L+"drumkit2_b",sound:L+"beat1_b"}],[{image:L+"drumkit3_b",sound:L+"beat1_c"},{image:L+"drumkit3_b",sound:L+"beat1_c"}],[{image:L+"drumkit4_b",sound:L+"beat8"},{image:L+"drumkit4_b",sound:L+"beat8"}],[{image:L+"drumkit5_b",sound:L+"beat10"},{image:L+"drumkit5_b",sound:L+"beat10"}],[{image:L+"drumkit6_b",sound:L+"beat3"},{image:L+"drumkit6_b",sound:L+"beat3"}],[{image:L+"drumkit7_b",sound:L+"beat4"},{image:L+"drumkit7_b",sound:L+"beat4"}],[{image:L+"drumkit8_b",sound:L+"beat14"},{image:L+"drumkit8_b",sound:L+"beat14"}],[{image:L+"drumkit9_b",sound:L+"beat6_2"},{image:L+"drumkit9_b",sound:L+"beat6_2"}],[{image:L+"drumkit10_b",sound:L+"beat2"},{image:L+"drumkit10_b",sound:L+"beat2"}],[{image:L+"drumkit11_b",sound:L+"beat16"},{image:L+"drumkit11_b",sound:L+"beat16"}],[{image:L+"drumkit12_b",sound:L+"beat17"},{image:L+"drumkit12_b",sound:L+"beat17"}],[{image:L+"guitar1_2",sound:L+"bending_a"},{image:L+"guitar1_2",sound:L+"bending_a"}],[{image:L+"guitar2_2",sound:L+"bending_b"},{image:L+"guitar2_2",sound:L+"bending_b"}],[{image:L+"guitar3_2",sound:L+"flashcomp2a"},{image:L+"guitar3_2",sound:L+"flashcomp2a"}],[{image:L+"guitar4_2",sound:L+"flashcomp2b"},{image:L+"guitar4_2",sound:L+"flashcomp2b"}],[{image:L+"guitar5_2",sound:L+"gedaempft"},{image:L+"guitar5_2",sound:L+"gedaempft"}],[{image:L+"guitar6_2",sound:L+"ungedaempft"},{image:L+"guitar6_2",sound:L+"ungedaempft"}],[{image:L+"guitar7_2",sound:L+"jimi4"},{image:L+"guitar7_2",sound:L+"jimi4"}],[{image:L+"guitar8_2",sound:L+"git_hit1"},{image:L+"guitar8_2",sound:L+"git_hit1"}],[{image:L+"guitar9_2",sound:L+"git_hit4"},{image:L+"guitar9_2",sound:L+"git_hit4"}],[{image:L+"guitar10_2",sound:L+"jimi1"},{image:L+"guitar10_2",sound:L+"jimi1"}],[{image:L+"guitar11_2",sound:L+"flasholet4"},{image:L+"guitar11_2",sound:L+"flasholet4"}],[{image:L+"guitar12_2",sound:L+"guitcello"},{image:L+"guitar12_2",sound:L+"guitcello"}]],mode:H},P={strings:{add:"Add",update:"Update",remove:"Remove"},ui:{},templates:[M,N,O],isHost:!1,editor:{pairMode:J,card1:{},card2:{},selectedPair:-1},game:{template:N,multiplayer:!1,selectedCards:[],mode:void 0,cards:[],currentPlayer:"",players:[],size:4},computeCards:g,inEditMode:!1,shareActivity:f,initUI:w,drawGame:q,onUsersListChanged:u,onDataReceived:r},Q='<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [<!ENTITY stroke_color "#010101"><!ENTITY fill_color "#FFFFFF">]><svg enable-background="new 0 0 55 55" height="55px" version="1.1" viewBox="0 0 55 55" width="55px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="stock-xo_1_"><path d="M33.233,35.1l10.102,10.1c0.752,0.75,1.217,1.783,1.217,2.932   c0,2.287-1.855,4.143-4.146,4.143c-1.145,0-2.178-0.463-2.932-1.211L27.372,40.961l-10.1,10.1c-0.75,0.75-1.787,1.211-2.934,1.211   c-2.284,0-4.143-1.854-4.143-4.141c0-1.146,0.465-2.184,1.212-2.934l10.104-10.102L11.409,24.995   c-0.747-0.748-1.212-1.785-1.212-2.93c0-2.289,1.854-4.146,4.146-4.146c1.143,0,2.18,0.465,2.93,1.214l10.099,10.102l10.102-10.103   c0.754-0.749,1.787-1.214,2.934-1.214c2.289,0,4.146,1.856,4.146,4.145c0,1.146-0.467,2.18-1.217,2.932L33.233,35.1z" fill="&fill_color;" stroke="&stroke_color;" stroke-width="3.5"/><circle cx="27.371" cy="10.849" fill="&fill_color;" r="8.122" stroke="&stroke_color;" stroke-width="3.5"/></g></svg>',R={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_arrayBufferToBase64:function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return window.btoa(b)},decodeArrayBuffer:function(a){var b=a.length/4*3,c=new ArrayBuffer(b);return this.decode(a,c),c},removePaddingChars:function(a){var b=this._keyStr.indexOf(a.charAt(a.length-1));return 64==b?a.substring(0,a.length-1):a},decode:function(a,b){a=this.removePaddingChars(a),a=this.removePaddingChars(a);var c,d,e,f,g,h,i,j,k=parseInt(a.length/4*3,10),l=0,m=0;for(c=b?new Uint8Array(b):new Uint8Array(k),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),l=0;l<k;l+=3)g=this._keyStr.indexOf(a.charAt(m++)),h=this._keyStr.indexOf(a.charAt(m++)),i=this._keyStr.indexOf(a.charAt(m++)),j=this._keyStr.indexOf(a.charAt(m++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,c[l]=d,64!=i&&(c[l+1]=e),64!=j&&(c[l+2]=f);return c}};return P});