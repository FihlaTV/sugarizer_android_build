/*! Sugarizer 2019-01-12 */
enyo.kind({name:"Abcd.Entry",kind:"Abcd.Item",published:{index:"",imageonly:!1,textonly:!1,soundonly:!1,tojournal:!1},classes:"entry",components:[{name:"spinner",kind:"Image",src:"images/spinner-light.gif",classes:"spinner"},{name:"contentBox",showing:!1,components:[{name:"itemImage",classes:"entryImage",kind:"Image",onload:"imageLoaded",onerror:"imageError"},{name:"soundIcon",kind:"Image",classes:"entrySoundIcon"},{name:"itemText",classes:"entryText"}]},{kind:"Signals",onEndOfSound:"endOfSound"}],events:{onEntrySoundEnded:""},create:function(){this.inherited(arguments),this.sound=null,this.imageonlyChanged(),this.textonlyChanged(),this.soundonlyChanged(),this.indexChanged(),this.tojournalChanged()},imageLoaded:function(){""!==this.index&&(this.$.spinner.hide(),this.$.contentBox.show())},imageError:function(){Abcd.goHome()},imageonlyChanged:function(){this.imageonly&&Abcd.changeVisibility(this,{itemImage:!0,soundIcon:!1,itemText:!1})},textonlyChanged:function(){this.textonly&&Abcd.changeVisibility(this,{itemImage:!1,soundIcon:!1,itemText:!0})},soundonlyChanged:function(){this.soundonly&&Abcd.changeVisibility(this,{itemImage:!1,soundIcon:!0,itemText:!1})},tojournalChanged:function(){this.tojournal?this.$.soundIcon.setSrc("icons/journal.svg"):this.$.soundIcon.setSrc("images/sound_off"+(this.soundonly?1:0)+".png"),this.$.soundIcon.render()},setLocale:function(){this.indexChanged(),this.inherited(arguments)},indexChanged:function(){var a=Abcd.entries[this.index],b=Abcd.context.getDatabase()+"images/database/"+a.code+".png",c=__$FC(a.text);1==Abcd.context.casevalue&&(c=c.toUpperCase()),this.soundonly&&this.$.soundIcon.addClass("entrySoundIconOnly"),a[Abcd.context.lang]?(this.sound=Abcd.context.getDatabase()+"audio/"+Abcd.context.lang+"/database/"+a.code,this.$.soundIcon.setSrc("images/sound_off"+(this.soundonly?1:0)+".png")):(this.sound=null,this.$.soundIcon.setSrc("images/sound_none"+(this.soundonly?1:0)+".png")),this.$.itemImage.setAttribute("src",b),this.$.itemText.removeClass("entryText0"),this.$.itemText.removeClass("entryText1"),this.$.itemText.removeClass("entryText2"),this.$.itemText.addClass("entryText"+Abcd.context.casevalue),this.imageonly&&this.$.itemImage.addClass("entryImageOnly"),this.$.itemText.setContent(c),this.textonly&&this.$.itemText.addClass("entryTextOnly")},play:function(a){if(this.tojournal){var b=Abcd.entries[this.index],c=this.$.itemImage.hasNode(),d=document.createElement("canvas"),e=d.getContext("2d");d.width=d.height=210,e.drawImage(c,0,0,d.width,d.height);var f=d.toDataURL("image/png"),g={mimetype:"image/png",title:__$FC(b.text),activity:"org.olpcfrance.MediaViewerActivity",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0};return Abcd.datastore.create(g,function(){console.log("image '"+__$FC(b.text)+"' saved in journal.")},f),this.tojournal=!1,void this.indexChanged()}null!=this.sound&&(this.$.soundIcon.setSrc("images/sound_on"+(this.soundonly?1:0)+".png"),a.play(this.sound))},endOfSound:function(a,b){b.sound==this.sound&&(this.doEntrySoundEnded(),this.$.soundIcon.setSrc("images/sound_off"+(this.soundonly?1:0)+".png"))},abort:function(){void 0!==this.$.soundIcon&&this.$.soundIcon.setSrc("images/sound_off"+(this.soundonly?1:0)+".png")}});