/*! Sugarizer 2016-12-28 */
function format(a,b){return a=a.replace(/{([a-zA-Z0-9.]*)}/g,function(c,d){return x=b,d.split(".").forEach(function(b){void 0===x&&console.log("Undefined value in template string",a,d,x,b),x=x[b]}),x}),a.replace(/{_([a-zA-Z0-9]+)}/g,function(a,b){return _(b)})}function canvasPixelRatio(){var a=window.devicePixelRatio||1,b=document.querySelector("#myCanvas").getContext("2d"),c=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;return a/c}function windowHeight(){var a=/Android/i.test(navigator.userAgent);return a?window.outerHeight:window.innerHeight}function httpGet(a){var b=null;if(b=new XMLHttpRequest,null==a?(b.open("GET",window.server,!1),b.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")):(b.open("GET",window.server+a,!1),b.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")),b.send(),b.status>299)throw"Error from server";return b.responseText}function httpPost(a,b){var c=null;return c=new XMLHttpRequest,c.open("POST",window.server+a,!1),c.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7"),c.send(b),"https://apps.facebook.com/turtleblocks/?file="+a}function HttpRequest(a,b,c){var d=this.request=new XMLHttpRequest;this.handler=b,this.url=a,this.localmode=Boolean(0==self.location.href.search(/^file:/i)),this.userCallback=c;var e=this;try{d.open("GET",a),d.onreadystatechange=function(){e.handler()},d.send("")}catch(b){self.console&&console.log("Failed to load resource from "+a+": Network error."),"function"==typeof c&&c(!1,"network error"),this.request=this.handler=this.userCallback=null}}function docByTagName(a){document.getElementsByTagName(a)}function docById(a){return document.getElementById(a)}function last(a){var b=a.length;return 0==b?null:a[b-1]}function doSVG(a,b,c,d,e,f){var g='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="'+d+'" height="'+e+'">\n';g+='<g transform="scale('+f+","+f+')">\n',g+=b.svgOutput;for(var h in c.turtleList)c.turtleList[h].closeSVG(),g+=c.turtleList[h].svgOutput;return g+="</g>",g+="</svg>"}function isSVGEmpty(a){for(var b in a.turtleList)if(a.turtleList[b].closeSVG(),""!==a.turtleList[b].svgOutput)return!1;return!0}function fileExt(a){var b=a.split(".");return 1==b.length||""==b[0]&&2==b.length?"":b.pop()}function fileBasename(a){var b=a.split(".");return 1==b.length?b[0]:""==b[0]&&2==b.length?a:(b.pop(),b.join("."))}function _(a){for(replaced=a,replace=[",","(",")","?","¿","<",">",".",'"\n','"',":","%s","%d","/","'",";","×","!","¡"],p=0;p<replace.length;p++)replaced=replaced.replace(replace[p],"");replaced=replaced.replace(/ /g,"-");try{return translation=document.webL10n.get(replaced),""==translation&&(translation=a),translation}catch(b){return a}}function processRawPluginData(a,b,c,d,e,f,g,h,j,k){var l=a.split("\n"),m="";for(i=0;i<l.length;i++)0!=l[i].length&&"/"!=l[i][0]&&(m+=l[i]);var n=processPluginData(m.replace(/\n/g,""),b,c,e,f,g,h,j,k);return n}function processPluginData(pluginData,palettes,blocks,evalFlowDict,evalArgDict,evalParameterDict,evalSetterDict,evalOnStartList,evalOnStopList){var obj=JSON.parse(pluginData),newPalette=!1;if("PALETTEPLUGINS"in obj)for(var name in obj.PALETTEPLUGINS){PALETTEICONS[name]=obj.PALETTEPLUGINS[name];var fillColor="#ff0066";if("PALETTEFILLCOLORS"in obj&&name in obj.PALETTEFILLCOLORS)var fillColor=obj.PALETTEFILLCOLORS[name];PALETTEFILLCOLORS[name]=fillColor;var strokeColor="#ef003e";if("PALETTESTROKECOLORS"in obj&&name in obj.PALETTESTROKECOLORS)var strokeColor=obj.PALETTESTROKECOLORS[name];PALETTESTROKECOLORS[name]=strokeColor;var highlightColor="#ffb1b3";if("PALETTEHIGHLIGHTCOLORS"in obj&&name in obj.PALETTEHIGHLIGHTCOLORS)var highlightColor=obj.PALETTEHIGHLIGHTCOLORS[name];PALETTEHIGHLIGHTCOLORS[name]=highlightColor;var strokeHighlightColor="#404040";if("HIGHLIGHTSTROKECOLORS"in obj&&name in obj.HIGHLIGHTSTROKECOLORS)var strokeHighlightColor=obj.HIGHLIGHTSTROKECOLORS[name];HIGHLIGHTSTROKECOLORS[name]=strokeHighlightColor,name in palettes.buttons?console.log("palette "+name+" already exists"):(console.log("adding palette "+name),palettes.add(name),newPalette=!0)}if(newPalette)try{palettes.makePalettes()}catch(a){console.log("makePalettes: "+a)}if("IMAGES"in obj)for(var blkName in obj.IMAGES)pluginsImages[blkName]=obj.IMAGES[blkName];if("FLOWPLUGINS"in obj)for(var flow in obj.FLOWPLUGINS)evalFlowDict[flow]=obj.FLOWPLUGINS[flow];if("ARGPLUGINS"in obj)for(var arg in obj.ARGPLUGINS)evalArgDict[arg]=obj.ARGPLUGINS[arg];if("SETTERPLUGINS"in obj)for(var setter in obj.SETTERPLUGINS)evalSetterDict[setter]=obj.SETTERPLUGINS[setter];if("BLOCKPLUGINS"in obj)for(var block in obj.BLOCKPLUGINS){console.log("adding plugin block "+block);try{eval(obj.BLOCKPLUGINS[block])}catch(a){console.log("Failed to load plugin for "+block+": "+a)}}if("GLOBALS"in obj&&eval(obj.GLOBALS),"PARAMETERPLUGINS"in obj)for(var parameter in obj.PARAMETERPLUGINS)evalParameterDict[parameter]=obj.PARAMETERPLUGINS[parameter];if("ONLOAD"in obj)for(var arg in obj.ONLOAD)eval(obj.ONLOAD[arg]);if("ONSTART"in obj)for(var arg in obj.ONSTART)evalOnStartList[arg]=obj.ONSTART[arg];if("ONSTOP"in obj)for(var arg in obj.ONSTOP)evalOnStopList[arg]=obj.ONSTOP[arg];for(var protoblock in blocks.protoBlockDict)void 0==blocks.protoBlockDict[protoblock].palette?console.log("Cannot find palette for protoblock "+protoblock):blocks.protoBlockDict[protoblock].palette.add(blocks.protoBlockDict[protoblock]);return palettes.updatePalettes(),blocks.findBlockTypes(),obj}function updatePluginObj(a){for(var b in a.PALETTEPLUGINS)pluginObjs.PALETTEPLUGINS[b]=a.PALETTEPLUGINS[b];for(var b in a.PALETTEFILLCOLORS)pluginObjs.PALETTEFILLCOLORS[b]=a.PALETTEFILLCOLORS[b];for(var b in a.PALETTESTROKECOLORS)pluginObjs.PALETTESTROKECOLORS[b]=a.PALETTESTROKECOLORS[b];for(var b in a.PALETTEHIGHLIGHTCOLORS)pluginObjs.PALETTEHIGHLIGHTCOLORS[b]=a.PALETTEHIGHLIGHTCOLORS[b];for(var c in a.FLOWPLUGINS)pluginObjs.FLOWPLUGINS[c]=a.FLOWPLUGINS[c];for(var d in a.ARGPLUGINS)pluginObjs.ARGPLUGINS[d]=a.ARGPLUGINS[d];for(var e in a.BLOCKPLUGINS)pluginObjs.BLOCKPLUGINS[e]=a.BLOCKPLUGINS[e];"GLOBALS"in a&&("GLOBALS"in pluginObjs||(pluginObjs.GLOBALS=""),pluginObjs.GLOBALS+=a.GLOBALS),"IMAGES"in a&&(pluginObjs.IMAGES=a.IMAGES);for(var b in a.ONLOAD)pluginObjs.ONLOAD[b]=a.ONLOAD[b];for(var b in a.ONSTART)pluginObjs.ONSTART[b]=a.ONSTART[b];for(var b in a.ONSTOP)pluginObjs.ONSTOP[b]=a.ONSTOP[b]}function preparePluginExports(a){return updatePluginObj(a),JSON.stringify(pluginObjs)}function processMacroData(a,b,c,d){if("{}"!=a){var e=JSON.parse(a);console.log("adding myblocks palette"),b.add("myblocks","black","#a0a0a0");for(name in e)console.log("adding "+name+" to macroDict"),d[name]=e[name],c.addToMyPalette(name,d[name]);b.makePalettes()}}function prepareMacroExports(a,b,c){return null!=a&&(c[a]=b),JSON.stringify(c)}function doSaveSVG(a,b){var c=doSVG(a.canvas,a,a.turtles,a.canvas.width,a.canvas.height,1);download(b,"data:image/svg+xml;utf8,"+c,b,'"width='+a.canvas.width+", height="+a.canvas.height+'"')}function download(a,b){var c=document.createElement("a");c.setAttribute("href",b),c.setAttribute("download",a),document.body.appendChild(c),c.click(),document.body.removeChild(c)}function doPublish(a){var b=doSave();console.log("push "+b+" to FB");var c=docById("description"),d=a+" "+c.value+" "+b;console.log("comment: "+d);var e=function(){FB.api("/me/feed","post",{message:d})};FB.login(e,{scope:"publish_actions"})}function doUseCamera(a,b,c,d,e,f,g){function h(){m.width=i,m.height=j,m.getContext("2d").drawImage(l,0,0,i,j);var d=m.toDataURL("image/png");b.turtleList[c].doShowImage(a[0],d)}var i=320,j=240,k=!1,l=document.querySelector("#camVideo"),m=document.querySelector("#camCanvas");navigator.getMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,void 0===navigator.getMedia&&g("Your browser does not support the webcam"),hasSetupCamera?(k=!0,l.play(),d?(e=window.setInterval(h,100),f(e)):h()):navigator.getMedia({video:!0,audio:!1},function(a){if(navigator.mozGetUserMedia)l.mozSrcObject=a;else{var b=window.URL||window.webkitURL;l.src=b.createObjectURL(a)}l.play(),hasSetupCamera=!0},function(a){g("Could not connect to camera"),console.log("Could not connect to camera",a)}),l.addEventListener("canplay",function(a){console.log("canplay",k,hasSetupCamera),k||(l.setAttribute("width",i),l.setAttribute("height",j),m.setAttribute("width",i),m.setAttribute("height",j),k=!0,d?(e=window.setInterval(h,100),f(e)):h())},!1)}function doStopVideoCam(a,b){null!=a&&window.clearInterval(a),b(null),document.querySelector("#camVideo").pause()}function hideDOMLabel(){var a=docById("textLabel");null!=a&&(a.style.display="none");var b=docById("numberLabel");null!=b&&(b.style.display="none")}function displayMsg(a,b){return}var hasSetupCamera=!1;