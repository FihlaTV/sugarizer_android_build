/*! Sugarizer 2016-12-28 */
function Logo(canvas,blocks,turtles,stage,refreshCanvas,textMsg,errorMsg,hideMsgs,onStopTurtle,onRunTurtle,prepareExport,getStageX,getStageY,getStageMouseDown,getCurrentKeyCode,clearCurrentKeyCode,meSpeak,saveLocally){this.canvas=canvas,this.blocks=blocks,this.turtles=turtles,this.stage=stage,this.refreshCanvas=refreshCanvas,this.textMsg=textMsg,this.errorMsg=errorMsg,this.hideMsgs=hideMsgs,this.onStopTurtle=onStopTurtle,this.onRunTurtle=onRunTurtle,this.prepareExport=prepareExport,this.getStageX=getStageX,this.getStageY=getStageY,this.getStageMouseDown=getStageMouseDown,this.getCurrentKeyCode=getCurrentKeyCode,this.clearCurrentKeyCode=clearCurrentKeyCode,this.meSpeak=meSpeak,this.saveLocally=saveLocally,this.evalFlowDict={},this.evalArgDict={},this.evalParameterDict={},this.evalSetterDict={},this.evalOnStartList={},this.evalOnStopList={},this.eventList={},this.boxes={},this.actions={},this.returns=[],this.turtleHeaps={},this.time=0,this.waitTimes={},this.turtleDelay=0,this.sounds=[],this.cameraID=null,this.stopTurtle=!1,this.lastKeyCode=null,this.saveTimeout=0,this.stepQueue={},this.unhighlightStepQueue={},this.svgOutput="",this.svgBackground=!0;try{this.mic=new p5.AudioIn}catch(a){console.log(NOMICERRORMSG),this.mic=null}this.turtleOscs={},this.setTurtleDelay=function(a){this.turtleDelay=a},this.step=function(){for(turtle in this.stepQueue)if(this.stepQueue[turtle].length>0){turtle in this.unhighlightStepQueue&&null!=this.unhighlightStepQueue[turtle]&&(this.blocks.unhighlight(this.unhighlightStepQueue[turtle]),this.unhighlightStepQueue[turtle]=null);var a=this.stepQueue[turtle].pop();null!=a&&this.runFromBlockNow(this,turtle,a,0,null)}},this.doStopTurtle=function(){this.stopTurtle=!0,this.turtles.markAsStopped();for(var a in this.sounds)this.sounds[a].stop();this.sounds=[],null!=this.cameraID&&doStopVideoCam(this.cameraID,this.setCameraID),this.onStopTurtle(),this.blocks.bringToTop(),this.stepQueue={},this.unhighlightQueue={}},this.clearParameterBlocks=function(){for(var a in this.blocks.blockList)this.blocks.blockList[a].parameter&&(this.blocks.blockList[a].text.text="",this.blocks.blockList[a].container.updateCache());this.refreshCanvas()},this.updateParameterBlock=function(logo,turtle,blk){if(this.blocks.blockList[blk].protoblock.parameter){var name=this.blocks.blockList[blk].name,value=0;switch(name){case"and":case"or":case"not":case"less":case"greater":case"equal":value=this.blocks.blockList[blk].value?_("true"):_("false");break;case"random":case"mod":case"sqrt":case"int":case"plus":case"minus":case"multiply":case"divide":value=this.blocks.blockList[blk].value;break;case"namedbox":var name=this.blocks.blockList[blk].privateData;name in this.boxes?value=this.boxes[name]:this.errorMsg(NOBOXERRORMSG,blk,name);break;case"box":var cblk=this.blocks.blockList[blk].connections[1],boxname=this.parseArg(logo,turtle,cblk,blk);boxname in this.boxes?value=this.boxes[boxname]:this.errorMsg(NOBOXERRORMSG,blk,boxname);break;case"x":value=this.turtles.turtleList[turtle].x;break;case"y":value=this.turtles.turtleList[turtle].y;break;case"heading":value=this.turtles.turtleList[turtle].orientation;break;case"color":case"hue":value=this.turtles.turtleList[turtle].color;break;case"shade":value=this.turtles.turtleList[turtle].value;break;case"grey":value=this.turtles.turtleList[turtle].chroma;break;case"pensize":value=this.turtles.turtleList[turtle].stroke;break;case"time":var d=new Date;value=(d.getTime()-this.time)/1e3;break;case"mousex":value=this.getStageX();break;case"mousey":value=this.getStageY();break;case"keyboard":value=this.lastKeyCode;break;case"loudness":null==logo.mic?(logo.errorMsg(NOMICERRORMSG),value=0):value=Math.round(1e3*logo.mic.getLevel());break;default:if(!(name in this.evalParameterDict))return;eval(this.evalParameterDict[name])}"string"==typeof value?(value.length>6&&(value=value.substr(0,5)+"..."),this.blocks.blockList[blk].text.text=value):this.blocks.blockList[blk].text.text=Math.round(value).toString(),this.blocks.blockList[blk].container.updateCache(),this.refreshCanvas()}},this.runLogoCommands=function(startHere,env){this.saveLocally();for(var arg in this.evalOnStartList)eval(this.evalOnStartList[arg]);this.stopTurtle=!1,this.blocks.unhighlightAll(),this.blocks.bringToTop(),this.hideMsgs();var d=new Date;this.time=d.getTime(),0==this.turtles.turtleList.length&&this.turtles.add(null);for(var turtle=0;turtle<this.turtles.turtleList.length;turtle++)this.waitTimes[turtle]=0;for(var turtle=0;turtle<this.turtles.turtleList.length;turtle++){for(var listener in this.turtles.turtleList[turtle].listeners)console.log("removing listener "+listener),this.stage.removeEventListener(listener,this.turtles.turtleList[turtle].listeners[listener],!1);this.turtles.turtleList[turtle].listeners={}}for(var blk=0;blk<this.blocks.blockList.length;blk++)null!=this.blocks.blockList[blk].label&&(this.blocks.blockList[blk].value=this.blocks.blockList[blk].label.value);for(var turtle=0;turtle<this.turtles.turtleList.length;turtle++)this.turtles.turtleList[turtle].container.x=this.turtles.turtleX2screenX(this.turtles.turtleList[turtle].x),this.turtles.turtleList[turtle].container.y=this.turtles.turtleY2screenY(this.turtles.turtleList[turtle].y);var startBlocks=[];this.blocks.findStacks(),this.actions={};for(var blk=0;blk<this.blocks.stackList.length;blk++)if("start"==this.blocks.blockList[this.blocks.stackList[blk]].name)this.blocks.blockList[this.blocks.stackList[blk]].trash||null!=this.blocks.blockList[this.blocks.stackList[blk]].connections[1]&&startBlocks.push(this.blocks.stackList[blk]);else if("action"==this.blocks.blockList[this.blocks.stackList[blk]].name){var c=this.blocks.blockList[this.blocks.stackList[blk]].connections[1],b=this.blocks.blockList[this.blocks.stackList[blk]].connections[2];null!=c&&null!=b&&(this.blocks.blockList[this.blocks.stackList[blk]].trash||(this.actions[this.blocks.blockList[c].value]=b))}this.svgOutput="",this.svgBackground=!0,this.parentFlowQueue={},this.unhightlightQueue={},this.parameterQueue={},0==this.turtleDelay&&this.clearParameterBlocks(),this.onRunTurtle();for(var turtle=0;turtle<this.turtles.turtleList.length;turtle++)this.turtles.turtleList[turtle].running=!1;if(null!=startHere){console.log("startHere is "+this.blocks.blockList[startHere].name);var turtle=0;if("start"==this.blocks.blockList[startHere].name){var turtle=this.blocks.blockList[startHere].value;console.log("starting on start with turtle "+turtle)}else console.log("starting on "+this.blocks.blockList[startHere].name+" with turtle "+turtle);this.turtles.turtleList[turtle].queue=[],this.parentFlowQueue[turtle]=[],this.unhightlightQueue[turtle]=[],this.parameterQueue[turtle]=[],this.turtles.turtleList[turtle].running=!0,this.runFromBlock(this,turtle,startHere,0,env)}else if(startBlocks.length>0)for(var b=0;b<startBlocks.length;b++){var turtle=this.blocks.blockList[startBlocks[b]].value;this.turtles.turtleList[turtle].queue=[],this.parentFlowQueue[turtle]=[],this.unhightlightQueue[turtle]=[],this.parameterQueue[turtle]=[],this.turtles.turtleList[turtle].trash||(console.log("running from turtle "+turtle),this.turtles.turtleList[turtle].running=!0,this.runFromBlock(this,turtle,startBlocks[b],0,env))}else{for(var turtle=null,t=0;t<this.turtles.turtleList.length;t++)if(!this.turtles.turtleList[t].trash){console.log("found turtle "+t),turtle=t;break}null==turtle&&(console.log("could not find a turtle"),turtle=this.turtles.turtleList.length,this.turtles.add(null)),this.turtles.turtleList.length<turtle+1&&(turtle=0),console.log("running with turtle "+turtle),this.turtles.turtleList[turtle].queue=[],this.parentFlowQueue[turtle]=[],this.unhightlightQueue[turtle]=[],this.parameterQueue[turtle]=[];for(var blk=0;blk<this.blocks.stackList.length;blk++)if(!this.blocks.blockList[blk].isNoRunBlock()&&!this.blocks.blockList[this.blocks.stackList[blk]].trash){if("start"==this.blocks.blockList[this.blocks.stackList[blk]].name&&null==this.blocks.blockList[this.blocks.stackList[blk]].connections[1])continue;this.turtles.turtleList[0].running=!0,this.runFromBlock(this,0,this.blocks.stackList[blk],0,env)}}this.refreshCanvas()},this.runFromBlock=function(a,b,c,d,e){if(null!=c){var f=a.turtleDelay+a.waitTimes[b];a.waitTimes[b]=0,a.stopTurtle||(a.turtleDelay==TURTLESTEP?(b in a.stepQueue||(a.stepQueue[b]=[]),a.stepQueue[b].push(c)):setTimeout(function(){a.runFromBlockNow(a,b,c,d,e)},f))}},this.blockSetter=function(blk,value,turtleId){var turtle=this.turtles.turtleList[turtleId];switch(this.blocks.blockList[blk].name){case"x":turtle.doSetXY(value,turtle.x);break;case"y":turtle.doSetXY(turtle.y,value);break;case"heading":turtle.doSetHeading(value);break;case"color":turtle.doSetColor(value);break;case"shade":turtle.doSetValue(value);break;case"grey":turtle.doSetChroma(value);break;case"pensize":turtle.doSetPensize(value);break;case"namedbox":var name=this.blocks.blockList[blk].privateData;name in this.boxes?this.boxes[name]=value:this.errorMsg(NOBOXERRORMSG,blk,name);break;case"box":var cblk=this.blocks.blockList[blk].connections[1],name=this.parseArg(this,turtle,cblk,blk);name in this.boxes?this.boxes[name]=value:this.errorMsg(NOBOXERRORMSG,blk,name);break;default:if(this.blocks.blockList[blk].name in this.evalSetterDict){eval(this.evalSetterDict[this.blocks.blockList[blk].name]);break}this.errorMsg("Block does not support incrementing",blk)}},this.runFromBlockNow=function(logo,turtle,blk,isflow,receivedArg){function ValidURL(a){var b=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return!!b.test(a)||(logo.errorMsg("Please enter a valid URL."),!1)}function downloadFile(a,b,c){var d=document.createElement("a");d.setAttribute("href","data:"+b+";charset-utf-8,"+c),d.setAttribute("download",a),document.body.appendChild(d),d.click(),document.body.removeChild(d)}var args=[];if(logo.blocks.blockList[blk].protoblock.args>0)for(var i=1;i<logo.blocks.blockList[blk].protoblock.args+1;i++)args.push(logo.parseArg(logo,turtle,logo.blocks.blockList[blk].connections[i],blk,receivedArg));if(logo.blocks.blockList[blk].isValueBlock())var nextFlow=null;else{var nextFlow=last(logo.blocks.blockList[blk].connections),queueBlock=new Queue(nextFlow,1,blk,receivedArg);null!=nextFlow&&logo.turtles.turtleList[turtle].queue.push(queueBlock)}var childFlow=null,childFlowCount=0,actionArgs=[];switch(0!=logo.turtleDelay&&logo.blocks.highlight(blk,!1),logo.blocks.blockList[blk].name){case"dispatch":if(1==args.length){if(!(args[0]in logo.eventList)){var event=new Event(args[0]);logo.eventList[args[0]]=event}logo.stage.dispatchEvent(args[0])}break;case"listen":if(2==args.length)if(args[1]in logo.actions){var listener=function(a){if(logo.turtles.turtleList[turtle].running){var b=new Queue(logo.actions[args[1]],1,blk);logo.parentFlowQueue[turtle].push(blk),logo.turtles.turtleList[turtle].queue.push(b)}else isflow?logo.runFromBlockNow(logo,turtle,logo.actions[args[1]],isflow,receivedArg):logo.runFromBlock(logo,turtle,logo.actions[args[1]],isflow,receivedArg)};args[0]in logo.turtles.turtleList[turtle].listeners&&logo.stage.removeEventListener(args[0],logo.turtles.turtleList[turtle].listeners[args[0]],!1),logo.turtles.turtleList[turtle].listeners[args[0]]=listener,logo.stage.addEventListener(args[0],listener,!1)}else logo.errorMsg(NOACTIONERRORMSG,blk,args[1]),logo.stopTurtle=!0;break;case"start":1==args.length&&(childFlow=args[0],childFlowCount=1);break;case"nameddo":var name=logo.blocks.blockList[blk].privateData;name in logo.actions?(childFlow=logo.actions[name],childFlowCount=1):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"action":case"do":1==args.length&&(args[0]in logo.actions?(childFlow=logo.actions[args[0]],childFlowCount=1):(logo.errorMsg(NOACTIONERRORMSG,blk,args[0]),logo.stopTurtle=!0));break;case"nameddoArg":for(var name=logo.blocks.blockList[blk].privateData;actionArgs.length>0;)actionArgs.pop();if(logo.blocks.blockList[blk].argClampSlots.length>0)for(var i=0;i<logo.blocks.blockList[blk].argClampSlots.length;i++){var t=logo.parseArg(logo,turtle,logo.blocks.blockList[blk].connections[i+1],blk,receivedArg);actionArgs.push(t)}name in logo.actions?(childFlow=logo.actions[name],childFlowCount=1):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"doArg":for(;actionArgs.length>0;)actionArgs.pop();if(logo.blocks.blockList[blk].argClampSlots.length>0)for(var i=0;i<logo.blocks.blockList[blk].argClampSlots.length;i++){var t=logo.parseArg(logo,turtle,logo.blocks.blockList[blk].connections[i+2],blk,receivedArg);actionArgs.push(t)}args.length>=1&&(args[0]in logo.actions?(actionName=args[0],childFlow=logo.actions[args[0]],childFlowCount=1):(logo.errorMsg(NOACTIONERRORMSG,blk,args[0]),logo.stopTurtle=!0));break;case"forever":1==args.length&&(childFlow=args[0],childFlowCount=-1);break;case"break":logo.doBreak(turtle);var parentBlk=logo.blocks.blockList[blk].connections[0];null!=parentBlk&&logo.unhightlightQueue[turtle].push(parentBlk);break;case"wait":1==args.length&&logo.doWait(turtle,args[0]);break;case"print":1==args.length&&logo.textMsg(args[0].toString());break;case"speak":1==args.length&&logo.meSpeak&&logo.meSpeak.speak(args[0]);break;case"repeat":2==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):(childFlow=args[1],childFlowCount=Math.floor(args[0])));break;case"clamp":1==args.length&&(childFlow=args[0],childFlowCount=1);break;case"until":if(2==args.length)if(childFlow=args[1],childFlowCount=1,args[0])for(var queueLength=logo.turtles.turtleList[turtle].queue.length,i=queueLength-1;i>0;i--)logo.turtles.turtleList[turtle].queue[i].parentBlk==blk&&logo.turtles.turtleList[turtle].queue.pop();else{var queueLength=logo.turtles.turtleList[turtle].queue.length;queueLength>0&&logo.turtles.turtleList[turtle].queue[queueLength-1].parentBlk==blk&&logo.turtles.turtleList[turtle].queue.pop();var parentBlk=logo.blocks.blockList[blk].connections[0],queueBlock=new Queue(blk,1,parentBlk);logo.parentFlowQueue[turtle].push(parentBlk),logo.turtles.turtleList[turtle].queue.push(queueBlock)}break;case"waitFor":if(1==args.length)if(args[0])for(var queueLength=logo.turtles.turtleList[turtle].queue.length,i=queueLength-1;i>0;i--)logo.turtles.turtleList[turtle].queue[i].parentBlk==blk&&logo.turtles.turtleList[turtle].queue.pop();else{var parentBlk=logo.blocks.blockList[blk].connections[0],queueBlock=new Queue(blk,1,parentBlk);logo.parentFlowQueue[turtle].push(parentBlk),logo.turtles.turtleList[turtle].queue.push(queueBlock),logo.doWait(.05)}break;case"if":2==args.length&&args[0]&&(childFlow=args[1],childFlowCount=1);break;case"ifthenelse":3==args.length&&(args[0]?(childFlow=args[1],childFlowCount=1):(childFlow=args[2],childFlowCount=1));break;case"while":if(2==args.length)if(args[0]){var queueLength=logo.turtles.turtleList[turtle].queue.length;queueLength>0&&logo.turtles.turtleList[turtle].queue[queueLength-1].parentBlk==blk&&logo.turtles.turtleList[turtle].queue.pop();var parentBlk=logo.blocks.blockList[blk].connections[0],queueBlock=new Queue(blk,1,parentBlk);logo.parentFlowQueue[turtle].push(parentBlk),logo.turtles.turtleList[turtle].queue.push(queueBlock),childFlow=args[1],childFlowCount=1}else for(var queueLength=logo.turtles.turtleList[turtle].queue.length,i=queueLength-1;i>0;i--)logo.turtles.turtleList[turtle].queue[i].parentBlk==blk&&logo.turtles.turtleList[turtle].queue.pop();break;case"storein":2==args.length&&(logo.boxes[args[0]]=args[1]);break;case"incrementOne":var i=1;case"increment":if(2==args.length)var i=args[1];if(args.length>=1){var settingBlk=logo.blocks.blockList[blk].connections[1];logo.blockSetter(settingBlk,args[0]+i,turtle)}break;case"clear":logo.svgBackground=!0,logo.turtles.turtleList[turtle].doClear();break;case"setxy":2==args.length&&("string"==typeof args[0]||"string"==typeof args[1]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetXY(args[0],args[1]));break;case"arc":2==args.length&&("string"==typeof args[0]||"string"==typeof args[1]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doArc(args[0],args[1]));break;case"return":1==args.length&&logo.returns.push(args[0]);break;case"returnToUrl":var URL=window.location.href,urlParts,outurl;if(URL.indexOf("?")>0){var urlParts=URL.split("?");if(urlParts[1].indexOf("&")>0)for(var newUrlParts=urlParts[1].split("&"),i=0;i<newUrlParts.length;i++)if(newUrlParts[i].indexOf("=")>0){var tempargs=newUrlParts[i].split("=");switch(tempargs[0].toLowerCase()){case"outurl":outurl=tempargs[1]}}}if(1==args.length){var jsonRet={};jsonRet.result=args[0];var json=JSON.stringify(jsonRet),xmlHttp=new XMLHttpRequest;xmlHttp.open("POST",outurl,!0),xmlHttp.onreadystatechange=function(){4==xmlHttp.readyState&&200==xmlHttp.status&&alert(xmlHttp.responseText)},xmlHttp.send(json)}break;case"forward":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doForward(args[0]));break;case"back":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doForward(-args[0]));break;case"right":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doRight(args[0]));break;case"left":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doRight(-args[0]));break;case"setheading":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetHeading(args[0]));break;case"show":if(2==args.length)if("string"==typeof args[1]){var len=args[1].length;14==len&&args[1].substr(0,14)==CAMERAVALUE?doUseCamera(args,logo.turtles,turtle,!1,logo.cameraID,logo.setCameraID,logo.errorMsg):13==len&&args[1].substr(0,13)==VIDEOVALUE?doUseCamera(args,logo.turtles,turtle,!0,logo.cameraID,logo.setCameraID,logo.errorMsg):len>10&&"data:image"==args[1].substr(0,10)?logo.turtles.turtleList[turtle].doShowImage(args[0],args[1]):len>8&&"https://"==args[1].substr(0,8)?logo.turtles.turtleList[turtle].doShowURL(args[0],args[1]):len>7&&"http://"==args[1].substr(0,7)?logo.turtles.turtleList[turtle].doShowURL(args[0],args[1]):len>7&&"file://"==args[1].substr(0,7)?logo.turtles.turtleList[turtle].doShowURL(args[0],args[1]):logo.turtles.turtleList[turtle].doShowText(args[0],args[1])}else"object"==typeof args[1]&&"loadFile"==logo.blocks.blockList[logo.blocks.blockList[blk].connections[2]].name?args[1]?logo.turtles.turtleList[turtle].doShowText(args[0],args[1][1]):logo.errorMsg(_("You must select a file.")):logo.turtles.turtleList[turtle].doShowText(args[0],args[1]);break;case"turtleshell":2==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doTurtleShell(args[0],args[1]));break;case"setcolor":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetColor(args[0]));break;case"setfont":1==args.length&&("string"==typeof args[0]?logo.turtles.turtleList[turtle].doSetFont(args[0]):(logo.errorMsg(NOSTRINGERRORMSG,blk),logo.stopTurtle=!0));break;case"sethue":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetHue(args[0]));break;case"setshade":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetValue(args[0]));break;case"setgrey":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetChroma(args[0]));break;case"setpensize":1==args.length&&("string"==typeof args[0]?(logo.errorMsg(NANERRORMSG,blk),logo.stopTurtle=!0):logo.turtles.turtleList[turtle].doSetPensize(args[0]));break;case"beginfill":logo.turtles.turtleList[turtle].doStartFill();break;case"endfill":logo.turtles.turtleList[turtle].doEndFill();break;case"beginhollowline":logo.turtles.turtleList[turtle].doStartHollowLine();break;case"endhollowline":logo.turtles.turtleList[turtle].doEndHollowLine();break;case"fillscreen":if(3==args.length){var hue=logo.turtles.turtleList[turtle].color,value=logo.turtles.turtleList[turtle].value,chroma=logo.turtles.turtleList[turtle].chroma;logo.turtles.turtleList[turtle].doSetHue(args[0]),logo.turtles.turtleList[turtle].doSetValue(args[1]),logo.turtles.turtleList[turtle].doSetChroma(args[2]),logo.setBackgroundColor(turtle),logo.turtles.turtleList[turtle].doSetHue(hue),logo.turtles.turtleList[turtle].doSetValue(value),logo.turtles.turtleList[turtle].doSetChroma(chroma)}break;case"nobackground":logo.svgBackground=!1;break;case"background":logo.setBackgroundColor(turtle);break;case"penup":logo.turtles.turtleList[turtle].doPenUp();break;case"pendown":logo.turtles.turtleList[turtle].doPenDown();break;case"openProject":if(url=args[0],ValidURL(url)){var win=window.open(url,"_blank");win?win.focus():alert("Please allow popups for this site")}break;case"vspace":break;case"playback":sound=new Howl({urls:[args[0]]}),logo.sounds.push(sound),sound.play();break;case"stopplayback":for(sound in logo.sounds)logo.sounds[sound].stop();logo.sounds=[];break;case"stopvideocam":null!=cameraID&&doStopVideoCam(logo.cameraID,logo.setCameraID);break;case"startTurtle":var startHere=logo.getTargetTurtle(args);if(startHere){var targetTurtle=logo.blocks.blockList[startHere].value;if(logo.turtles.turtleList[targetTurtle].running){logo.errorMsg("Turtle is already running.",blk);break}logo.turtles.turtleList[targetTurtle].queue=[],logo.turtles.turtleList[targetTurtle].running=!0,logo.parentFlowQueue[targetTurtle]=[],logo.unhightlightQueue[targetTurtle]=[],logo.parameterQueue[targetTurtle]=[],runFromBlock(logo,targetTurtle,startHere,isflow,receivedArg)}else logo.errorMsg("Cannot find turtle: "+args[0],blk);break;case"stopTurtle":var startHere=logo.getTargetTurtle(args),targetTurtle=logo.blocks.blockList[startHere].value;logo.turtles.turtleList[targetTurtle].queue=[],logo.parentFlowQueue[targetTurtle]=[],logo.unhightlightQueue[targetTurtle]=[],logo.parameterQueue[targetTurtle]=[],logo.doBreak(targetTurtle);break;case"showblocks":logo.showBlocks(),logo.setTurtleDelay(DEFAULTDELAY);break;case"hideblocks":logo.hideBlocks(),logo.setTurtleDelay(0);break;case"savesvg":1==args.length&&(logo.svgBackground&&(logo.svgOutput='<rect x="0" y="0" height="'+this.canvas.height+'" width="'+this.canvas.width+'" fill="'+body.style.background+'"/>\n'+logo.svgOutput),doSaveSVG(logo,args[0]));break;case"tone":"undefined"==typeof logo.turtleOscs[turtle]&&(logo.turtleOscs[turtle]=new p5.TriOsc),osc=logo.turtleOscs[turtle],osc.stop(),osc.start(),osc.amp(0),osc.freq(args[0]),osc.fade(.5,.2),setTimeout(function(a){a.fade(0,.2)},args[1],osc);break;case"showHeap":turtle in logo.turtleHeaps||(logo.turtleHeaps[turtle]=[]),logo.textMsg(JSON.stringify(logo.turtleHeaps[turtle]));break;case"emptyHeap":logo.turtleHeaps[turtle]=[];break;case"push":1==args.length&&(turtle in logo.turtleHeaps||(logo.turtleHeaps[turtle]=[]),logo.turtleHeaps[turtle].push(args[0]));break;case"saveHeap":args[0]&&turtle in logo.turtleHeaps&&downloadFile(args[0],"text/json",JSON.stringify(logo.turtleHeaps[turtle]));break;case"loadHeap":var block=logo.blocks.blockList[blk];if(turtle in logo.turtleHeaps)var oldHeap=logo.turtleHeaps[turtle];else var oldHeap=[];var c=block.connections[1];if(null!=c&&"loadFile"==blocks.blockList[c].name)if(1!=args.length)logo.errorMsg(_("You need to select a file."));else try{if(console.log(blocks.blockList[c].value),logo.turtleHeaps[turtle]=JSON.parse(blocks.blockList[c].value[1]),!Array.isArray(logo.turtleHeaps[turtle]))throw"is not array"}catch(a){logo.turtleHeaps[turtle]=oldHeap,logo.errorMsg(_("The file you selected does not contain a valid heap."))}else logo.errorMsg(_("The loadHeap block needs a loadFile block."));break;case"loadHeapFromApp":var data=[],url=args[1],name=args[0],xmlHttp=new XMLHttpRequest;if(xmlHttp.open("GET",url,!1),xmlHttp.send(),4!=xmlHttp.readyState||200!=xmlHttp.status){if(4==xmlHttp.readyState&&200!=xmlHttp.status){console.log("fetched the wrong page or network error..."),logo.errorMsg(_("404: Page not found"));break}logo.errorMsg("xmlHttp.readyState: "+xmlHttp.readyState);break}console.log(xmlHttp.responseText);try{var data=JSON.parse(xmlHttp.responseText)}catch(a){console.log(a),logo.errorMsg(_("Error parsing JSON data:")+a)}if(name in logo.turtleHeaps)var oldHeap=turtleHeaps[turtle];else var oldHeap=[];logo.turtleHeaps[name]=data;break;case"saveHeapToApp":var name=args[0],url=args[1];if(name in logo.turtleHeaps){var data=JSON.stringify(logo.turtleHeaps[name]),xmlHttp=new XMLHttpRequest;xmlHttp.open("POST",url,!0),xmlHttp.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xmlHttp.send(data)}else logo.errorMsg(_("turtleHeaps does not contain a valid heap for "+name));break;case"setHeapEntry":if(2==args.length){turtle in logo.turtleHeaps||(logo.turtleHeaps[turtle]=[]);var idx=Math.floor(args[0]);for(idx<1&&logo.errorMsg(_("Index must be > 0."));logo.turtleHeaps[turtle].length<idx;)logo.turtleHeaps[turtle].push(null);logo.turtleHeaps[turtle][idx-1]=args[1]}break;default:logo.blocks.blockList[blk].name in logo.evalFlowDict?eval(logo.evalFlowDict[logo.blocks.blockList[blk].name]):(console.log("running an arg block?"),logo.blocks.blockList[blk].isArgBlock()?(args.push(logo.parseArg(logo,turtle,blk)),console.log("block: "+blk+" turtle: "+turtle),console.log("block name: "+logo.blocks.blockList[blk].name),console.log("block value: "+logo.blocks.blockList[blk].value),null==logo.blocks.blockList[blk].value?logo.textMsg("null block value"):logo.textMsg(logo.blocks.blockList[blk].value.toString())):logo.errorMsg("I do not know how to "+logo.blocks.blockList[blk].name+".",blk),logo.stopTurtle=!0)}if(null!=childFlow){if("doArg"==logo.blocks.blockList[blk].name||"nameddoArg"==logo.blocks.blockList[blk].name)var queueBlock=new Queue(childFlow,childFlowCount,blk,actionArgs);else var queueBlock=new Queue(childFlow,childFlowCount,blk,receivedArg);logo.parentFlowQueue[turtle].push(blk),logo.turtles.turtleList[turtle].queue.push(queueBlock)}var nextBlock=null;if(logo.turtles.turtleList[turtle].queue.length>0&&(nextBlock=last(logo.turtles.turtleList[turtle].queue).blk,passArg=last(logo.turtles.turtleList[turtle].queue).args,1==last(logo.turtles.turtleList[turtle].queue).count?logo.turtles.turtleList[turtle].queue.pop():last(logo.turtles.turtleList[turtle].queue).count-=1),null!=nextBlock){if(parentBlk=null,logo.turtles.turtleList[turtle].queue.length>0&&(parentBlk=last(logo.turtles.turtleList[turtle].queue).parentBlk),parentBlk!=blk&&(logo.turtleDelay==TURTLESTEP?logo.unhighlightStepQueue[turtle]=blk:logo.turtleDelay>0&&setTimeout(function(){logo.blocks.unhighlight(blk)},logo.turtleDelay+logo.waitTimes[turtle])),null==last(logo.blocks.blockList[blk].connections)&&(logo.parentFlowQueue[turtle].length>0&&logo.turtles.turtleList[turtle].queue.length>0&&last(logo.turtles.turtleList[turtle].queue).parentBlk!=last(logo.parentFlowQueue[turtle])?logo.unhightlightQueue[turtle].push(logo.parentFlowQueue[turtle].pop()):logo.unhightlightQueue[turtle].length>0&&0!=logo.turtleDelay&&setTimeout(function(){logo.blocks.unhighlight(logo.unhightlightQueue[turtle].pop())},logo.turtleDelay)),0!=logo.turtleDelay)for(var pblk in logo.parameterQueue[turtle])logo.updateParameterBlock(logo,turtle,logo.parameterQueue[turtle][pblk]);isflow?logo.runFromBlockNow(logo,turtle,nextBlock,isflow,passArg):logo.runFromBlock(logo,turtle,nextBlock,isflow,passArg)}else{logo.turtles.turtleList[turtle].closeSVG(),logo.turtles.turtleList[turtle].running=!1,logo.turtles.running()||logo.onStopTurtle(),0!=logo.turtles.turtleList[turtle].queue.length&&blk==last(logo.turtles.turtleList[turtle].queue).parentBlk||setTimeout(function(){logo.blocks.unhighlight(blk)},logo.turtleDelay);for(var b in logo.parentFlowQueue[turtle])logo.blocks.unhighlight(logo.parentFlowQueue[turtle][b]);var i=logo.stage.getNumChildren()-1;logo.stage.setChildIndex(logo.turtles.turtleList[turtle].container,i),logo.refreshCanvas();for(var arg in logo.evalOnStopList)eval(logo.evalOnStopList[arg])}clearTimeout(this.saveTimeout);var me=this;this.saveTimeout=setTimeout(function(){me.saveLocally()},1.5*DEFAULTDELAY)},this.getTargetTurtle=function(a){if("string"==typeof a[0])var b=parseInt(a[0]);else var b=a[0];var c=null;for(var d in this.blocks.blockList){var e=this.blocks.blockList[d].name,f=this.blocks.blockList[d].value;if("start"==e&&f==b){c=d;break}}return c},this.loopBlock=function(a){return["forever","repeat","while","until"].indexOf(a)!=-1},this.doBreak=function(a){for(var b=null,c=-1,d=this.turtles.turtleList[a].queue.length,e=d-1;e>-1;e--){if(this.loopBlock(this.blocks.blockList[this.turtles.turtleList[a].queue[e].blk].name)){c=this.turtles.turtleList[a].queue[e].blk,b=this.blocks.blockList[c],this.turtles.turtleList[a].queue.pop();break}if(this.loopBlock(this.blocks.blockList[this.turtles.turtleList[a].queue[e].parentBlk].name)){c=this.turtles.turtleList[a].queue[e].parentBlk,b=this.blocks.blockList[c],this.turtles.turtleList[a].queue.pop();break}}if(null==b)return void this.turtles.turtleList[a].queue.pop();if("while"==b.name||"until"==b.name){var f=last(b.connections);if(null!=f){var g=new Queue(f,1,c);this.parentFlowQueue[a].push(c),this.turtles.turtleList[a].queue.push(g)}}},this.parseArg=function(logo,turtle,blk,parentBlk,receivedArg){if(null==blk)return logo.errorMsg("Missing argument.",parentBlk),logo.stopTurtle=!0,null;if(logo.blocks.blockList[blk].protoblock.parameter&&logo.parameterQueue[turtle].indexOf(blk)==-1&&logo.parameterQueue[turtle].push(blk),logo.blocks.blockList[blk].isValueBlock()){if("number"==logo.blocks.blockList[blk].name&&"string"==typeof logo.blocks.blockList[blk].value)try{logo.blocks.blockList[blk].value=Number(logo.blocks.blockList[blk].value)}catch(a){console.log(a)}return logo.blocks.blockList[blk].value}if(logo.blocks.blockList[blk].isArgBlock()){switch(logo.blocks.blockList[blk].name){case"loudness":logo.mic.enabled?logo.blocks.blockList[blk].value=Math.round(1e3*logo.mic.getLevel()):(logo.mic.start(),logo.blocks.blockList[blk].value=0);break;case"eval":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=Number(eval(a.replace(/x/g,b.toString())));break;case"calc":var action_args=[],cblk=logo.blocks.blockList[blk].connections[1],name=logo.parseArg(logo,turtle,cblk,blk,receivedArg);action_args=receivedArg,name in logo.actions?(logo.runFromBlockNow(logo,turtle,logo.actions[name],!0,action_args),logo.blocks.blockList[blk].value=logo.returns.shift()):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"namedcalc":var name=logo.blocks.blockList[blk].privateData,action_args=[];name in logo.actions?(logo.runFromBlockNow(logo,turtle,logo.actions[name],!0,action_args),logo.blocks.blockList[blk].value=logo.returns.shift()):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"arg":var cblk=logo.blocks.blockList[blk].connections[1],name=logo.parseArg(logo,turtle,cblk,blk,receivedArg),action_args=receivedArg;if(action_args.length>=Number(name)){var value=action_args[Number(name)-1];logo.blocks.blockList[blk].value=value}else logo.errorMsg("Invalid argument",blk),logo.stopTurtle=!0;return logo.blocks.blockList[blk].value;case"box":var cblk=logo.blocks.blockList[blk].connections[1],name=logo.parseArg(logo,turtle,cblk,blk,receivedArg);name in logo.boxes?logo.blocks.blockList[blk].value=logo.boxes[name]:(logo.errorMsg(NOBOXERRORMSG,blk,name),logo.stopTurtle=!0,logo.blocks.blockList[blk].value=null);
break;case"turtlename":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].name;break;case"namedbox":var name=logo.blocks.blockList[blk].privateData;name in logo.boxes?logo.blocks.blockList[blk].value=logo.boxes[name]:(logo.errorMsg(NOBOXERRORMSG,blk,name),logo.stopTurtle=!0,logo.blocks.blockList[blk].value=null);break;case"namedarg":var name=logo.blocks.blockList[blk].privateData,action_args=receivedArg;if(action_args.length>=Number(name)){var value=action_args[Number(name)-1];logo.blocks.blockList[blk].value=value}else logo.errorMsg("Invalid argument",blk);return logo.blocks.blockList[blk].value;case"sqrt":var cblk=logo.blocks.blockList[blk].connections[1],a=logo.parseArg(logo,turtle,cblk,blk,receivedArg);a<0&&(logo.errorMsg(NOSQRTERRORMSG,blk),logo.stopTurtle=!0,a=-a),logo.blocks.blockList[blk].value=logo.doSqrt(a);break;case"int":var cblk=logo.blocks.blockList[blk].connections[1],a=logo.parseArg(logo,turtle,cblk,blk,receivedArg);logo.blocks.blockList[blk].value=Math.floor(a);break;case"mod":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doMod(a,b);break;case"not":var cblk=logo.blocks.blockList[blk].connections[1],a=logo.parseArg(logo,turtle,cblk,blk,receivedArg);logo.blocks.blockList[blk].value=!a;break;case"greater":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=Number(a)>Number(b);break;case"equal":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=a==b;break;case"less":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg),result=Number(a)<Number(b);logo.blocks.blockList[blk].value=result;break;case"random":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doRandom(a,b);break;case"oneOf":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doOneOf(a,b);break;case"plus":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doPlus(a,b);break;case"multiply":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doMultiply(a,b);break;case"divide":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doDivide(a,b);break;case"minus":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doMinus(a,b);break;case"neg":var cblk1=logo.blocks.blockList[blk].connections[1],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg);logo.blocks.blockList[blk].value=logo.doMinus(0,a);break;case"myclick":logo.blocks.blockList[blk].value="click"+logo.turtles.turtleList[turtle].name;break;case"heading":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].orientation;break;case"x":logo.blocks.blockList[blk].value=logo.turtles.screenX2turtleX(logo.turtles.turtleList[turtle].container.x);break;case"y":logo.blocks.blockList[blk].value=logo.turtles.screenY2turtleY(logo.turtles.turtleList[turtle].container.y);break;case"xturtle":case"yturtle":for(var cblk=logo.blocks.blockList[blk].connections[1],targetTurtle=logo.parseArg(logo,turtle,cblk,blk,receivedArg),i=0;i<logo.turtles.turtleList.length;i++){var logoTurtle=logo.turtles.turtleList[i];if(targetTurtle==logoTurtle.name){"yturtle"==logo.blocks.blockList[blk].name?logo.blocks.blockList[blk].value=logo.turtles.screenY2turtleY(logoTurtle.container.y):logo.blocks.blockList[blk].value=logo.turtles.screenX2turtleX(logoTurtle.container.x);break}}i==logo.turtles.turtleList.length&&(logo.errorMsg("Could not find turtle "+targetTurtle,blk),logo.blocks.blockList[blk].value=0);break;case"color":case"hue":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].color;break;case"shade":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].value;break;case"grey":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].chroma;break;case"pensize":logo.blocks.blockList[blk].value=logo.turtles.turtleList[turtle].stroke;break;case"and":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=a&&b;break;case"or":var cblk1=logo.blocks.blockList[blk].connections[1],cblk2=logo.blocks.blockList[blk].connections[2],a=logo.parseArg(logo,turtle,cblk1,blk,receivedArg),b=logo.parseArg(logo,turtle,cblk2,blk,receivedArg);logo.blocks.blockList[blk].value=a||b;break;case"time":var d=new Date;logo.blocks.blockList[blk].value=(d.getTime()-logo.time)/1e3;break;case"hspace":var cblk=logo.blocks.blockList[blk].connections[1],v=logo.parseArg(logo,turtle,cblk,blk,receivedArg);logo.blocks.blockList[blk].value=v;break;case"mousex":logo.blocks.blockList[blk].value=logo.getStageX();break;case"mousey":logo.blocks.blockList[blk].value=logo.getStageY();break;case"mousebutton":logo.blocks.blockList[blk].value=logo.getStageMouseDown();break;case"keyboard":logo.lastKeyCode=logo.getCurrentKeyCode(),logo.blocks.blockList[blk].value=logo.lastKeyCode,logo.clearCurrentKeyCode();break;case"getcolorpixel":var wasVisible=logo.turtles.turtleList[turtle].container.visible;logo.turtles.turtleList[turtle].container.visible=!1;var x=logo.turtles.turtleList[turtle].container.x,y=logo.turtles.turtleList[turtle].container.y;logo.refreshCanvas();var ctx=this.canvas.getContext("2d"),imgData=ctx.getImageData(x,y,1,1).data,color=searchColors(imgData[0],imgData[1],imgData[2]);0==imgData[3]&&(color=body.style.background.substring(body.style.background.indexOf("(")+1,body.style.background.lastIndexOf(")")).split(/,\s*/),color=searchColors(color[0],color[1],color[2])),logo.blocks.blockList[blk].value=color,wasVisible&&(logo.turtles.turtleList[turtle].container.visible=!0);break;case"loadFile":break;case"tofrequency":var block=logo.blocks.blockList[blk],cblk=block.connections[1],v=logo.parseArg(logo,turtle,cblk,blk,receivedArg);try{if("string"==typeof v){v=v.toUpperCase();var note=["A","A♯/B♭","B","C","C♯/D♭","D","D♯/E♭","E","F","F♯/G♭","G","G♯/A♭"].indexOf(v[0]),octave=v[1];note>2&&(octave-=1);var i=12*octave+note;block.value=27.5*Math.pow(1.05946309435929,i)}else block.value=440*Math.pow(2,(v-69)/12)}catch(a){this.errorMsg(v+" is not a note."),block.value=440}break;case"pop":var block=logo.blocks.blockList[blk];turtle in logo.turtleHeaps&&logo.turtleHeaps[turtle].length>0?block.value=logo.turtleHeaps[turtle].pop():(logo.errorMsg(_("empty heap")),block.value=null);break;case"indexHeap":var block=logo.blocks.blockList[blk],cblk=logo.blocks.blockList[blk].connections[1],a=logo.parseArg(logo,turtle,cblk,blk,receivedArg);turtle in logo.turtleHeaps||(logo.turtleHeaps[turtle]=[]);for(;logo.turtleHeaps[turtle].length<a;)logo.turtleHeaps[turtle].push(null);block.value=logo.turtleHeaps[turtle][a-1];break;case"heapLength":var block=logo.blocks.blockList[blk];turtle in logo.turtleHeaps||(logo.turtleHeaps[turtle]=[]),console.log(logo.turtleHeaps[turtle].length),block.value=logo.turtleHeaps[turtle].length;break;case"heapEmpty":var block=logo.blocks.blockList[blk];turtle in logo.turtleHeaps?block.value=0==logo.turtleHeaps[turtle].length:block.value=!0;break;default:logo.blocks.blockList[blk].name in logo.evalArgDict?eval(logo.evalArgDict[logo.blocks.blockList[blk].name]):console.log("ERROR: I do not know how to "+logo.blocks.blockList[blk].name)}return logo.blocks.blockList[blk].value}if(logo.blocks.blockList[blk].isArgClamp()){switch(logo.blocks.blockList[blk].name){case"namedcalcArg":var name=logo.blocks.blockList[blk].privateData,action_args=[];if(logo.blocks.blockList[blk].argClampSlots.length>0)for(var i=0;i<logo.blocks.blockList[blk].argClampSlots.length;i++){var t=logo.parseArg(logo,turtle,logo.blocks.blockList[blk].connections[i+1],blk,receivedArg);action_args.push(t)}name in logo.actions?(logo.runFromBlockNow(logo,turtle,logo.actions[name],!0,action_args),logo.blocks.blockList[blk].value=logo.returns.pop()):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"calcArg":var action_args=[];if(logo.blocks.blockList[blk].argClampSlots.length>0)for(var i=0;i<logo.blocks.blockList[blk].argClampSlots.length;i++){var t=logo.parseArg(logo,turtle,logo.blocks.blockList[blk].connections[i+2],blk,receivedArg);action_args.push(t)}var cblk=logo.blocks.blockList[blk].connections[1],name=logo.parseArg(logo,turtle,cblk,blk,receivedArg);name in logo.actions?(logo.runFromBlockNow(logo,turtle,logo.actions[name],!0,action_args),logo.blocks.blockList[blk].value=logo.returns.pop()):(logo.errorMsg(NOACTIONERRORMSG,blk,name),logo.stopTurtle=!0);break;case"nameddoArg":return blk;case"doArg":return blk;default:logo.blocks.blockList[blk].name in logo.evalArgDict?eval(logo.evalArgDict[logo.blocks.blockList[blk].name]):console.log("ERROR: I do not know how to "+logo.blocks.blockList[blk].name)}return logo.blocks.blockList[blk].value}return blk},this.doWait=function(a,b){this.waitTimes[a]=1e3*Number(b)},this.doRandom=function(a,b){return"string"==typeof a||"string"==typeof b?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):Math.floor(Math.random()*(Number(b)-Number(a)+1)+Number(a))},this.doOneOf=function(a,b){return Math.random()<.5?a:b},this.doMod=function(a,b){return"string"==typeof a||"string"==typeof b?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):Number(a)%Number(b)},this.doSqrt=function(a){return"string"==typeof a?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):Math.sqrt(Number(a))},this.doPlus=function(a,b){if("string"==typeof a||"string"==typeof b){if("string"==typeof a)var c=a;else var c=a.toString();if("string"==typeof b)var d=b;else var d=b.toString();return c+d}return Number(a)+Number(b)},this.doMinus=function(a,b){return"string"==typeof a||"string"==typeof b?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):Number(a)-Number(b)},this.doMultiply=function(a,b){return"string"==typeof a||"string"==typeof b?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):Number(a)*Number(b)},this.doDivide=function(a,b){return"string"==typeof a||"string"==typeof b?(this.errorMsg(NANERRORMSG),this.stopTurtle=!0,0):0==Number(b)?(this.errorMsg(ZERODIVIDEERRORMSG),this.stopTurtle=!0,0):Number(a)/Number(b)},this.setBackgroundColor=function(a){var b=document.body;if(a==-1)var c=platformColor.background;else var c=this.turtles.turtleList[a].canvasColor;b.style.background=c,document.querySelector(".canvasHolder").style.background=c,this.svgOutput=""},this.setCameraID=function(a){this.cameraID=a},this.hideBlocks=function(){this.blocks.hide(),this.refreshCanvas()},this.showBlocks=function(){this.blocks.show(),this.blocks.bringToTop(),this.refreshCanvas()}}var DEFAULTDELAY=500,TURTLESTEP=-1,NOMICERRORMSG="The microphone is not available.",NANERRORMSG="Not a number.",NOSTRINGERRORMSG="Not a string.",NOBOXERRORMSG="Cannot find box",NOACTIONERRORMSG="Cannot find action.",NOINPUTERRORMSG="Missing argument.",NOSQRTERRORMSG="Cannot take square root of negative number.",ZERODIVIDEERRORMSG="Cannot divide by zero.",EMPTYHEAPERRORMSG="empty heap.";