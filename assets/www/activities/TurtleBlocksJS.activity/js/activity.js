/*! Sugarizer 2016-12-28 */
function facebookInit(){window.fbAsyncInit=function(){FB.init({appId:"1496189893985945",xfbml:!0,version:"v2.1"})}}try{!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}catch(a){}var lang=document.webL10n.getLanguage();lang.indexOf("-")!=-1&&(lang=lang.slice(0,lang.indexOf("-")),document.webL10n.setLanguage(lang)),define(["activity/sugarizer-compatibility","activity/platformstyle","easeljs","tweenjs","preloadjs","howler","p5.sound","p5.dom","mespeak","Chart","activity/utils","activity/artwork","activity/munsell","activity/trash","activity/turtle","activity/palette","activity/protoblocks","activity/blocks","activity/block","activity/logo","activity/clearbox","activity/utilitybox","activity/samplesviewer","activity/basicblocks","activity/blockfactory","activity/analytics","prefixfree.min"],function(a){function b(a){function b(){null!=Ja&&(oa.removeChild(Ja),Ja=null),sa.boxes={},sa.time=0,S(),sa.setBackgroundColor(-1);for(var a=0;a<pa.turtleList.length;a++)pa.turtleList[a].doClear();blocksContainer.x=0,blocksContainer.y=0}function c(a){sa.setTurtleDelay(0),pa.running()?sa.step(null,a):sa.runLogoCommands(null,a)}function d(){sa.setTurtleDelay(Pa),pa.running()?sa.step():sa.runLogoCommands()}function e(){var a=0;for(var b in sa.stepQueue)a+=1;0==a||sa.turtleDelay!=Qa?(sa.setTurtleDelay(Qa),pa.running()||sa.runLogoCommands(),sa.step()):(sa.setTurtleDelay(Qa),sa.step())}function f(){sa.doStopTurtle()}function g(){bb?(V(),bb=!1):(W(),bb=!0)}function h(){cb?(X(),cb=!1):(Y(),cb=!0)}function j(){Fa=!Fa}function k(){document.body.style.cursor="wait";var a=docById("myChart"),b=a.getContext("2d"),c=null,d=analyzeProject(ra);console.log(d);var e=scoreToChartData(d),f=function(){var a=c.toBase64Image(),b=new Image;b.onload=function(){Ja=new createjs.Bitmap(b),oa.addChild(Ja),Ja.x=na.width/(2*Aa)-300,Ja.y=0,Ja.scaleX=Ja.scaleY=Ja.scale=600/Ja.image.width,sa.hideBlocks(),db=!0,document.body.style.cursor="default"},b.src=a},g=getChartOptions(f);console.log("creating new chart"),c=new Chart(b).Radar(e,g)}function l(){Ra<Sa.length-1&&(Ra+=1,ra.setBlockScale(Sa[Ra]))}function m(){Ra>0&&(Ra-=1,ra.setBlockScale(Sa[Ra]))}function o(){if(docById("loader").className="loader",oa=new createjs.Stage(na),createjs.Touch.enable(oa),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(30),createjs.Ticker.addEventListener("tick",oa),createjs.Ticker.addEventListener("tick",M),v("#ffffff","#7a7a7a",function(a){gb=a},55),v("#ffcbc4","#ff0031",function(a){hb=a},110),w(),palettesContainer=new createjs.Container,blocksContainer=new createjs.Container,trashContainer=new createjs.Container,turtleContainer=new createjs.Container,oa.addChild(turtleContainer,trashContainer,blocksContainer,palettesContainer),p(),trashcan=new Trashcan(na,trashContainer,Xa,L),pa=new Turtles(na,turtleContainer,L),ra=new Blocks(na,blocksContainer,L,trashcan,oa.update),qa=initPalettes(na,L,palettesContainer,Xa,L,trashcan,ra),qa.setBlocks(ra),pa.setBlocks(ra),ra.setTurtles(pa),ra.setErrorMsg(U),ra.makeCopyPasteButtons(la,da),sa=new Logo(na,ra,pa,turtleContainer,L,T,U,S,J,K,$,r,s,t,z,A,meSpeak,O),ra.setLogo(sa),sa.setBackgroundColor(-1),ta=new ClearBox(na,oa,L,F),ua=new UtilityBox(na,oa,L,l,m,aa,k,j),va=new SamplesViewer(na,oa,L,P,Q,F),initBasicProtoBlocks(qa,ra),macroData=storage.macros,null!=macroData&&processMacroData(macroData,qa,ra,La),ra.setMacroDictionary(La),qa.setMacroDictionary(La),pluginData=storage.plugins,null!=pluginData){var a=processPluginData(pluginData,qa,ra,sa.evalFlowDict,sa.evalArgDict,sa.evalParameterDict,sa.evalSetterDict,sa.evalOnStartList,sa.evalOnStopList);updatePluginObj(a)}wa.addEventListener("click",function(a){this.value=null}),wa.addEventListener("change",function(a){var b=new FileReader;b.onload=function(a){document.body.style.cursor="wait",setTimeout(function(){var a=b.result,c=a.replace("\n"," ");console.log(c);var d=JSON.parse(c);console.log(d),ra.loadNewBlocks(d),document.body.style.cursor="default"},200)},b.readAsText(wa.files[0])},!1),ya.addEventListener("click",function(a){this.value=null}),xa.addEventListener("click",function(a){window.scroll(0,0),this.value=null}),xa.addEventListener("change",function(b){window.scroll(0,0);var c=new FileReader;c.onload=function(b){document.body.style.cursor="wait",setTimeout(function(){if(a=processRawPluginData(c.result,qa,ra,U,sa.evalFlowDict,sa.evalArgDict,sa.evalParameterDict,sa.evalSetterDict,sa.evalOnStartList,sa.evalOnStopList),null!=a){var b=preparePluginExports(a);console.log(b),storage.plugins=b}setTimeout(function(){qa.visible&&qa.hide(),qa.show(),qa.bringToTop()},1e3),document.body.style.cursor="default"},200)},c.readAsText(xa.files[0])},!1),oa.mouseMoveOutside=!0,oa.enableMouseOver(10),eb=u("images/Cartesian.svg"),fb=u("images/polar.svg");var b=window.location.href,c=null,d=!1;try{httpGet(null),console.log("running from server or the user can access to examples."),za=!0}catch(a){console.log("running from filesystem or the connection isnt secure"),za=!1}ea(),B();var e,f=[];if(!sugarizerCompatibility.isInsideSugarizer()&&b.indexOf("?")>0){var e=b.split("?");if(e[1].indexOf("&")>0){for(var g=e[1].split("&"),h=0;h<g.length;h++)if(g[h].indexOf("=")>0){var i=g[h].split("=");switch(i[0].toLowerCase()){case"file":c=i[1];break;case"run":"true"==i[1].toLowerCase()&&(d=!0);break;case"inurl":var o=i[1],x=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("get",a,!0),d.responseType="json",d.onload=function(){var a=d.status;200==a?b(d.response):c(a)},d.send()})};x(o).then(function(a){console.log("Your Json result is:  "+a.arg),n=a.arg,f.push(parseInt(n))},function(a){alert("Something went wrong.")});break;case"outurl":var o=i[1];break;default:U("Invalid parameters")}}}else{if(e[1].indexOf("=")>0)var i=e[1].split("=");"file"==i[0].toLowerCase()&&(c=i[1])}}null!=c?setTimeout(function(){console.log("load "+c),P(c,d,f)},2e3):setTimeout(function(){R()},2e3),document.addEventListener("mousewheel",q,!1),document.addEventListener("DOMMouseScroll",q,!1),this.document.onkeydown=y}function p(){var a=!1;oa.on("stagemousemove",function(a){Ua=a.stageX,Va=a.stageY}),oa.on("stagemousedown",function(b){return Ta=!0,null!==oa.getObjectUnderPoint()|pa.running()?void oa.on("stagemouseup",function(a){Ta=!1}):(a=!0,lastCords={x:b.stageX,y:b.stageY},oa.on("stagemousemove",function(b){a&&Fa&&(blocksContainer.x+=b.stageX-lastCords.x,blocksContainer.y+=b.stageY-lastCords.y,lastCords={x:b.stageX,y:b.stageY},L())}),void oa.on("stagemouseup",function(b){Ta=!1,a=!1},null,!0))})}function q(a){var b=a.wheelDelta||-a.detail,c=Math.max(-1,Math.min(1,b)),d=3;a.clientX<Xa?qa.menuScrollEvent(c,d):(palette=qa.findPalette(a.clientX/Aa,a.clientY/Aa),palette&&palette.scrollEvent(c,d))}function r(){return pa.screenX2turtleX(Ua/ra.scale)}function s(){return pa.screenY2turtleY(Va/ra.scale)}function t(){return Ta}function u(a){var b=new Image;b.src=a;var c=new createjs.Container;return oa.addChild(c),bitmap=new createjs.Bitmap(b),c.addChild(bitmap),bitmap.cache(0,0,1200,900),bitmap.x=(na.width-1200)/2,bitmap.y=(na.height-900)/2,bitmap.scaleX=bitmap.scaleY=bitmap.scale=1,bitmap.visible=!1,bitmap.updateCache(),bitmap}function v(a,b,c,d){var e=new createjs.Container;oa.addChild(e),e.x=(na.width-1e3)/2,e.y=d,e.visible=!1;var f=new Image,g=MSGBLOCK.replace("fill_color",a).replace("stroke_color",b);f.onload=function(){var a=new createjs.Bitmap(f);e.addChild(a),text=new createjs.Text("your message here","20px Arial","#000000"),e.addChild(text),text.textAlign="center",text.textBaseline="alphabetic",text.x=500,text.y=30;var b=e.getBounds();e.cache(b.x,b.y,b.width,b.height);var d=new createjs.Shape;d.graphics.beginFill("#FFF").drawRect(0,0,1e3,42),d.x=0,d.y=0,e.hitArea=d,e.on("click",function(a){e.visible=!1,null!==ib&&ib.removeAllChildren(),db=!0}),c(text),ra.setMsgText(text)},f.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(g)))}function w(){for(var a=0;a<kb.length;a++){var b=kb[a];x(b)}}function x(a){var b=new createjs.Container;oa.addChild(b),b.x=(na.width-1e3)/2,b.y=110,jb[a]=b,jb[a].name=a,jb[a].visible=!1;var c=new Image;c.onload=function(){console.log("creating error message artwork for "+c.src);var a=new createjs.Bitmap(c);b.addChild(a);var d=new createjs.Text("","20px Sans","#000000");b.addChild(d),d.x=70,d.y=10;var e=b.getBounds();b.cache(e.x,e.y,e.width,e.height);var f=new createjs.Shape;f.graphics.beginFill("#FFF").drawRect(0,0,e.width,e.height),f.x=0,f.y=0,b.hitArea=f,b.on("click",function(a){b.visible=!1,null!==ib&&ib.removeAllChildren(),db=!0})},c.src="images/"+a+".svg"}function y(a){if(!docById("labelDiv").classList.contains("hasKeyboard")){var d=27,e=13;if(a.altKey)switch(a.keyCode){case 69:b();break;case 82:c();break;case 83:sa.doStopTurtle()}else if(a.ctrlKey);else switch(a.keyCode){case d:ka();break;case e:sa.runLogoCommands();break;default:Ga=String.fromCharCode(a.keyCode),Ha=a.keyCode}}}function z(){return Ha}function A(){Ga="",Ha=0}function B(){if(!docById("labelDiv").classList.contains("hasKeyboard")){if(platform.androidWebkit)var a=window.outerWidth,b=window.outerHeight;else var a=window.innerWidth,b=window.innerHeight;var c=Math.min(a,b);if(c<11*Xa){var d=!0;Aa=a<10*Xa?c/(11*Xa):Math.max(c/(11*Xa),.75)}else{var d=!1;Aa=a>b?a/1200:a/900}oa.scaleX=Aa,oa.scaleY=Aa,oa.canvas.width=a,oa.canvas.height=b,console.log("Resize: scale "+Aa+", windowW "+a+", windowH "+b+", canvasW "+na.width+", canvasH "+na.height+", screenW "+screen.width+", screenH "+screen.height),pa.setScale(Aa),ra.setScale(Aa),qa.setScale(Aa),trashcan.resizeEvent(Aa),ea(d),eb.x=na.width/(2*Aa)-600,eb.y=na.height/(2*Aa)-450,fb.x=na.width/(2*Aa)-600,fb.y=na.height/(2*Aa)-450,db=!0,ha(!0),d?qa.hide():(qa.show(),qa.bringToTop())}}function C(){var a=0,b=3*-Xa;for(var c in ra.blockList)ra.blockList[c].trash&&(ra.blockList[c].trash=!1,ra.moveBlockRelative(c,a,b),ra.blockList[c].show(),"start"==ra.blockList[c].name&&(turtle=ra.blockList[c].value,pa.turtleList[turtle].trash=!1,pa.turtleList[turtle].container.visible=!0));db=!0}function D(){ta.show(Aa)}function E(){ua.show(Aa)}function F(a,b){function c(){last(ra.blockList).x=250,last(ra.blockList).y=250,last(ra.blockList).connections=[null,null,null],pa.add(last(ra.blockList)),last(ra.blockList).value=pa.turtleList.length-1,ra.updateBlockPositions(),b||(console.log("save locally"),O())}var d=2e3,e=Xa;for(var f in ra.blockList)ra.blockList[f].trash=!0,ra.moveBlockRelative(f,d,e),ra.blockList[f].hide(),"start"==ra.blockList[f].name&&(console.log("start blk "+f+" value is "+ra.blockList[f].value),turtle=ra.blockList[f].value,null!=turtle&&(console.log("sending turtle "+turtle+" to trash"),pa.turtleList[turtle].trash=!0,pa.turtleList[turtle].container.visible=!1));a&&ra.makeNewBlock("start",c),b||(console.log("save locally"),O()),db=!0}function G(){qa.visible?qa.hide():(qa.show(),qa.bringToTop())}function H(){ra.visible?sa.hideBlocks():(null!=Ja&&(oa.removeChild(Ja),Ja=null),sa.showBlocks())}function I(){ra.visible&&(console.log("calling toggleCollapsibles"),ra.toggleCollapsibles())}function J(){Ba||ba()}function K(){Ba||ca()}function L(){db=!0}function M(a){db&&(db=!1,oa.update(a))}function N(){console.log("save locally"),O(),va.show()}function O(){if(sugarizerCompatibility.isInsideSugarizer()?storage=sugarizerCompatibility.data:storage=localStorage,console.log("overwriting session data"),void 0===storage.currentProject)try{storage.currentProject="My Project",storage.allProjects=JSON.stringify(["My Project"])}catch(a){console.log(a)}try{var a=storage.currentProject;storage["SESSION"+a]=$()}catch(a){console.log(a)}if(!isSVGEmpty(pa)){var b=new Image,c=doSVG(na,sa,pa,320,240,320/na.width);b.onload=function(){var c=new createjs.Bitmap(b),d=c.getBounds();c.cache(d.x,d.y,d.width,d.height);try{storage["SESSIONIMAGE"+a]=c.getCacheDataURL()}catch(a){console.log(a)}},b.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(c))),console.log(b.src),sugarizerCompatibility.isInsideSugarizer()&&sugarizerCompatibility.saveLocally()}}function P(a,b,d){b="undefined"!=typeof b&&b,document.body.style.cursor="wait",setTimeout(function(){"tb"!=fileExt(a)&&(a+=".tb");try{if(za){var b=httpGet(a);console.log("receiving "+b);var c=b.replace("\n","")}var d=JSON.parse(c);ra.loadNewBlocks(d),console.log("save locally"),O()}catch(a){console.log(a),R()}document.body.style.cursor="default",db=!0},200),b&&setTimeout(function(){H(),c(d)},2e3),docById("loading-image-container").style.display="none"}function Q(a){console.log("loadRawProject "+a),document.body.style.cursor="wait",b();var c=JSON.parse(a);ra.loadNewBlocks(c),docById("loading-image-container").style.display="none",document.body.style.cursor="default"}function R(){console.log(" LOAD START"),justLoadStart=function(){console.log("loading start"),postProcess=function(a){ra.blockList[0].x=250,ra.blockList[0].y=250,ra.blockList[0].connections=[null,null,null],ra.blockList[0].value=pa.turtleList.length,ra.blockList[0].collapsed=!1,pa.add(ra.blockList[0]),ra.updateBlockPositions()},ra.makeNewBlock("start",postProcess,null)},sugarizerCompatibility.isInsideSugarizer()?storage=sugarizerCompatibility.data:storage=localStorage,sessionData=null;var a=storage.currentProject;if(sessionData=storage["SESSION"+a],sessionData)try{"undefined"==sessionData||"[]"==sessionData?(console.log("empty session found: loading start"),justLoadStart()):(console.log("restoring session: "+sessionData),ra.loadNewBlocks(JSON.parse(sessionData)))}catch(a){console.log(a)}else justLoadStart();db=!0,docById("loading-image-container").style.display="none"}function S(){hb.parent.visible=!1,null!==ib&&(ib.removeAllChildren(),L()),gb.parent.visible=!1;for(var a in jb)jb[a].visible=!1}function T(a){if(null!=gb){var b=gb.parent;b.visible=!0,gb.text=a,b.updateCache(),oa.setChildIndex(b,oa.getNumChildren()-1)}}function U(a,b,c){if(null!=hb){if(void 0!==b&&null!==b&&!ra.blockList[b].collapsed){var d=(na.width-1e3)/2,e=128,f=ra.blockList[b].x+blocksContainer.x,g=ra.blockList[b].y+blocksContainer.y;null==ib&&(ib=new createjs.Container,oa.addChild(ib));var h=new createjs.Shape;ib.addChild(h),h.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(d,e).lineTo(f,g),oa.setChildIndex(ib,oa.getNumChildren()-1);var i=Math.atan2(f-d,e-g)/Math.PI*180,j=new createjs.Shape;ib.addChild(j),j.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(-10,18).lineTo(0,0).lineTo(10,18),j.x=f,j.y=g,j.rotation=i}switch(a){case NOMICERRORMSG:jb.nomicrophone.visible=!0,oa.setChildIndex(jb.nomicrophone,oa.getNumChildren()-1);break;case NOSTRINGERRORMSG:jb.notastring.visible=!0,oa.setChildIndex(jb.notastring,oa.getNumChildren()-1);break;case EMPTYHEAPERRORMSG:jb.emptyheap.visible=!0,oa.setChildIndex(jb.emptyheap,oa.getNumChildren()-1);break;case NOSQRTERRORMSG:jb.negroot.visible=!0,oa.setChildIndex(jb.negroot,oa.getNumChildren()-1);break;case NOACTIONERRORMSG:null==c&&(c="foo"),jb.nostack.children[1].text=c,jb.nostack.visible=!0,jb.nostack.updateCache(),oa.setChildIndex(jb.nostack,oa.getNumChildren()-1);break;case NOBOXERRORMSG:null==c&&(c="foo"),jb.emptybox.children[1].text=c,jb.emptybox.visible=!0,jb.emptybox.updateCache(),oa.setChildIndex(jb.emptybox,oa.getNumChildren()-1);break;case ZERODIVIDEERRORMSG:jb.zerodivide.visible=!0,oa.setChildIndex(jb.zerodivide,oa.getNumChildren()-1);break;case NANERRORMSG:jb.notanumber.visible=!0,oa.setChildIndex(jb.notanumber,oa.getNumChildren()-1);break;case NOINPUTERRORMSG:jb.noinput.visible=!0,oa.setChildIndex(jb.noinput,oa.getNumChildren()-1);break;default:var k=hb.parent;k.visible=!0,hb.text=a,oa.setChildIndex(k,oa.getNumChildren()-1),k.updateCache()}db=!0}}function V(){eb.visible=!1,eb.updateCache(),db=!0}function W(){eb.visible=!0,eb.updateCache(),db=!0}function X(){fb.visible=!1,fb.updateCache(),db=!0}function Y(){fb.visible=!0,fb.updateCache(),db=!0}function Z(){ra.pasteStack()}function $(){for(var a=[],b=0;b<ra.blockList.length;b++){var c=ra.blockList[b];c.trash||a.push(b)}for(var d=[],b=0;b<ra.blockList.length;b++){var c=ra.blockList[b];if(!c.trash){if(ra.blockList[b].isValueBlock()||"loadFile"==ra.blockList[b].name)var e={value:c.value};else if("start"==c.name){turtle=pa.turtleList[c.value];var e={collapsed:c.collapsed,xcor:turtle.x,ycor:turtle.y,heading:turtle.orientation,color:turtle.color,shade:turtle.value,pensize:turtle.stroke,grey:turtle.chroma}}else if("action"==c.name)var e={collapsed:c.collapsed};else if("namedbox"==c.name)var e={value:c.privateData};else if("nameddo"==c.name)var e={value:c.privateData};else if("nameddoArg"==c.name)var e={value:c.privateData};else if("namedcalc"==c.name)var e={value:c.privateData};else if("namedcalcArg"==c.name)var e={value:c.privateData};else if("namedarg"==c.name)var e={value:c.privateData};else var e={};connections=[];for(var f=0;f<c.connections.length;f++){var g=a.indexOf(c.connections[f]);null==c.connections[f]||g==-1?connections.push(null):connections.push(g)}d.push([a.indexOf(b),[c.name,e],c.container.x,c.container.y,connections])}}return JSON.stringify(d)}function aa(){xa.focus(),xa.click()}function ba(){Ma.x=Na,Ma.y=Oa,Ma.visible=!1}function ca(){Ma.x=Ya[0].x,Ma.y=Ya[0].y,Ma.visible=!0}function da(){Ia.removeChild(Ia.children[0]);var a=new Image;a.onload=function(){var b=55,c=Math.floor(Xa/2);bitmap=new createjs.Bitmap(a),Xa!=b&&(bitmap.scaleX=Xa/b,bitmap.scaleY=Xa/b),bitmap.regX=c/bitmap.scaleX,bitmap.regY=c/bitmap.scaleY,Ia.addChild(bitmap),db=!0},a.src="icons/paste-button.svg"}function ea(a){if(void 0!==Ca){oa.removeChild(Ca);for(i in Ya)oa.removeChild(Ya[i])}Ca=new createjs.Shape,Ca.graphics.f(platformColor.header).r(0,0,screen.width/Aa,Xa),platformColor.doHeaderShadow&&(Ca.shadow=new createjs.Shadow("#777",0,2,2)),oa.addChild(Ca);var g=[["fast",c],["slow",d],["step",e],["stop-turtle",f],["clear",b],["palette",G],["hide-blocks",H],["collapse-blocks",I],["help",ha]];sugarizerCompatibility.isInsideSugarizer()&&g.push(["sugarizer-stop",function(){sugarizerCompatibility.data.blocks=$(),sugarizerCompatibility.saveLocally(function(){sugarizerCompatibility.sugarizerStop()})}]),a&&g.unshift(["popdown-palette",ga]);var h=Xa,j=Math.floor(h/2),k=j,l=h,m=0;for(var n in g){var o=la(g[n][0]+"-button",j,k,h);ma(o,j,k,g[n][1]),Ya.push(o),"stop-turtle"==g[n][0]&&(Ma=o,Na=j,Oa=k),j+=l,k+=m}fa(Aa)}function fa(a){if(void 0!==Ea){oa.removeChild(Ea);for(i in Za)oa.removeChild(Za[i])}var b=[["planet",N],["paste-disabled",Z],["Cartesian",g],["polar",h],["utility",E],["empty-trash",D],["restore-trash",C]],c=Xa,d=Math.floor(na.width/a)-c/2,e=Math.floor(c/2),f=0,j=c;Ea=la("menu-button",d,e,c,Da?90:void 0),ma(Ea,d,e,ia);for(var k in b){d+=f,e+=j;var l=la(b[k][0]+"-button",d,e,c);ma(l,d,e,b[k][1]),Za.push(l),l.visible=!1}if(Da)for(button in Za)Za[button].visible=!0}function ga(){var a=new PopdownPalette(qa);a.popdown()}function ha(a){if(_a=0,a){if(null==$a){$a=new createjs.Container,oa.addChild($a),$a.x=65,$a.y=65,$a.on("click",function(a){var b=$a.getBounds();if(a.stageY<$a.y+b.height/2)$a.visible=!1,docById("helpElem").style.visibility="hidden";else{_a+=1,_a>=ab.length&&(_a=0);var d=55*Aa;c.innerHTML='<img src ="'+ab[_a][2]+'" style="height:'+d+'px; width: auto"></img> <h2>'+ab[_a][0]+"</h2><p>"+ab[_a][1]+"</p>"}db=!0});var b=new Image;b.onload=function(){bitmap=new createjs.Bitmap(b),Aa>1?bitmap.scaleX=bitmap.scaleY=bitmap.scale=Aa:bitmap.scaleX=bitmap.scaleY=bitmap.scale=1.125,$a.addChild(bitmap);var a=$a.getBounds(),c=new createjs.Shape;c.graphics.beginFill("#FFF").drawRect(a.x,a.y,a.width,a.height),c.x=0,c.y=0,$a.hitArea=c,docById("helpElem").innerHTML='<img src ="'+ab[_a][2]+'"</img> <h2>'+ab[_a][0]+"</h2><p>"+ab[_a][1]+"</p>",doneTour||(docById("helpElem").style.visibility="visible"),db=!0},b.src="images/help-container.svg"}var c=docById("helpElem");c.style.position="absolute",c.style.display="block",c.style.paddingLeft=20*Aa+"px",c.style.paddingRight=20*Aa+"px",c.style.paddingTop="0px",c.style.paddingBottom=20*Aa+"px",c.style.fontSize=20*Aa+"px",c.style.color="#ffffff",c.style.left=65*Aa+"px",c.style.top=105*Aa+"px";var d=Math.min(300,300*Aa),e=Math.min(300,300*Aa);c.style.width=d+"px",c.style.height=e+"px",Aa>1&&(bitmap.scaleX=bitmap.scaleY=bitmap.scale=Aa)}doneTour="true"===storage.doneTour,a&&doneTour?(docById("helpElem").style.visibility="hidden",$a.visible=!1):(sugarizerCompatibility.isInsideSugarizer()?sugarizerCompatibility.data.doneTour="true":storage.doneTour="true",docById("helpElem").innerHTML='<img src ="'+ab[_a][2]+'"</img> <h2>'+ab[_a][0]+"</h2><p>"+ab[_a][1]+"</p>",docById("helpElem").style.visibility="visible",$a.visible=!0,db=!0,qa.show(),Da||ja(1))}function ia(){ja(1)}function ja(){var a=last(Ea.children);if(null!==a){var b=a.rotation;createjs.Tween.get(a).to({rotation:b}).to({rotation:b+90},500)}else setTimeout(ja,50);setTimeout(function(){if(Da){Da=!1;for(button in Za)Za[button].visible=!1}else{Da=!0;for(button in Za)Za[button].visible=!0}db=!0},500)}function ka(){Ba=!Ba,Ea.visible=Ba,Ca.visible=Ba;for(button in Ya)Ya[button].visible=Ba;for(button in Za)Za[button].visible=Ba;db=!0}function la(a,b,c,d,e){var f=new createjs.Container;"paste-disabled-button"==a&&(Ia=f),oa.addChild(f),f.x=b,f.y=c;var g=new Image;return g.onload=function(){var a=55,b=Math.floor(d/2);bitmap=new createjs.Bitmap(g),d!=a&&(bitmap.scaleX=d/a,bitmap.scaleY=d/a),bitmap.regX=b/bitmap.scaleX,bitmap.regY=b/bitmap.scaleY,void 0!==e&&(bitmap.rotation=e),f.addChild(bitmap);var c=new createjs.Shape;c.graphics.beginFill("#FFF").drawEllipse(-b,-b,d,d),c.x=0,c.y=0,f.hitArea=c,bitmap.cache(0,0,d,d),bitmap.updateCache(),db=!0},g.src="icons/"+a+".svg",f}function ma(a,b,c,d){var e=!1;a.on("mousedown",function(f){var g=!0,h=({x:a.x-Math.round(f.stageX/ra.scale),y:a.y-Math.round(f.stageY/ra.scale)},showButtonHighlight(b,c,Xa/2,f,Aa,oa));a.on("pressup",function(f){hideButtonHighlight(h,oa),a.x=b,a.y=c,null!=d&&g&&!e&&(e=!0,setTimeout(function(){e=!1},500),d()),g=!1})})}facebookInit(),window.scroll(0,0);try{meSpeak.loadConfig("lib/mespeak_config.json"),meSpeak.loadVoice("lib/voices/en/en.json")}catch(a){console.log(a)}var na=docById("myCanvas");new createjs.LoadQueue(!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob);else{alert("The File APIs are not fully supported in this browser.")}var oa,pa,qa,ra,sa,ta,ua,va,wa=docById("myOpenFile"),xa=docById("myOpenPlugin"),ya=docById("myOpenAll"),za=!0,Aa=1,Ba=!0,Ca=null,Da=!1,Ea=null,Fa=!1,Ga="",Ha=0,Ia=null,Ja=null;for(var Ka in PALETTECOLORS)PALETTEFILLCOLORS[Ka]=getMunsellColor(PALETTECOLORS[Ka][0],PALETTECOLORS[Ka][1],PALETTECOLORS[Ka][2]),PALETTESTROKECOLORS[Ka]=getMunsellColor(PALETTECOLORS[Ka][0],PALETTECOLORS[Ka][1]-30,PALETTECOLORS[Ka][2]),PALETTEHIGHLIGHTCOLORS[Ka]=getMunsellColor(PALETTECOLORS[Ka][0],PALETTECOLORS[Ka][1]+10,PALETTECOLORS[Ka][2]),HIGHLIGHTSTROKECOLORS[Ka]=getMunsellColor(PALETTECOLORS[Ka][0],PALETTECOLORS[Ka][1]-50,PALETTECOLORS[Ka][2]);pluginObjs={PALETTEPLUGINS:{},PALETTEFILLCOLORS:{},PALETTESTROKECOLORS:{},PALETTEHIGHLIGHTCOLORS:{},FLOWPLUGINS:{},ARGPLUGINS:{},BLOCKPLUGINS:{},ONLOAD:{},ONSTART:{},ONSTOP:{}};var La={},Ma=null,Na=0,Oa=0,Pa=500,Qa=-1,Ra=2,Sa=[1,1.5,2,3,4],Ta=!1,Ua=0,Va=0,Wa=1200==screen.width&&900==screen.height||900==screen.width&&1200==screen.height;console.log("on XO? "+Wa);var Xa=55;Wa&&(Xa=75);var Ya=[],Za=[],$a=null,_a=0,ab=[[_("Welcome to Turtle Blocks"),_("Turtle Blocks is a Logo-inspired turtle that draws colorful pictures with snap-together visual-programming blocks."),"activity/activity-icon-color.svg"],[_("Palette buttons"),_("This toolbar contains the palette buttons, click to show the palettes of blocks and drag blocks from the palettes onto the canvas to use them."),"images/icons.svg"],[_("Run fast"),_("Click to run the project in fast mode."),"icons/fast-button.svg"],[_("Run slow"),_("Click to run the project in slow mode."),"icons/slow-button.svg"],[_("Run step by step"),_("Click to run the project step by step."),"icons/step-button.svg"],[_("Stop"),_("Stop the current project."),"icons/stop-turtle-button.svg"],[_("Clean"),_("Clear the screen and return the turtles to their initial positions."),"icons/clear-button.svg"],[_("Show/hide palettes"),_("Hide or show the block palettes."),"icons/palette-button.svg"],[_("Show/hide blocks"),_("Hide or show the blocks and the palettes."),"icons/hide-blocks-button.svg"],[_("Expand/collapse collapsable blocks"),_("Expand or collapse start and action stacks."),"icons/collapse-blocks-button.svg"],[_("Help"),_("Show these messages."),"icons/help-button.svg"],[_("Expand/collapse option toolbar"),_("Click this button to expand or collapse the auxillary toolbar."),"icons/menu-button.svg"],[_("Load samples from server"),_("This button opens a viewer for loading example projects."),"icons/planet-button.svg"],[_("Copy"),_('The copy button copies a stack to the clipboard. It appears after a "long press" on a stack.'),"icons/copy-button.svg"],[_("Paste"),_("The paste button is enabled when there are blocks copied onto the clipboard."),"icons/paste-disabled-button.svg"],[_("Save stack"),_('The save-stack button saves a stack onto a custom palette. It appears after a "long press" on a stack.'),"icons/save-blocks-button.svg"],[_("Cartesian"),_("Show or hide a Cartesian-coordinate grid."),"icons/Cartesian-button.svg"],[_("Polar"),_("Show or hide a polar-coordinate grid."),"icons/polar-button.svg"],[_("Settings"),_("Open a panel for configuring Turtle Blocks."),"icons/utility-button.svg"],[_("Decrease block size"),_("Decrease the size of the blocks."),"icons/smaller-button.svg"],[_("Increase block size"),_("Increase the size of the blocks."),"icons/bigger-button.svg"],[_("Display statistics"),_("Display statistics about your Turtle project."),"icons/chart-button.svg"],[_("Load plugin from file"),_("You can load new blocks from the file system."),"icons/plugin-button.svg"],[_("Enable scrolling"),_("You can scroll the blocks on the canvas."),"icons/scroll-button.svg"],[_("Delete all"),_("Remove all content on the canvas, including the blocks."),"icons/empty-trash-button.svg"],[_("Undo"),_("Restore blocks from the trash."),"icons/restore-trash-button.svg"],[_("Congratulations."),_("You have finished the tour. Please enjoy Turtle Blocks!"),"activity/activity-icon-color.svg"]];pluginsImages={};var bb=!1,cb=!1,db=!0,eb=null,fb=null,gb=null,hb=null,ib=null,jb={},kb=["emptybox","emptyheap","negroot","noinput","zerodivide","notanumber","nostack","notastring","nomicrophone"];o(),window.onresize=function(){B()},window.prepareExport=$,window.saveLocally=O}require(["domReady!","activity/sugarizer-compatibility"],function(a){sugarizerCompatibility.isInsideSugarizer()?sugarizerCompatibility.loadData(function(){b(a)}):b(a)})});