/*! Sugarizer 2017-08-25 */
define(["webL10n.sugarizer","sugar-web/activity/shortcut","sugar-web/bus","sugar-web/env","sugar-web/datastore","sugar-web/presence","sugar-web/graphics/icon","sugar-web/graphics/activitypalette"],function(a,b,c,d,e,f,g,h){"use strict";var i=null,j=null,k=null,l={};return l.setup=function(){function m(){var a=document.createEvent("CustomEvent");a.initCustomEvent("activityPause",!1,!1,{cancelable:!0}),window.dispatchEvent(a)}function n(){var a=document.createEvent("CustomEvent");a.initCustomEvent("activityStop",!1,!1,{cancelable:!0});var b=window.dispatchEvent(a);b&&i.save(function(){l.close()})}c.listen(),a.start(),c.onNotification("activity.pause",m),c.onNotification("activity.stop",n),i=new e.DatastoreObject;var o=document.getElementById("activity-button"),p=new h.ActivityPalette(o,i);l.getXOColor(function(a,b){return});var q=document.getElementById("stop-button");q.addEventListener("click",function(a){n()}),b.add("Ctrl","Q",this.close),d.getEnvironment(function(a,b){b.objectId||i.setMetadata({title:b.activityName+" Activity",title_set_by_user:"0",activity:b.bundleId,activity_id:b.activityId}),d.isSugarizer()&&f.joinNetwork(function(a,c){b.sharedId&&c.joinSharedActivity(b.sharedId,function(){var a=c.getSharedInfo().colorvalue;g.colorize(o,a),i.setMetadata({buddy_color:a}),i.save(function(){})}),j?j(a,c):k={error:a,presence:c}}),i.save(function(){i.getMetadata(function(a,b){p.setTitleDescription(b)})})})},l.getDatastoreObject=function(){return i},l.getPresenceObject=function(a){return null==k?j=a:(a(k.error,k.presence),k=null),f},l.getXOColor=function(a){function b(b,c){null===b?a(null,{stroke:c[0][0],fill:c[0][1]}):a(null,{stroke:"#00A0FF",fill:"#8BFF7A"})}c.sendMessage("activity.get_xo_color",[],b)},l.close=function(a){function b(b,c){null===b?a(null):a(b,null)}c.sendMessage("activity.close",[],b)},l.showObjectChooser=function(a){function b(b,c){null===b?a(null,c[0]):a(b,null)}c.sendMessage("activity.show_object_chooser",[],b)},l});