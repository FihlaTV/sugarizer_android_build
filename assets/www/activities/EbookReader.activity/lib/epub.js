/*! Sugarizer 2018-07-22 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("xmldom"),function(){try{return require("jszip")}catch(a){}}()):"function"==typeof define&&define.amd?define(["xmldom","jszip"],b):"object"==typeof exports?exports.ePub=b(require("xmldom"),function(){try{return require("jszip")}catch(a){}}()):a.ePub=b(a.xmldom,a.jszip)}("undefined"!=typeof self?self:this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,b),e.l=!0,e.exports}var c={};return b.m=a,b.c=c,b.d=function(a,c,d){b.o(a,c)||Object.defineProperty(a,c,{configurable:!1,enumerable:!0,get:d})},b.n=function(a){var c=a&&a.__esModule?function(){return a.default}:function(){return a};return b.d(c,"a",c),c},b.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},b.p="/dist/",b(b.s=25)}([function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)})}function f(){return Math.max(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)}function g(a){return!(!a||1!=a.nodeType)}function h(a){return!isNaN(parseFloat(a))&&isFinite(a)}function i(a){var b=parseFloat(a);return b===a&&h(a)&&Math.floor(b)!==a}function j(a){var b=["Webkit","webkit","Moz","O","ms"],c=["-webkit-","-webkit-","-moz-","-o-","-ms-"],d=a[0].toUpperCase()+a.slice(1),e=b.length;if("undefined"==typeof document||void 0!==document.body.style[a])return a;for(var f=0;f<e;f++)if(void 0!==document.body.style[b[f]+d])return c[f]+a;return a}function k(a){for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];for(var e in d)void 0===a[e]&&(a[e]=d[e])}return a}function l(a){return[].slice.call(arguments,1).forEach(function(b){b&&Object.getOwnPropertyNames(b).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))})}),a}function m(a,b,c){var d=n(a,b,c);return b.splice(d,0,a),d}function n(a,b,c,d,e){var f,g=d||0,h=e||b.length,i=parseInt(g+(h-g)/2);return c||(c=function(a,b){return a>b?1:a<b?-1:a==b?0:void 0}),h-g<=0?i:(f=c(b[i],a),h-g==1?f>=0?i:i+1:0===f?i:-1===f?n(a,b,c,i,h):n(a,b,c,g,i))}function o(a,b,c,d,e){var f,g=d||0,h=e||b.length,i=parseInt(g+(h-g)/2);return c||(c=function(a,b){return a>b?1:a<b?-1:a==b?0:void 0}),h-g<=0?-1:(f=c(b[i],a),h-g==1?0===f?i:-1:0===f?i:-1===f?o(a,b,c,i,h):o(a,b,c,g,i))}function p(a){var b=window.getComputedStyle(a),c=["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],d=["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],e=0,f=0;return c.forEach(function(a){e+=parseFloat(b[a])||0}),d.forEach(function(a){f+=parseFloat(b[a])||0}),{height:f,width:e}}function q(a){var b=window.getComputedStyle(a),c=["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"],d=["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"],e=0,f=0;return c.forEach(function(a){e+=parseFloat(b[a])||0}),d.forEach(function(a){f+=parseFloat(b[a])||0}),{height:f,width:e}}function r(){var a=window.innerWidth,b=window.innerHeight;return{top:0,left:0,right:a,bottom:b,width:a,height:b}}function s(a,b){for(var c,d=a.parentNode,e=d.childNodes,f=-1,g=0;g<e.length&&(c=e[g],c.nodeType===b&&f++,c!=a);g++);return f}function t(a){return s(a,R)}function u(a){return s(a,Q)}function v(a){return["xml","opf","ncx"].indexOf(a)>-1}function w(a,b){return new Blob([a],{type:b})}function x(a,b){var c=w(a,b);return S.createObjectURL(c)}function y(a){return S.revokeObjectURL(a)}function z(a,b){var c;if("string"==typeof a)return c=btoa(encodeURIComponent(a)),"data:"+b+";base64,"+c}function A(a){return Object.prototype.toString.call(a).slice(8,-1)}function B(a,b,d){var e;return e="undefined"==typeof DOMParser||d?c(16).DOMParser:DOMParser,65279===a.charCodeAt(0)&&(a=a.slice(1)),(new e).parseFromString(a,b)}function C(a,b){var c;if(!a)throw new Error("No Element Provided");return void 0!==a.querySelector?a.querySelector(b):(c=a.getElementsByTagName(b),c.length?c[0]:void 0)}function D(a,b){return void 0!==a.querySelector?a.querySelectorAll(b):a.getElementsByTagName(b)}function E(a,b,c){var d,e;if(void 0!==a.querySelector){b+="[";for(var f in c)b+=f+"~='"+c[f]+"'";return b+="]",a.querySelector(b)}if(d=a.getElementsByTagName(b),e=Array.prototype.slice.call(d,0).filter(function(a){for(var b in c)if(a.getAttribute(b)===c[b])return!0;return!1}))return e[0]}function F(a,b){void 0!==(a.ownerDocument||a).createTreeWalker?G(a,b,NodeFilter.SHOW_TEXT):H(a,function(a){a&&3===a.nodeType&&b(a)},!0)}function G(a,b,c){for(var d=document.createTreeWalker(a,c,null,!1),e=void 0;e=d.nextNode();)b(e)}function H(a,b){if(b(a))return!0;if(a=a.firstChild)do{var c=H(a,b);if(c)return!0;a=a.nextSibling}while(a)}function I(a){return new Promise(function(b,c){var d=new FileReader;d.readAsDataURL(a),d.onloadend=function(){b(d.result)}})}function J(){var a=this;this.resolve=null,this.reject=null,this.id=e(),this.promise=new Promise(function(b,c){a.resolve=b,a.reject=c}),Object.freeze(this)}function K(a,b,c){var d;if(void 0!==a.querySelector&&(d=a.querySelector(b+'[*|type="'+c+'"]')),d&&0!==d.length)return d;d=D(a,b);for(var e=0;e<d.length;e++)if(d[e].getAttributeNS("http://www.idpf.org/2007/ops","type")===c||d[e].getAttribute("epub:type")===c)return d[e]}function L(a){for(var b=[],c=a.childNodes,d=0;d<c.length;d++){var e=c[d];1===e.nodeType&&b.push(e)}return b}function M(a){for(var b=[a];a;a=a.parentNode)b.unshift(a);return b}function N(a,b,c){for(var d=[],e=a.childNodes,f=0;f<e.length;f++){var g=e[f];if(1===g.nodeType&&g.nodeName.toLowerCase()===b){if(c)return g;d.push(g)}}if(!c)return d}function O(a,b){var c=void 0;if(null!==a&&""!==b)for(c=a.parentNode;1===c.nodeType;){if(c.tagName.toLowerCase()===b)return c;c=c.parentNode}}Object.defineProperty(b,"__esModule",{value:!0});var P=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();b.uuid=e,b.documentHeight=f,b.isElement=g,b.isNumber=h,b.isFloat=i,b.prefixed=j,b.defaults=k,b.extend=l,b.insert=m,b.locationOf=n,b.indexOfSorted=o,b.bounds=p,b.borders=q,b.windowBounds=r,b.indexOfNode=s,b.indexOfTextNode=t,b.indexOfElementNode=u,b.isXml=v,b.createBlob=w,b.createBlobUrl=x,b.revokeBlobUrl=y,b.createBase64Url=z,b.type=A,b.parse=B,b.qs=C,b.qsa=D,b.qsp=E,b.sprint=F,b.treeWalker=G,b.walk=H,b.blob2base64=I,b.defer=J,b.querySelectorByType=K,b.findChildren=L,b.parents=M,b.filterChildren=N,b.getParentByTagName=O;var Q=(b.requestAnimationFrame="undefined"!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame),1),R=3,S="undefined"!=typeof URL?URL:"undefined"!=typeof window?window.URL||window.webkitURL||window.mozURL:void 0;b.RangeObject=function(){function a(){d(this,a),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return P(a,[{key:"setStart",value:function(a,b){this.startContainer=a,this.startOffset=b,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:"setEnd",value:function(a,b){this.endContainer=a,this.endOffset=b,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:"collapse",value:function(a){this.collapsed=!0,a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:"selectNode",value:function(a){var b=a.parentNode,c=Array.prototype.indexOf.call(b.childNodes,a);this.setStart(b,c),this.setEnd(b,c+1)}},{key:"selectNodeContents",value:function(a){var b=(a.childNodes[a.childNodes-1],3===a.nodeType?a.textContent.length:parent.childNodes.length);this.setStart(a,0),this.setEnd(a,b)}},{key:"_commonAncestorContainer",value:function(a,b){var c=M(a||this.startContainer),d=M(b||this.endContainer);if(c[0]==d[0])for(var e=0;e<c.length;e++)if(c[e]!=d[e])return c[e-1]}},{key:"_checkCollapsed",value:function(){this.startContainer===this.endContainer&&this.startOffset===this.endOffset?this.collapsed=!0:this.collapsed=!1}},{key:"toString",value:function(){}}]),a}()},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=1,i=3,j=9,k=function(){function a(b,c,f){d(this,a);var h;if(this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof a))return new a(b,c,f);if("string"==typeof c?this.base=this.parseComponent(c):"object"===(void 0===c?"undefined":e(c))&&c.steps&&(this.base=c),"string"===(h=this.checkType(b)))return this.str=b,(0,g.extend)(this,this.parse(b));if("range"===h)return(0,g.extend)(this,this.fromRange(b,this.base,f));if("node"===h)return(0,g.extend)(this,this.fromNode(b,this.base,f));if("EpubCFI"===h&&b.path)return b;if(b)throw new TypeError("not a valid argument for EpubCFI");return this}return f(a,[{key:"checkType",value:function(b){return this.isCfiString(b)?"string":"object"!==(void 0===b?"undefined":e(b))||"Range"!==(0,g.type)(b)&&void 0===b.startContainer?"object"===(void 0===b?"undefined":e(b))&&void 0!==b.nodeType?"node":"object"===(void 0===b?"undefined":e(b))&&b instanceof a&&"EpubCFI":"range"}},{key:"parse",value:function(a){var b,c,d,e={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return"string"!=typeof a?{spinePos:-1}:(0===a.indexOf("epubcfi(")&&")"===a[a.length-1]&&(a=a.slice(8,a.length-1)),(b=this.getChapterComponent(a))?(e.base=this.parseComponent(b),c=this.getPathComponent(a),e.path=this.parseComponent(c),d=this.getRange(a),d&&(e.range=!0,e.start=this.parseComponent(d[0]),e.end=this.parseComponent(d[1])),e.spinePos=e.base.steps[1].index,e):{spinePos:-1})}},{key:"parseComponent",value:function(a){var b,c={steps:[],terminal:{offset:null,assertion:null}},d=a.split(":"),e=d[0].split("/");return d.length>1&&(b=d[1],c.terminal=this.parseTerminal(b)),""===e[0]&&e.shift(),c.steps=e.map(function(a){return this.parseStep(a)}.bind(this)),c}},{key:"parseStep",value:function(a){var b,c,d,e,f;if(e=a.match(/\[(.*)\]/),e&&e[1]&&(f=e[1]),c=parseInt(a),!isNaN(c))return c%2==0?(b="element",d=c/2-1):(b="text",d=(c-1)/2),{type:b,index:d,id:f||null}}},{key:"parseTerminal",value:function(a){var b,c,d=a.match(/\[(.*)\]/);return d&&d[1]?(b=parseInt(a.split("[")[0]),c=d[1]):b=parseInt(a),(0,g.isNumber)(b)||(b=null),{offset:b,assertion:c}}},{key:"getChapterComponent",value:function(a){return a.split("!")[0]}},{key:"getPathComponent",value:function(a){var b=a.split("!");if(b[1]){return b[1].split(",")[0]}}},{key:"getRange",value:function(a){var b=a.split(",");return 3===b.length&&[b[1],b[2]]}},{key:"getCharecterOffsetComponent",value:function(a){return a.split(":")[1]||""}},{key:"joinSteps",value:function(a){return a?a.map(function(a){var b="";return"element"===a.type&&(b+=2*(a.index+1)),"text"===a.type&&(b+=1+2*a.index),a.id&&(b+="["+a.id+"]"),b}).join("/"):""}},{key:"segmentString",value:function(a){var b="/";return b+=this.joinSteps(a.steps),a.terminal&&null!=a.terminal.offset&&(b+=":"+a.terminal.offset),a.terminal&&null!=a.terminal.assertion&&(b+="["+a.terminal.assertion+"]"),b}},{key:"toString",value:function(){var a="epubcfi(";return a+=this.segmentString(this.base),a+="!",a+=this.segmentString(this.path),this.range&&this.start&&(a+=",",a+=this.segmentString(this.start)),this.range&&this.end&&(a+=",",a+=this.segmentString(this.end)),a+=")"}},{key:"compare",value:function(b,c){var d,e,f,g;if("string"==typeof b&&(b=new a(b)),"string"==typeof c&&(c=new a(c)),b.spinePos>c.spinePos)return 1;if(b.spinePos<c.spinePos)return-1;b.range?(d=b.path.steps.concat(b.start.steps),f=b.start.terminal):(d=b.path.steps,f=b.path.terminal),c.range?(e=c.path.steps.concat(c.start.steps),g=c.start.terminal):(e=c.path.steps,g=c.path.terminal);for(var h=0;h<d.length;h++){if(!d[h])return-1;if(!e[h])return 1;if(d[h].index>e[h].index)return 1;if(d[h].index<e[h].index)return-1}return d.length<e.length?1:f.offset>g.offset?1:f.offset<g.offset?-1:0}},{key:"step",value:function(a){var b=a.nodeType===i?"text":"element";return{id:a.id,tagName:a.tagName,type:b,index:this.position(a)}}},{key:"filteredStep",value:function(a,b){var c,d=this.filter(a,b);if(d)return c=d.nodeType===i?"text":"element",{id:d.id,tagName:d.tagName,type:c,index:this.filteredPosition(d,b)}}},{key:"pathTo",value:function(a,b,c){for(var d,e={steps:[],terminal:{offset:null,assertion:null}},f=a;f&&f.parentNode&&f.parentNode.nodeType!=j;)d=c?this.filteredStep(f,c):this.step(f),d&&e.steps.unshift(d),f=f.parentNode;return null!=b&&b>=0&&(e.terminal.offset=b,"text"!=e.steps[e.steps.length-1].type&&e.steps.push({type:"text",index:0})),e}},{key:"equalStep",value:function(a,b){return!(!a||!b)&&(a.index===b.index&&a.id===b.id&&a.type===b.type)}},{key:"fromRange",value:function(a,b,c){var d={range:!1,base:{},path:{},start:null,end:null},f=a.startContainer,g=a.endContainer,h=a.startOffset,i=a.endOffset,j=!1;if(c&&(j=null!=f.ownerDocument.querySelector("."+c)),"string"==typeof b?(d.base=this.parseComponent(b),d.spinePos=d.base.steps[1].index):"object"===(void 0===b?"undefined":e(b))&&(d.base=b),a.collapsed)j&&(h=this.patchOffset(f,h,c)),d.path=this.pathTo(f,h,c);else{d.range=!0,j&&(h=this.patchOffset(f,h,c)),d.start=this.pathTo(f,h,c),j&&(i=this.patchOffset(g,i,c)),d.end=this.pathTo(g,i,c),d.path={steps:[],terminal:null};var k,l=d.start.steps.length;for(k=0;k<l&&this.equalStep(d.start.steps[k],d.end.steps[k]);k++)k===l-1?d.start.terminal===d.end.terminal&&(d.path.steps.push(d.start.steps[k]),d.range=!1):d.path.steps.push(d.start.steps[k]);d.start.steps=d.start.steps.slice(d.path.steps.length),d.end.steps=d.end.steps.slice(d.path.steps.length)}return d}},{key:"fromNode",value:function(a,b,c){var d={range:!1,base:{},path:{},start:null,end:null};return"string"==typeof b?(d.base=this.parseComponent(b),d.spinePos=d.base.steps[1].index):"object"===(void 0===b?"undefined":e(b))&&(d.base=b),d.path=this.pathTo(a,null,c),d}},{key:"filter",value:function(a,b){var c,d,e,f,g,h=!1;return a.nodeType===i?(h=!0,e=a.parentNode,c=a.parentNode.classList.contains(b)):(h=!1,c=a.classList.contains(b)),c&&h?(f=e.previousSibling,g=e.nextSibling,f&&f.nodeType===i?d=f:g&&g.nodeType===i&&(d=g),d||a):!(c&&!h)&&a}},{key:"patchOffset",value:function(a,b,c){if(a.nodeType!=i)throw new Error("Anchor must be a text node");var d=a,e=b;for(a.parentNode.classList.contains(c)&&(d=a.parentNode);d.previousSibling;){if(d.previousSibling.nodeType===h){if(!d.previousSibling.classList.contains(c))break;e+=d.previousSibling.textContent.length}else e+=d.previousSibling.textContent.length;d=d.previousSibling}return e}},{key:"normalizedMap",value:function(a,b,c){var d,e,f,g={},j=-1,k=a.length;for(d=0;d<k;d++)e=a[d].nodeType,e===h&&a[d].classList.contains(c)&&(e=i),d>0&&e===i&&f===i?g[d]=j:b===e&&(j+=1,g[d]=j),f=e;return g}},{key:"position",value:function(a){var b,c;return a.nodeType===h?(b=a.parentNode.children,b||(b=(0,g.findChildren)(a.parentNode)),c=Array.prototype.indexOf.call(b,a)):(b=this.textNodes(a.parentNode),c=b.indexOf(a)),c}},{key:"filteredPosition",value:function(a,b){var c,d,e;return a.nodeType===h?(c=a.parentNode.children,e=this.normalizedMap(c,h,b)):(c=a.parentNode.childNodes,a.parentNode.classList.contains(b)&&(a=a.parentNode,c=a.parentNode.childNodes),e=this.normalizedMap(c,i,b)),d=Array.prototype.indexOf.call(c,a),e[d]}},{key:"stepsToXpath",value:function(a){var b=[".","*"];return a.forEach(function(a){var c=a.index+1;a.id?b.push("*[position()="+c+" and @id='"+a.id+"']"):"text"===a.type?b.push("text()["+c+"]"):b.push("*["+c+"]")}),b.join("/")}},{key:"stepsToQuerySelector",value:function(a){var b=["html"];return a.forEach(function(a){var c=a.index+1;a.id?b.push("#"+a.id):"text"===a.type||b.push("*:nth-child("+c+")")}),b.join(">")}},{key:"textNodes",value:function(a,b){return Array.prototype.slice.call(a.childNodes).filter(function(a){return a.nodeType===i||!(!b||!a.classList.contains(b))})}},{key:"walkToNode",value:function(a,b,c){var d,e,f,h=b||document,i=h.documentElement,j=a.length;for(f=0;f<j&&(e=a[f],"element"===e.type?e.id?i=h.getElementById(e.id):(d=i.children||(0,g.findChildren)(i),i=d[e.index]):"text"===e.type&&(i=this.textNodes(i,c)[e.index]),i);f++);return i}},{key:"findNode",value:function(a,b,c){var d,e,f=b||document;return c||void 0===f.evaluate?d=c?this.walkToNode(a,f,c):this.walkToNode(a,f):(e=this.stepsToXpath(a),d=f.evaluate(e,f,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),d}},{key:"fixMiss",value:function(a,b,c,d){var e,f,g=this.findNode(a.slice(0,-1),c,d),j=g.childNodes,k=this.normalizedMap(j,i,d),l=a[a.length-1].index;for(var m in k){if(!k.hasOwnProperty(m))return;if(k[m]===l){if(e=j[m],f=e.textContent.length,!(b>f)){g=e.nodeType===h?e.childNodes[0]:e;break}b-=f}}return{container:g,offset:b}}},{key:"toRange",value:function(a,b){var c,d,e,f,h,i,j,k,l=a||document,m=this,n=!!b&&null!=l.querySelector("."+b);if(c=void 0!==l.createRange?l.createRange():new g.RangeObject,m.range?(d=m.start,i=m.path.steps.concat(d.steps),f=this.findNode(i,l,n?b:null),e=m.end,j=m.path.steps.concat(e.steps),h=this.findNode(j,l,n?b:null)):(d=m.path,i=m.path.steps,f=this.findNode(m.path.steps,l,n?b:null)),!f)return console.log("No startContainer found for",this.toString()),null;try{null!=d.terminal.offset?c.setStart(f,d.terminal.offset):c.setStart(f,0)}catch(a){k=this.fixMiss(i,d.terminal.offset,l,n?b:null),c.setStart(k.container,k.offset)}if(h)try{null!=e.terminal.offset?c.setEnd(h,e.terminal.offset):c.setEnd(h,0)}catch(a){k=this.fixMiss(j,m.end.terminal.offset,l,n?b:null),c.setEnd(k.container,k.offset)}return c}},{key:"isCfiString",value:function(a){return"string"==typeof a&&0===a.indexOf("epubcfi(")&&")"===a[a.length-1]}},{key:"generateChapterComponent",value:function(a,b,c){var d=parseInt(b),e=2*(a+1),f="/"+e+"/";return f+=2*(d+1),c&&(f+="["+c+"]"),f}},{key:"collapse",value:function(a){this.range&&(this.range=!1,a?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),a}();b.default=k,a.exports=b.default},function(a,b,c){"use strict";var d,e,f,g,h,i,j,k=c(27),l=c(41),m=Function.prototype.apply,n=Function.prototype.call,o=Object.create,p=Object.defineProperty,q=Object.defineProperties,r=Object.prototype.hasOwnProperty,s={configurable:!0,enumerable:!1,writable:!0};d=function(a,b){var c;return l(b),r.call(this,"__ee__")?c=this.__ee__:(c=s.value=o(null),p(this,"__ee__",s),s.value=null),c[a]?"object"==typeof c[a]?c[a].push(b):c[a]=[c[a],b]:c[a]=b,this},e=function(a,b){var c,e;return l(b),e=this,d.call(this,a,c=function(){f.call(e,a,c),m.call(b,this,arguments)}),c.__eeOnceListener__=b,this},f=function(a,b){var c,d,e,f;if(l(b),!r.call(this,"__ee__"))return this;if(c=this.__ee__,!c[a])return this;if("object"==typeof(d=c[a]))for(f=0;e=d[f];++f)e!==b&&e.__eeOnceListener__!==b||(2===d.length?c[a]=d[f?0:1]:d.splice(f,1));else d!==b&&d.__eeOnceListener__!==b||delete c[a];return this},g=function(a){var b,c,d,e,f;if(r.call(this,"__ee__")&&(e=this.__ee__[a]))if("object"==typeof e){for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];for(e=e.slice(),b=0;d=e[b];++b)m.call(d,this,f)}else switch(arguments.length){case 1:n.call(e,this);break;case 2:n.call(e,this,arguments[1]);break;case 3:n.call(e,this,arguments[1],arguments[2]);break;default:for(c=arguments.length,f=new Array(c-1),b=1;b<c;++b)f[b-1]=arguments[b];m.call(e,this,f)}},h={on:d,once:e,off:f,emit:g},i={on:k(d),once:k(e),off:k(f),emit:k(g)},j=q({},i),a.exports=b=function(a){return null==a?o(j):q(Object(a),i)},b.methods=h},function(a,b,c){"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.DOM_EVENTS=["keydown","keyup","keypressed","mouseup","mousedown","click","touchend","touchstart"],b.EVENTS={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled"},VIEWS:{AXIS:"axis",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"}}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=function(){function a(b){e(this,a);var c,d;c=b.indexOf("://"),c>-1&&(b=new URL(b).pathname),d=this.parse(b),this.path=b,this.isDirectory(b)?this.directory=b:this.directory=d.dir+"/",this.filename=d.base,this.extension=d.ext.slice(1)}return f(a,[{key:"parse",value:function(a){return h.default.parse(a)}},{key:"isAbsolute",value:function(a){return h.default.isAbsolute(a||this.path)}},{key:"isDirectory",value:function(a){return"/"===a.charAt(a.length-1)}},{key:"resolve",value:function(a){return h.default.resolve(this.directory,a)}},{key:"relative",value:function(a){return h.default.relative(this.directory,a)}},{key:"splitPath",value:function(a){return this.splitPathRe.exec(a).slice(1)}},{key:"toString",value:function(){return this.path}}]),a}();b.default=i,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(4),h=d(g),i=c(6),j=d(i),k=function(){function a(b,c){e(this,a);var d,f=b.indexOf("://")>-1,g=b;if(this.Url=void 0,this.href=b,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=c,!f&&!1!==c&&"string"!=typeof c&&window&&window.location&&(this.base=window.location.href),f||this.base)try{this.base?this.Url=new URL(b,this.base):this.Url=new URL(b),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,g=this.Url.pathname}catch(a){this.Url=void 0,this.base&&(d=new h.default(this.base),g=d.resolve(g))}this.Path=new h.default(g),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return f(a,[{key:"path",value:function(){return this.Path}},{key:"resolve",value:function(a){var b,c=a.indexOf("://")>-1;return c?a:(b=j.default.resolve(this.directory,a),this.origin+b)}},{key:"relative",value:function(a){return j.default.relative(a,this.directory)}},{key:"toString",value:function(){return this.href}}]),a}();b.default=k,a.exports=b.default},function(a,b,c){"use strict";function d(a){if("string"!=typeof a)throw new TypeError("Path must be a string. Received "+a)}function e(a,b){for(var c,d="",e=-1,f=0,g=0;g<=a.length;++g){if(g<a.length)c=a.charCodeAt(g);else{if(47===c)break;c=47}if(47===c){if(e===g-1||1===f);else if(e!==g-1&&2===f){if(d.length<2||46!==d.charCodeAt(d.length-1)||46!==d.charCodeAt(d.length-2))if(d.length>2){for(var h=d.length-1,i=h;i>=0&&47!==d.charCodeAt(i);--i);if(i!==h){d=-1===i?"":d.slice(0,i),e=g,f=0;continue}}else if(2===d.length||1===d.length){d="",e=g,f=0;continue}b&&(d.length>0?d+="/..":d="..")}else d.length>0?d+="/"+a.slice(e+1,g):d=a.slice(e+1,g);e=g,f=0}else 46===c&&-1!==f?++f:f=-1}return d}function f(a,b){var c=b.dir||b.root,d=b.base||(b.name||"")+(b.ext||"");return c?c===b.root?c+d:c+a+d:d}if(!g)var g={cwd:function(){return"/"}};var h={resolve:function(){for(var a,b="",c=!1,f=arguments.length-1;f>=-1&&!c;f--){var h;f>=0?h=arguments[f]:(void 0===a&&(a=g.cwd()),h=a),d(h),0!==h.length&&(b=h+"/"+b,c=47===h.charCodeAt(0))}return b=e(b,!c),c?b.length>0?"/"+b:"/":b.length>0?b:"."},normalize:function(a){if(d(a),0===a.length)return".";var b=47===a.charCodeAt(0),c=47===a.charCodeAt(a.length-1);return a=e(a,!b),0!==a.length||b||(a="."),a.length>0&&c&&(a+="/"),b?"/"+a:a},isAbsolute:function(a){return d(a),a.length>0&&47===a.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var a,b=0;b<arguments.length;++b){var c=arguments[b];d(c),c.length>0&&(void 0===a?a=c:a+="/"+c)}return void 0===a?".":h.normalize(a)},relative:function(a,b){if(d(a),d(b),a===b)return"";if(a=h.resolve(a),b=h.resolve(b),a===b)return"";for(var c=1;c<a.length&&47===a.charCodeAt(c);++c);for(var e=a.length,f=e-c,g=1;g<b.length&&47===b.charCodeAt(g);++g);for(var i=b.length,j=i-g,k=f<j?f:j,l=-1,m=0;m<=k;++m){if(m===k){if(j>k){if(47===b.charCodeAt(g+m))return b.slice(g+m+1);if(0===m)return b.slice(g+m)}else f>k&&(47===a.charCodeAt(c+m)?l=m:0===m&&(l=0));break}var n=a.charCodeAt(c+m);if(n!==b.charCodeAt(g+m))break;47===n&&(l=m)}var o="";for(m=c+l+1;m<=e;++m)m!==e&&47!==a.charCodeAt(m)||(0===o.length?o+="..":o+="/..");return o.length>0?o+b.slice(g+l):(g+=l,47===b.charCodeAt(g)&&++g,b.slice(g))},_makeLong:function(a){return a},dirname:function(a){if(d(a),0===a.length)return".";for(var b=a.charCodeAt(0),c=47===b,e=-1,f=!0,g=a.length-1;g>=1;--g)if(47===(b=a.charCodeAt(g))){if(!f){e=g;break}}else f=!1;return-1===e?c?"/":".":c&&1===e?"//":a.slice(0,e)},basename:function(a,b){if(void 0!==b&&"string"!=typeof b)throw new TypeError('"ext" argument must be a string');d(a);var c,e=0,f=-1,g=!0;if(void 0!==b&&b.length>0&&b.length<=a.length){if(b.length===a.length&&b===a)return"";var h=b.length-1,i=-1;for(c=a.length-1;c>=0;--c){var j=a.charCodeAt(c);if(47===j){if(!g){e=c+1;break}}else-1===i&&(g=!1,i=c+1),h>=0&&(j===b.charCodeAt(h)?-1==--h&&(f=c):(h=-1,f=i))}return e===f?f=i:-1===f&&(f=a.length),a.slice(e,f)}for(c=a.length-1;c>=0;--c)if(47===a.charCodeAt(c)){if(!g){e=c+1;break}}else-1===f&&(g=!1,f=c+1);return-1===f?"":a.slice(e,f)},extname:function(a){d(a);for(var b=-1,c=0,e=-1,f=!0,g=0,h=a.length-1;h>=0;--h){var i=a.charCodeAt(h);if(47!==i)-1===e&&(f=!1,e=h+1),46===i?-1===b?b=h:1!==g&&(g=1):-1!==b&&(g=-1);else if(!f){c=h+1;break}}return-1===b||-1===e||0===g||1===g&&b===e-1&&b===c+1?"":a.slice(b,e)},format:function(a){if(null===a||"object"!=typeof a)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof a);return f("/",a)},parse:function(a){d(a);var b={root:"",dir:"",base:"",ext:"",name:""};if(0===a.length)return b;var c,e=a.charCodeAt(0),f=47===e;f?(b.root="/",c=1):c=0;for(var g=-1,h=0,i=-1,j=!0,k=a.length-1,l=0;k>=c;--k)if(47!==(e=a.charCodeAt(k)))-1===i&&(j=!1,i=k+1),46===e?-1===g?g=k:1!==l&&(l=1):-1!==g&&(l=-1);else if(!j){h=k+1;break}return-1===g||-1===i||0===l||1===l&&g===i-1&&g===h+1?-1!==i&&(b.base=b.name=0===h&&f?a.slice(1,i):a.slice(h,i)):(0===h&&f?(b.name=a.slice(1,g),b.base=a.slice(1,i)):(b.name=a.slice(h,g),b.base=a.slice(h,i)),b.ext=a.slice(g,i)),h>0?b.dir=a.slice(0,h-1):f&&(b.dir="/"),b},sep:"/",delimiter:":",posix:null};a.exports=h},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){var c,d,e=b.url,f=e.indexOf("://")>-1;a&&(d=(0,j.qs)(a,"head"),c=(0,j.qs)(d,"base"),c||(c=a.createElement("base"),d.insertBefore(c,d.firstChild)),!f&&window&&window.location&&(e=window.location.origin+e),c.setAttribute("href",e))}function f(a,b){var c,d,e=b.canonical;a&&(c=(0,j.qs)(a,"head"),d=(0,j.qs)(c,"link[rel='canonical']"),d?d.setAttribute("href",e):(d=a.createElement("link"),d.setAttribute("rel","canonical"),d.setAttribute("href",e),c.appendChild(d)))}function g(a,b){var c,d,e=b.idref;a&&(c=(0,j.qs)(a,"head"),d=(0,j.qs)(c,"link[property='dc.identifier']"),d?d.setAttribute("content",e):(d=a.createElement("meta"),d.setAttribute("name","dc.identifier"),d.setAttribute("content",e),c.appendChild(d)))}function h(a,b){var c=a.querySelectorAll("a[href]");if(c.length)for(var d=(0,j.qs)(a.ownerDocument,"base"),e=d?d.getAttribute("href"):void 0,f=function(a){var c=a.getAttribute("href");if(0!==c.indexOf("mailto:")){var d=c.indexOf("://")>-1,f=new l.default(c,e);d?a.setAttribute("target","_blank"):a.onclick=function(){return b(f&&f.hash?f.Path.path+f.hash:f?f.Path.path:c),!1}}}.bind(this),g=0;g<c.length;g++)f(c[g])}function i(a,b,c){return b.forEach(function(b,d){b&&c[d]&&(a=a.replace(new RegExp(b,"g"),c[d]))}),a}Object.defineProperty(b,"__esModule",{value:!0}),b.replaceBase=e,b.replaceCanonical=f,b.replaceMeta=g,b.replaceLinks=h,b.substitute=i;var j=c(0),k=c(5),l=d(k),m=c(4);d(m)},function(a,b){var c;c=function(){return this}();try{c=c||Function("return this")()||(0,eval)("this")}catch(a){"object"==typeof window&&(c=window)}a.exports=c},function(a,b,c){"use strict";var d=c(34)();a.exports=function(a){return a!==d&&null!==a}},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.context=b||this,this.hooks=[]}return e(a,[{key:"register",value:function(){for(var a=0;a<arguments.length;++a)if("function"==typeof arguments[a])this.hooks.push(arguments[a]);else for(var b=0;b<arguments[a].length;++b)this.hooks.push(arguments[a][b])}},{key:"trigger",value:function(){var a=arguments,b=this.context,c=[];return this.hooks.forEach(function(d){var e=d.apply(b,a);e&&"function"==typeof e.then&&c.push(e)}),Promise.all(c)}},{key:"list",value:function(){return this.hooks}},{key:"clear",value:function(){return this.hooks=[]}}]),a}();b.default=f,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b,c,d){function e(a){l.reject(a)}function g(){if(this.readyState===XMLHttpRequest.DONE){var a=!1;if(""!==this.responseType&&"document"!==this.responseType||(a=this.responseXML),200===this.status||0===this.status||a){var c;if(!this.response&&!a)return l.reject({status:this.status,message:"Empty Response",stack:(new Error).stack}),l.promise;if(403===this.status)return l.reject({status:this.status,response:this.response,message:"Forbidden",stack:(new Error).stack}),l.promise;c=a?this.responseXML:(0,f.isXml)(b)?(0,f.parse)(this.response,"text/xml"):"xhtml"==b?(0,f.parse)(this.response,"application/xhtml+xml"):"html"==b||"htm"==b?(0,f.parse)(this.response,"text/html"):"json"==b?JSON.parse(this.response):"blob"==b?j?this.response:new Blob([this.response]):this.response,l.resolve(c)}else l.reject({status:this.status,message:this.response,stack:(new Error).stack})}}var i,j="undefined"!=typeof window&&window.URL,k=j?"blob":"arraybuffer",l=new f.defer,m=new XMLHttpRequest,n=XMLHttpRequest.prototype;"overrideMimeType"in n||Object.defineProperty(n,"overrideMimeType",{value:function(){}}),c&&(m.withCredentials=!0),m.onreadystatechange=g,m.onerror=e,m.open("GET",a,!0);for(i in d)m.setRequestHeader(i,d[i]);return"json"==b&&m.setRequestHeader("Accept","application/json"),b||(b=new h.default(a).extension),"blob"==b&&(m.responseType=k),(0,f.isXml)(b)&&m.overrideMimeType("text/xml"),"binary"==b&&(m.responseType="arraybuffer"),m.send(),l.promise}Object.defineProperty(b,"__esModule",{value:!0});var f=c(0),g=c(4),h=d(g);b.default=e,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0}),b.Task=void 0;var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=function(){function a(b){d(this,a),this._q=[],this.context=b,this.tick=f.requestAnimationFrame,this.running=!1,this.paused=!1}return e(a,[{key:"enqueue",value:function(){var a,b,c,d=[].shift.call(arguments),e=arguments;if(!d)throw new Error("No Task Provided");return"function"==typeof d?(a=new f.defer,b=a.promise,c={task:d,args:e,deferred:a,promise:b}):c={promise:d},this._q.push(c),0!=this.paused||this.running||this.run(),c.promise}},{key:"dequeue",value:function(){var a,b,c;return!this._q.length||this.paused?(a=new f.defer,a.deferred.resolve(),a.promise):(a=this._q.shift(),(b=a.task)?(c=b.apply(this.context,a.args),c&&"function"==typeof c.then?c.then(function(){a.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){a.deferred.reject.apply(this.context,arguments)}.bind(this)):(a.deferred.resolve.apply(this.context,c),a.promise)):a.promise?a.promise:void 0)}},{key:"dump",value:function(){for(;this._q.length;)this.dequeue()}},{key:"run",value:function(){var a=this;return this.running||(this.running=!0,this.defered=new f.defer),this.tick.call(window,function(){a._q.length?a.dequeue().then(function(){this.run()}.bind(a)):(a.defered.resolve(),a.running=void 0)}),1==this.paused&&(this.paused=!1),this.defered.promise}},{key:"flush",value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:"clear",value:function(){this._q=[]}},{key:"length",value:function(){return this._q.length}},{key:"pause",value:function(){this.paused=!0}},{key:"stop",value:function(){this._q=[],this.running=!1,this.paused=!0}}]),a}(),h=function a(b,c,e){return d(this,a),function(){var a=this,c=arguments||[];return new Promise(function(d,f){var g=function(a,b){!a&&b?f(b):d(a)};c.push(g),b.apply(e||a,c)})}};b.default=g,b.Task=h},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(0),j=c(1),k=d(j),l=c(19),m=d(l),n=c(7),o=c(3),p="undefined"!=typeof navigator,q=p&&/Chrome/.test(navigator.userAgent),r=p&&!q&&/AppleWebKit/.test(navigator.userAgent),s=1,t=function(){function a(b,c,d,f){e(this,a),this.epubcfi=new k.default,this.document=b,this.documentElement=this.document.documentElement,this.content=c||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=f||0,this.cfiBase=d||"",this.epubReadingSystem("epub.js",ePub.VERSION),this.listeners()}return f(a,[{key:"width",value:function(a){var b=this.content;return a&&(0,i.isNumber)(a)&&(a+="px"),a&&(b.style.width=a),this.window.getComputedStyle(b).width}},{key:"height",value:function(a){var b=this.content;return a&&(0,i.isNumber)(a)&&(a+="px"),a&&(b.style.height=a),this.window.getComputedStyle(b).height}},{key:"contentWidth",value:function(a){var b=this.content||this.document.body;return a&&(0,i.isNumber)(a)&&(a+="px"),a&&(b.style.width=a),this.window.getComputedStyle(b).width}},{key:"contentHeight",value:function(a){var b=this.content||this.document.body;return a&&(0,i.isNumber)(a)&&(a+="px"),a&&(b.style.height=a),this.window.getComputedStyle(b).height}},{key:"textWidth",value:function(){var a=void 0,b=this.document.createRange(),c=this.content||this.document.body,d=(0,i.borders)(c);return b.selectNodeContents(c),a=b.getBoundingClientRect().width,d&&d.width&&(a+=d.width),Math.round(a)}},{key:"textHeight",value:function(){var a=void 0,b=this.document.createRange(),c=this.content||this.document.body,d=(0,i.borders)(c);return b.selectNodeContents(c),a=b.getBoundingClientRect().height,a&&d.height&&(a+=d.height),Math.round(a)}},{key:"scrollWidth",value:function(){return this.documentElement.scrollWidth}},{key:"scrollHeight",value:function(){return this.documentElement.scrollHeight}},{key:"overflow",value:function(a){return a&&(this.documentElement.style.overflow=a),this.window.getComputedStyle(this.documentElement).overflow}},{key:"overflowX",value:function(a){return a&&(this.documentElement.style.overflowX=a),this.window.getComputedStyle(this.documentElement).overflowX}},{key:"overflowY",value:function(a){return a&&(this.documentElement.style.overflowY=a),this.window.getComputedStyle(this.documentElement).overflowY}},{key:"css",value:function(a,b,c){var d=this.content||this.document.body;return b&&d.style.setProperty(a,b,c?"important":""),this.window.getComputedStyle(d)[a]}},{key:"viewport",value:function(a){var b=this.document.querySelector("meta[name='viewport']"),c={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},d=[],e={};if(b&&b.hasAttribute("content")){var f=b.getAttribute("content"),g=f.match(/width\s*=\s*([^,]*)/),h=f.match(/height\s*=\s*([^,]*)/),j=f.match(/initial-scale\s*=\s*([^,]*)/),k=f.match(/minimum-scale\s*=\s*([^,]*)/),l=f.match(/maximum-scale\s*=\s*([^,]*)/),m=f.match(/user-scalable\s*=\s*([^,]*)/);g&&g.length&&void 0!==g[1]&&(c.width=g[1]),h&&h.length&&void 0!==h[1]&&(c.height=h[1]),j&&j.length&&void 0!==j[1]&&(c.scale=j[1]),k&&k.length&&void 0!==k[1]&&(c.minimum=k[1]),l&&l.length&&void 0!==l[1]&&(c.maximum=l[1]),m&&m.length&&void 0!==m[1]&&(c.scalable=m[1])}return e=(0,i.defaults)(a||{},c),a&&(e.width&&d.push("width="+e.width),e.height&&d.push("height="+e.height),e.scale&&d.push("initial-scale="+e.scale),"no"===e.scalable?(d.push("minimum-scale="+e.scale),d.push("maximum-scale="+e.scale),d.push("user-scalable="+e.scalable)):(e.scalable&&d.push("user-scalable="+e.scalable),e.minimum&&d.push("minimum-scale="+e.minimum),e.maximum&&d.push("minimum-scale="+e.maximum)),b||(b=this.document.createElement("meta"),b.setAttribute("name","viewport"),this.document.querySelector("head").appendChild(b)),b.setAttribute("content",d.join(", ")),this.window.scrollTo(0,0)),e}},{key:"expand",value:function(){this.emit(o.EVENTS.CONTENTS.EXPAND)}},{key:"listeners",value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:"removeListeners",value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:"resizeCheck",value:function(){var a=this.textWidth(),b=this.textHeight();a==this._size.width&&b==this._size.height||(this._size={width:a,height:b},this.onResize&&this.onResize(this._size),this.emit(o.EVENTS.CONTENTS.RESIZE,this._size))}},{key:"resizeListeners",value:function(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:"transitionListeners",value:function(){var a=this.content;a.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",a.style.transitionDuration="0.001ms",a.style.transitionTimingFunction="linear",a.style.transitionDelay="0",this.document.addEventListener("transitionend",this.resizeCheck.bind(this))}},{key:"mediaQueryListeners",value:function(){for(var a=this.document.styleSheets,b=function(a){a.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),c=0;c<a.length;c+=1){var d;try{d=a[c].cssRules}catch(a){return}if(!d)return;for(var e=0;e<d.length;e+=1)if(d[e].media){var f=this.window.matchMedia(d[e].media.mediaText);f.addListener(b)}}}},{key:"resizeObservers",value:function(){var a=this;this.observer=new MutationObserver(function(b){a.resizeCheck()});var b={attributes:!0,childList:!0,characterData:!0,subtree:!0};this.observer.observe(this.document,b)}},{key:"imageLoadListeners",value:function(a){for(var b,c=this.document.querySelectorAll("img"),d=0;d<c.length;d++)b=c[d],void 0!==b.naturalWidth&&0===b.naturalWidth&&(b.onload=this.expand.bind(this))}},{key:"fontLoadListeners",value:function(a){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}},{key:"root",value:function(){return this.document?this.document.documentElement:null}},{key:"locationOf",value:function(a,b){var c,d={left:0,top:0};if(!this.document)return d;if(this.epubcfi.isCfiString(a)){var e=new k.default(a).toRange(this.document,b);if(e)if(e.startContainer.nodeType===Node.ELEMENT_NODE)c=e.startContainer.getBoundingClientRect(),d.left=c.left,d.top=c.top;else if(r){var f=e.startContainer,g=new Range;try{f.nodeType===s?c=f.getBoundingClientRect():e.startOffset+2<f.length?(g.setStart(f,e.startOffset),g.setEnd(f,e.startOffset+2),c=g.getBoundingClientRect()):e.startOffset-2>0?(g.setStart(f,e.startOffset-2),g.setEnd(f,e.startOffset),c=g.getBoundingClientRect()):c=f.parentNode.getBoundingClientRect()}catch(a){console.error(a,a.stack)}}else c=e.getBoundingClientRect()}else if("string"==typeof a&&a.indexOf("#")>-1){var h=a.substring(a.indexOf("#")+1),i=this.document.getElementById(h);i&&(c=i.getBoundingClientRect())}return c&&(d.left=c.left,d.top=c.top),d}},{key:"addStylesheet",value:function(a){return new Promise(function(b,c){var d,e=!1;return this.document?(d=this.document.querySelector("link[href='"+a+"']"))?void b(!0):(d=this.document.createElement("link"),d.type="text/css",d.rel="stylesheet",d.href=a,d.onload=d.onreadystatechange=function(){e||this.readyState&&"complete"!=this.readyState||(e=!0,setTimeout(function(){b(!0)},1))},void this.document.head.appendChild(d)):void b(!1)}.bind(this))}},{key:"addStylesheetRules",value:function(a){var b,c,d="epubjs-inserted-css";if(this.document&&a&&0!==a.length)if(b=this.document.getElementById("#"+d),b||(b=this.document.createElement("style"),b.id=d),this.document.head.appendChild(b),c=b.sheet,"[object Array]"===Object.prototype.toString.call(a))for(var e=0,f=a.length;e<f;e++){var g=1,h=a[e],i=a[e][0],j="";"[object Array]"===Object.prototype.toString.call(h[1][0])&&(h=h[1],g=0);for(var k=h.length;g<k;g++){var l=h[g];j+=l[0]+":"+l[1]+(l[2]?" !important":"")+";\n"}c.insertRule(i+"{"+j+"}",c.cssRules.length)}else{var m=Object.keys(a);m.forEach(function(b){var d=a[b];if(Array.isArray(d))d.forEach(function(a){var d=Object.keys(a),e=d.map(function(b){return b+":"+a[b]}).join(";");c.insertRule(b+"{"+e+"}",c.cssRules.length)});else{var e=Object.keys(d),f=e.map(function(a){return a+":"+d[a]}).join(";");c.insertRule(b+"{"+f+"}",c.cssRules.length)}})}}},{key:"addScript",value:function(a){return new Promise(function(b,c){var d,e=!1;if(!this.document)return void b(!1);d=this.document.createElement("script"),d.type="text/javascript",d.async=!0,d.src=a,d.onload=d.onreadystatechange=function(){e||this.readyState&&"complete"!=this.readyState||(e=!0,setTimeout(function(){b(!0)},1))},this.document.head.appendChild(d)}.bind(this))}},{key:"addClass",value:function(a){var b;this.document&&(b=this.content||this.document.body)&&b.classList.add(a)}},{key:"removeClass",value:function(a){var b;this.document&&(b=this.content||this.document.body)&&b.classList.remove(a)}},{key:"addEventListeners",value:function(){this.document&&o.DOM_EVENTS.forEach(function(a){this.document.addEventListener(a,this.triggerEvent.bind(this),!1)},this)}},{key:"removeEventListeners",value:function(){this.document&&o.DOM_EVENTS.forEach(function(a){this.document.removeEventListener(a,this.triggerEvent,!1)},this)}},{key:"triggerEvent",value:function(a){this.emit(a.type,a)}},{key:"addSelectionListeners",value:function(){this.document&&this.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)}},{key:"removeSelectionListeners",value:function(){this.document&&this.document.removeEventListener("selectionchange",this.onSelectionChange,!1)}},{key:"onSelectionChange",value:function(a){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var a=this.window.getSelection();this.triggerSelectedEvent(a)}.bind(this),250)}},{key:"triggerSelectedEvent",value:function(a){var b,c;a&&a.rangeCount>0&&(b=a.getRangeAt(0),b.collapsed||(c=new k.default(b,this.cfiBase).toString(),this.emit(o.EVENTS.CONTENTS.SELECTED,c),this.emit(o.EVENTS.CONTENTS.SELECTED_RANGE,b)))}},{key:"range",value:function(a,b){return new k.default(a).toRange(this.document,b)}},{key:"cfiFromRange",value:function(a,b){return new k.default(a,this.cfiBase,b).toString()}},{key:"cfiFromNode",value:function(a,b){return new k.default(a,this.cfiBase,b).toString()}},{key:"map",value:function(a){return new m.default(a).section()}},{key:"size",value:function(a,b){var c={scale:1,scalable:"no"};this.layoutStyle("scrolling"),a>=0&&(this.width(a),c.width=a,this.css("padding","0 "+a/12+"px",!0)),b>=0&&(this.height(b),c.height=b),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(c)}},{key:"columns",value:function(a,b,c,d){var e=(0,i.prefixed)("column-axis"),f=(0,i.prefixed)("column-gap"),g=(0,i.prefixed)("column-width"),h=(0,i.prefixed)("column-fill"),j=this.writingMode(),k=0===j.indexOf("vertical")?"vertical":"horizontal";this.layoutStyle("paginated"),"rtl"===this.content.dir&&this.direction("rtl"),this.width(a),this.height(b),this.viewport({width:a,height:b,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),"vertical"===k?this.css("padding",d/2+"px 20px",!0):this.css("padding","20px "+d/2+"px",!0),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(e,"horizontal"),this.css(h,"auto"),this.css(f,d+"px"),this.css(g,c+"px")}},{key:"scaler",value:function(a,b,c){var d="scale("+a+")",e="";this.css("transform-origin","top left"),(b>=0||c>=0)&&(e=" translate("+(b||0)+"px, "+(c||0)+"px )"),this.css("transform",d+e)}},{key:"fit",value:function(a,b){var c=this.viewport(),d=a/parseInt(c.width),e=b/parseInt(c.height),f=d<e?d:e,g=(b-c.height*f)/2;this.layoutStyle("paginated"),this.width(a),this.height(b),this.overflow("hidden"),this.scaler(f,0,g),this.css("background-color","transparent")}},{key:"direction",value:function(a){this.documentElement&&(this.documentElement.style.direction=a)}},{key:"mapPage",value:function(a,b,c,d,e){return new m.default(b,e).page(this,a,c,d)}},{key:"linksHandler",value:function(){var a=this;(0,n.replaceLinks)(this.content,function(b){a.emit(o.EVENTS.CONTENTS.LINK_CLICKED,b)})}},{key:"writingMode",value:function(a){var b=(0,i.prefixed)("writing-mode");return a&&this.documentElement&&(this.documentElement.style[b]=a),this.window.getComputedStyle(this.documentElement)[b]||""}},{key:"layoutStyle",value:function(a){return a&&(this._layoutStyle=a,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}},{key:"epubReadingSystem",value:function(a,b){return navigator.epubReadingSystem={name:a,version:b,layoutStyle:this.layoutStyle(),hasFeature:function(a){switch(a){case"dom-manipulation":case"layout-changes":case"touch-events":case"mouse-events":case"keyboard-events":return!0;case"spine-scripting":default:return!1}}},navigator.epubReadingSystem}},{key:"destroy",value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener("transitionend",this.resizeCheck),this.removeListeners()}}],[{key:"listenedEvents",get:function(){return o.DOM_EVENTS}}]),a}();(0,h.default)(t.prototype),b.default=t,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(0),j=c(19),k=d(j),l=c(12),m=d(l),n=c(56),o=d(n),p=c(66),q=d(p),r=c(3),s=function(){function a(b){e(this,a),this.name="default",this.View=b.view,this.request=b.request,this.renditionQueue=b.queue,this.q=new m.default(this),this.settings=(0,i.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,flow:"scrolled",ignoreClass:""}),(0,i.extend)(this.settings,b.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0},this.rendered=!1}return f(a,[{key:"render",value:function(a,b){var c=a.tagName;!c||"body"!=c.toLowerCase()&&"html"!=c.toLowerCase()||(this.fullsize=!0),this.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=b,this.stage=new o.default({width:b.width,height:b.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.fullsize,direction:this.settings.direction}),this.stage.attachTo(a),this.container=this.stage.getContainer(),this.views=new q.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}},{key:"addEventListeners",value:function(){var a;window.addEventListener("unload",function(a){this.destroy()}.bind(this)),a=this.fullsize?window:this.container,a.addEventListener("scroll",this.onScroll.bind(this))}},{key:"removeEventListeners",value:function(){var a;a=this.fullsize?window:this.container,a.removeEventListener("scroll",this.onScroll.bind(this))}},{key:"destroy",value:function(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}},{key:"onOrientationChange",value:function(a){var b=window,c=b.orientation;this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.resize(),this.emit(r.EVENTS.MANAGERS.ORIENTATION_CHANGE,c)}.bind(this),500)}},{key:"onResized",value:function(a){this.resize()}},{key:"resize",value:function(a,b){var c=this.stage.size(a,b);if(this.winBounds=(0,i.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height)return void(this._stageSize=void 0);this._stageSize&&this._stageSize.width===c.width&&this._stageSize.height===c.height||(this._stageSize=c,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(r.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height}))}},{key:"createView",value:function(a){return new this.View(a,this.viewSettings)}},{key:"display",value:function(a,b){var c=new i.defer,d=c.promise;(b===a.href||(0,i.isNumber)(b))&&(b=void 0);var e=this.views.find(a);if(e&&a){var f=e.offset();if("ltr"===this.settings.direction)this.scrollTo(f.left,f.top,!0);else{var g=e.width();this.scrollTo(f.left+g,f.top,!0)}if(b){var h=e.locationOf(b);this.moveTo(h)}return c.resolve(),d}return this.clear(),this.add(a).then(function(a){if(b){var c=a.locationOf(b);this.moveTo(c)}}.bind(this),function(a){c.reject(a)}).then(function(){var b;if("pre-paginated"===this.layout.name&&this.layout.divisor>1&&(b=a.next()))return this.add(b)}.bind(this)).then(function(){this.views.show(),c.resolve()}.bind(this)),d}},{key:"afterDisplayed",value:function(a){this.emit(r.EVENTS.MANAGERS.ADDED,a)}},{key:"afterResized",value:function(a){this.emit(r.EVENTS.MANAGERS.RESIZE,a.section)}},{key:"moveTo",value:function(a){var b=0,c=0;this.isPaginated?(b=Math.floor(a.left/this.layout.delta)*this.layout.delta)+this.layout.delta>this.container.scrollWidth&&(b=this.container.scrollWidth-this.layout.delta):c=a.top,this.scrollTo(b,c,!0)}},{key:"add",value:function(a){var b=this,c=this.createView(a);return this.views.append(c),c.onDisplayed=this.afterDisplayed.bind(this),c.onResize=this.afterResized.bind(this),c.on(r.EVENTS.VIEWS.AXIS,function(a){b.updateAxis(a)}),c.display(this.request)}},{key:"append",value:function(a){var b=this,c=this.createView(a);return this.views.append(c),c.onDisplayed=this.afterDisplayed.bind(this),c.onResize=this.afterResized.bind(this),c.on(r.EVENTS.VIEWS.AXIS,function(a){b.updateAxis(a)}),c.display(this.request)}},{key:"prepend",value:function(a){var b=this,c=this.createView(a);return c.on(r.EVENTS.VIEWS.RESIZED,function(a){b.counter(a)}),this.views.prepend(c),c.onDisplayed=this.afterDisplayed.bind(this),c.onResize=this.afterResized.bind(this),c.on(r.EVENTS.VIEWS.AXIS,function(a){b.updateAxis(a)}),c.display(this.request)}},{key:"counter",value:function(a){"vertical"===this.settings.axis?this.scrollBy(0,a.heightDelta,!0):this.scrollBy(a.widthDelta,0,!0)}},{key:"next",value:function(){var a,b,c=this.settings.direction;if(this.views.length){if(!this.isPaginated||"horizontal"!==this.settings.axis||c&&"ltr"!==c)if(this.isPaginated&&"horizontal"===this.settings.axis&&"rtl"===c)this.scrollLeft=this.container.scrollLeft,b=this.container.scrollLeft,b>0?this.scrollBy(this.layout.delta,0,!0):a=this.views.last().section.next();else if(this.isPaginated&&"vertical"===this.settings.axis){this.scrollTop=this.container.scrollTop;var d=this.container.scrollTop+this.container.offsetHeight;d<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):a=this.views.last().section.next()}else a=this.views.last().section.next();else this.scrollLeft=this.container.scrollLeft,b=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,b<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):a=this.views.last().section.next();return a?(this.clear(),this.append(a).then(function(){var b;if("pre-paginated"===this.layout.name&&this.layout.divisor>1&&(b=a.next()))return this.append(b)}.bind(this),function(a){displaying.reject(a)}).then(function(){this.views.show()}.bind(this))):void 0}}},{key:"prev",value:function(){var a,b,c=this.settings.direction;if(this.views.length){if(!this.isPaginated||"horizontal"!==this.settings.axis||c&&"ltr"!==c)if(this.isPaginated&&"horizontal"===this.settings.axis&&"rtl"===c)this.scrollLeft=this.container.scrollLeft,b=this.container.scrollLeft+this.container.offsetWidth+this.layout.delta,b<=this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):a=this.views.first().section.prev();else if(this.isPaginated&&"vertical"===this.settings.axis){this.scrollTop=this.container.scrollTop;var d=this.container.scrollTop;d>0?this.scrollBy(0,-this.layout.height,!0):a=this.views.first().section.prev()}else a=this.views.first().section.prev();else this.scrollLeft=this.container.scrollLeft,b=this.container.scrollLeft,b>0?this.scrollBy(-this.layout.delta,0,!0):a=this.views.first().section.prev();return a?(this.clear(),this.prepend(a).then(function(){var b;if("pre-paginated"===this.layout.name&&this.layout.divisor>1&&(b=a.prev()))return this.prepend(b)}.bind(this),function(a){displaying.reject(a)}).then(function(){this.isPaginated&&"horizontal"===this.settings.axis&&("rtl"===this.settings.direction?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))):void 0}}},{key:"current",value:function(){var a=this.visible();return a.length?a[a.length-1]:null}},{key:"clear",value:function(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}},{key:"currentLocation",value:function(){return"vertical"===this.settings.axis?this.location=this.scrolledLocation():this.location=this.paginatedLocation(),this.location}},{key:"scrolledLocation",value:function(){var a=this,b=this.visible(),c=this.container.getBoundingClientRect(),d=c.height<window.innerHeight?c.height:window.innerHeight,e=0,f=0;return this.fullsize&&(e=window.scrollY),b.map(function(b){var g=b.section,h=g.index,i=g.href,j=b.position(),k=b.height(),l=e+c.top-j.top+f,m=l+d-f;m>k&&(m=k,f=m-l);var n=a.layout.count(k,d).pages,o=Math.ceil(l/d),p=[],q=Math.ceil(m/d);p=[];for(var r=o;r<=q;r++){var s=r+1;p.push(s)}return{index:h,href:i,pages:p,totalPages:n,mapping:a.mapping.page(b.contents,b.section.cfiBase,l,m)}})}},{key:"paginatedLocation",value:function(){var a=this,b=this.visible(),c=this.container.getBoundingClientRect(),d=0,e=0;return this.fullsize&&(d=window.scrollX),b.map(function(b){var f=b.section,g=f.index,h=f.href,i=(b.offset().left,b.position().left),j=b.width(),k=d+c.left-i+e,l=k+a.layout.width-e,m=a.mapping.page(b.contents,b.section.cfiBase,k,l),n=a.layout.count(j).pages,o=Math.floor(k/a.layout.pageWidth),p=[],q=Math.floor(l/a.layout.pageWidth);if(o<0&&(o=0,q+=1),"rtl"===a.settings.direction){var r=o;o=n-q,q=n-r}for(var s=o+1;s<=q;s++){var t=s;p.push(t)}return{index:g,href:h,pages:p,totalPages:n,mapping:m}})}},{key:"isVisible",value:function(a,b,c,d){var e=a.position(),f=d||this.bounds();return"horizontal"===this.settings.axis&&e.right>f.left-b&&e.left<f.right+c||"vertical"===this.settings.axis&&e.bottom>f.top-b&&e.top<f.bottom+c}},{key:"visible",value:function(){for(var a,b=this.bounds(),c=this.views.displayed(),d=c.length,e=[],f=0;f<d;f++)a=c[f],!0===this.isVisible(a,0,0,b)&&e.push(a);return e}},{key:"scrollBy",value:function(a,b,c){var d="rtl"===this.settings.direction?-1:1;c&&(this.ignore=!0),this.fullsize?window.scrollBy(a*d,b*d):(a&&(this.container.scrollLeft+=a*d),b&&(this.container.scrollTop+=b)),this.scrolled=!0}},{key:"scrollTo",value:function(a,b,c){c&&(this.ignore=!0),this.fullsize?window.scrollTo(a,b):(this.container.scrollLeft=a,this.container.scrollTop=b),this.scrolled=!0}},{key:"onScroll",value:function(){var a=void 0,b=void 0;this.fullsize?(a=window.scrollY,b=window.scrollX):(a=this.container.scrollTop,b=this.container.scrollLeft),this.scrollTop=a,this.scrollLeft=b,this.ignore?this.ignore=!1:(this.emit(r.EVENTS.MANAGERS.SCROLL,{top:a,left:b}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(r.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:"bounds",value:function(){var a;return a=this.stage.bounds(),a}},{key:"applyLayout",value:function(a){this.layout=a,this.updateLayout()}},{key:"updateLayout",value:function(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:"setLayout",value:function(a){this.viewSettings.layout=a,this.mapping=new k.default(a.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach(function(b){b&&b.setLayout(a)})}},{key:"updateAxis",value:function(a,b){this.isPaginated||(a="vertical"),(b||a!==this.settings.axis)&&(this.settings.axis=a,this.stage&&this.stage.axis(a),this.viewSettings.axis=a,this.mapping&&(this.mapping=new k.default(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&("vertical"===a?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}},{key:"updateFlow",value:function(a){var b="paginated"===a||"auto"===a;this.isPaginated=b,"scrolled-doc"!==a&&"scrolled-continuous"!==a&&"scrolled"!==a||this.updateAxis("vertical"),this.viewSettings.flow=a,this.settings.overflow?this.overflow=this.settings.overflow:this.overflow=b?"hidden":"auto",this.updateLayout()}},{key:"getContents",value:function(){var a=[];return this.views?(this.views.forEach(function(b){var c=b&&b.contents;c&&a.push(c)}),a):a}},{key:"direction",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ltr";this.settings.direction=a,this.stage&&this.stage.direction(a),this.viewSettings.direction=a,this.updateLayout()}},{key:"isRendered",value:function(){return this.rendered}}]),a}();(0,h.default)(s.prototype),b.default=s,a.exports=b.default},function(a,b){function c(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)}a.exports=c},function(b,c){b.exports=a},function(a,b,c){"use strict";function d(a){return a&&f[a.split(".").pop().toLowerCase()]||g}var e={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},f=function(){var a,b,c,d,f={};for(a in e)if(e.hasOwnProperty(a))for(b in e[a])if(e[a].hasOwnProperty(b))if("string"==typeof(c=e[a][b]))f[c]=a+"/"+b;else for(d=0;d<c.length;d++)f[c[d]]=a+"/"+b;return f}(),g="text/plain";a.exports={lookup:d}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(2),i=d(h),j=c(0),k=c(10),l=d(k),m=c(1),n=d(m),o=c(12),p=d(o),q=c(50),r=d(q),s=c(51),t=d(s),u=c(13),v=d(u),w=c(52),x=d(w),y=c(3),z=c(20),A=d(z),B=c(14),C=d(B),D=c(24),E=d(D),F=function(){function a(b,c){e(this,a),this.settings=(0,j.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,j.extend)(this.settings,c),"object"===f(this.settings.manager)&&(this.manager=this.settings.manager),this.book=b,this.hooks={},this.hooks.display=new l.default(this),this.hooks.serialize=new l.default(this),this.hooks.content=new l.default(this),this.hooks.unloaded=new l.default(this),this.hooks.layout=new l.default(this),this.hooks.render=new l.default(this),this.hooks.show=new l.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new t.default(this),this.annotations=new x.default(this),this.epubcfi=new n.default,this.q=new p.default(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new j.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return g(a,[{key:"setManager",value:function(a){this.manager=a}},{key:"requireManager",value:function(a){return"string"==typeof a&&"default"===a?C.default:"string"==typeof a&&"continuous"===a?E.default:a}},{key:"requireView",value:function(a){return"string"==typeof a&&"iframe"===a?A.default:a}},{key:"start",value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(y.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(y.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(y.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(y.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(y.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(y.EVENTS.RENDITION.STARTED),this.starting.resolve()}},{key:"attachTo",value:function(a){return this.q.enqueue(function(){this.manager.render(a,{width:this.settings.width,height:this.settings.height}),this.emit(y.EVENTS.RENDITION.ATTACHED)}.bind(this))}},{key:"display",value:function(a){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,a)}},{key:"_display",value:function(a){var b=this;if(this.book){var c,d=(this.epubcfi.isCfiString(a),new j.defer),e=d.promise;return this.displaying=d,(this.book.locations.length()&&((0,j.isFloat)(a)||"1.0"===a)&&(a=this.book.locations.cfiFromPercentage(parseFloat(a))),c=this.book.spine.get(a))?(this.manager.display(c,a).then(function(){d.resolve(c),b.displaying=void 0,b.emit(y.EVENTS.RENDITION.DISPLAYED,c),b.reportLocation()},function(a){b.emit(y.EVENTS.RENDITION.DISPLAY_ERROR,a)}),e):(d.reject(new Error("No Section Found")),e)}}},{key:"afterDisplayed",value:function(a){var b=this;a.on(y.EVENTS.VIEWS.MARK_CLICKED,function(c,d){return b.triggerMarkEvent(c,d,a)}),this.hooks.render.trigger(a,this).then(function(){a.contents?b.hooks.content.trigger(a.contents,b).then(function(){b.emit(y.EVENTS.RENDITION.RENDERED,a.section,a)}):b.emit(y.EVENTS.RENDITION.RENDERED,a.section,a)})}},{key:"afterRemoved",value:function(a){var b=this;this.hooks.unloaded.trigger(a,this).then(function(){b.emit(y.EVENTS.RENDITION.REMOVED,a.section,a)})}},{key:"onResized",value:function(a){this.emit(y.EVENTS.RENDITION.RESIZED,{width:a.width,height:a.height}),this.location&&this.location.start&&this.display(this.location.start.cfi)}},{key:"onOrientationChange",value:function(a){this.emit(y.EVENTS.RENDITION.ORIENTATION_CHANGE,a)}},{key:"moveTo",value:function(a){this.manager.moveTo(a)}},{key:"resize",value:function(a,b){a&&(this.settings.width=a),b&&(this.settings.height=b),this.manager.resize(a,b)}},{key:"clear",value:function(){this.manager.clear()}},{key:"next",value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"prev",value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"determineLayoutProperties",value:function(a){var b=this.settings.layout||a.layout||"reflowable",c=this.settings.spread||a.spread||"auto",d=this.settings.orientation||a.orientation||"auto",e=this.settings.flow||a.flow||"auto",f=a.viewport||"",g=this.settings.minSpreadWidth||a.minSpreadWidth||800,h=this.settings.direction||a.direction||"ltr";return(0===this.settings.width||this.settings.width>0)&&(0===this.settings.height||this.settings.height),{layout:b,spread:c,orientation:d,flow:e,viewport:f,minSpreadWidth:g,direction:h}}},{key:"flow",value:function(a){var b=a;"scrolled"!==a&&"scrolled-doc"!==a&&"scrolled-continuous"!==a||(b="scrolled"),"auto"!==a&&"paginated"!==a||(b="paginated"),this.settings.flow=a,this._layout&&this._layout.flow(b),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(b),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"layout",value:function(a){var b=this;return a&&(this._layout=new r.default(a),this._layout.spread(a.spread,this.settings.minSpreadWidth),this._layout.on(y.EVENTS.LAYOUT.UPDATED,function(a,c){b.emit(y.EVENTS.RENDITION.LAYOUT,a,c)})),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:"spread",value:function(a,b){this._layout.spread(a,b),this.manager.isRendered()&&this.manager.updateLayout()}},{key:"direction",value:function(a){this.settings.direction=a||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"reportLocation",value:function(){return this.q.enqueue(function(){requestAnimationFrame(function(){var a=this.manager.currentLocation();if(a&&a.then&&"function"==typeof a.then)a.then(function(a){var b=this.located(a);b&&b.start&&b.end&&(this.location=b,this.emit(y.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(y.EVENTS.RENDITION.RELOCATED,this.location))}.bind(this));else if(a){var b=this.located(a);if(!b||!b.start||!b.end)return;this.location=b,this.emit(y.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(y.EVENTS.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}},{key:"currentLocation",value:function(){var a=this.manager.currentLocation();if(a&&a.then&&"function"==typeof a.then)a.then(function(a){return this.located(a)}.bind(this));else if(a){var b=this.located(a);return b}}},{key:"located",value:function(a){if(!a.length)return{};var b=a[0],c=a[a.length-1],d={start:{index:b.index,href:b.href,cfi:b.mapping.start,displayed:{page:b.pages[0]||1,total:b.totalPages}},end:{index:c.index,href:c.href,cfi:c.mapping.end,displayed:{page:c.pages[c.pages.length-1]||1,total:c.totalPages}}},e=this.book.locations.locationFromCfi(b.mapping.start),f=this.book.locations.locationFromCfi(c.mapping.end);null!=e&&(d.start.location=e,d.start.percentage=this.book.locations.percentageFromLocation(e)),null!=f&&(d.end.location=f,d.end.percentage=this.book.locations.percentageFromLocation(f));var g=this.book.pageList.pageFromCfi(b.mapping.start),h=this.book.pageList.pageFromCfi(c.mapping.end);return-1!=g&&(d.start.page=g),-1!=h&&(d.end.page=h),c.index===this.book.spine.last().index&&d.end.displayed.page>=d.end.displayed.total&&(d.atEnd=!0),b.index===this.book.spine.first().index&&1===d.start.displayed.page&&(d.atStart=!0),d}},{key:"destroy",value:function(){this.manager&&this.manager.destroy(),this.book=void 0}},{key:"passEvents",value:function(a){var b=this;v.default.listenedEvents.forEach(function(c){a.on(c,function(c){return b.triggerViewEvent(c,a)})}),a.on(y.EVENTS.CONTENTS.SELECTED,function(c){return b.triggerSelectedEvent(c,a)})}},{key:"triggerViewEvent",value:function(a,b){this.emit(a.type,a,b)}},{key:"triggerSelectedEvent",value:function(a,b){this.emit(y.EVENTS.RENDITION.SELECTED,a,b)}},{key:"triggerMarkEvent",value:function(a,b,c){this.emit(y.EVENTS.RENDITION.MARK_CLICKED,a,b,c)}},{key:"getRange",value:function(a,b){var c=new n.default(a),d=this.manager.visible().filter(function(a){if(c.spinePos===a.index)return!0});if(d.length)return d[0].contents.range(c,b)}},{key:"adjustImages",value:function(a){return"pre-paginated"===this._layout.name?new Promise(function(a){a()}):(a.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","object-fit":"contain","page-break-inside":"avoid"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","page-break-inside":"avoid"}}),new Promise(function(a,b){setTimeout(function(){a()},1)}))}},{key:"getContents",value:function(){return this.manager?this.manager.getContents():[]}},{key:"views",value:function(){return(this.manager?this.manager.views:void 0)||[]}},{key:"handleLinks",value:function(a){var b=this;a&&a.on(y.EVENTS.CONTENTS.LINK_CLICKED,function(a){var c=b.book.path.relative(a);b.display(c)})}},{key:"injectStylesheet",value:function(a,b){var c=a.createElement("link");c.setAttribute("type","text/css"),c.setAttribute("rel","stylesheet"),c.setAttribute("href",this.settings.stylesheet),a.getElementsByTagName("head")[0].appendChild(c)}},{key:"injectScript",value:function(a,b){var c=a.createElement("script");c.setAttribute("type","text/javascript"),c.setAttribute("src",this.settings.script),c.textContent=" ",a.getElementsByTagName("head")[0].appendChild(c)}},{key:"injectIdentifier",value:function(a,b){var c=this.book.package.metadata.identifier,d=a.createElement("meta");d.setAttribute("name","dc.relation.ispartof"),c&&d.setAttribute("content",c),a.getElementsByTagName("head")[0].appendChild(d)}}]),a}();(0,i.default)(F.prototype),b.default=F,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(1),h=d(g),i=function(){function a(b,c,d,f){e(this,a),this.layout=b,this.horizontal="horizontal"===d,this.direction=c||"ltr",this._dev=f}return f(a,[{key:"section",value:function(a){var b=this.findRanges(a);return this.rangeListToCfiList(a.section.cfiBase,b)}},{key:"page",value:function(a,b,c,d){var e,f=!(!a||!a.document)&&a.document.body;if(f){if(e=this.rangePairToCfiPair(b,{start:this.findStart(f,c,d),end:this.findEnd(f,c,d)}),!0===this._dev){var g=a.document,i=new h.default(e.start).toRange(g),j=new h.default(e.end).toRange(g),k=g.defaultView.getSelection(),l=g.createRange();k.removeAllRanges(),l.setStart(i.startContainer,i.startOffset),l.setEnd(j.endContainer,j.endOffset),k.addRange(l)}return e}}},{key:"walk",value:function(a,b){if(!a||a.nodeType!==Node.TEXT_NODE){var c={acceptNode:function(a){return a.data.trim().length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},d=c.acceptNode;d.acceptNode=c.acceptNode;for(var e,f,g=document.createTreeWalker(a,NodeFilter.SHOW_TEXT,d,!1);(e=g.nextNode())&&!(f=b(e)););return f}}},{key:"findRanges",value:function(a){for(var b,c,d=[],e=a.contents.scrollWidth(),f=Math.ceil(e/this.layout.spreadWidth),g=f*this.layout.divisor,h=this.layout.columnWidth,i=this.layout.gap,j=0;j<g.pages;j++)b=(h+i)*j,c=h*(j+1)+i*j,d.push({start:this.findStart(a.document.body,b,c),end:this.findEnd(a.document.body,b,c)});return d}},{key:"findStart",value:function(a,b,c){for(var d,e,f=this,g=[a],h=a;g.length;)if(d=g.shift(),e=this.walk(d,function(a){var d,e,i,j,k;if(k=f.getBounds(a),f.horizontal&&"ltr"===f.direction){if(d=f.horizontal?k.left:k.top,e=f.horizontal?k.right:k.bottom,d>=b&&d<=c)return a;if(e>b)return a;h=a,g.push(a)}else if(f.horizontal&&"rtl"===f.direction){if(d=k.left,(e=k.right)<=c&&e>=b)return a;if(d<c)return a;h=a,g.push(a)}else{if(i=k.top,j=k.bottom,i>=b&&i<=c)return a;if(j>b)return a;h=a,g.push(a)}}))return this.findTextStartRange(e,b,c);return this.findTextStartRange(h,b,c)}},{key:"findEnd",value:function(a,b,c){for(var d,e,f=this,g=[a],h=a;g.length;)if(d=g.shift(),e=this.walk(d,function(a){var d,e,i,j,k;if(k=f.getBounds(a),f.horizontal&&"ltr"===f.direction){if(d=Math.round(k.left),e=Math.round(k.right),d>c&&h)return h;if(e>c)return a;h=a,g.push(a)}else if(f.horizontal&&"rtl"===f.direction){if(d=Math.round(f.horizontal?k.left:k.top),(e=Math.round(f.horizontal?k.right:k.bottom))<b&&h)return h;if(d<b)return a;h=a,g.push(a)}else{if(i=Math.round(k.top),j=Math.round(k.bottom),i>c&&h)return h;if(j>c)return a;h=a,g.push(a)}}))return this.findTextEndRange(e,b,c);return this.findTextEndRange(h,b,c)}},{key:"findTextStartRange",value:function(a,b,c){for(var d,e,f=this.splitTextNodeIntoRanges(a),g=0;g<f.length;g++)if(d=f[g],e=d.getBoundingClientRect(),this.horizontal&&"ltr"===this.direction){if(e.left>=b)return d}else if(this.horizontal&&"rtl"===this.direction){if(e.right<=c)return d}else if(e.top>=b)return d;return f[0]}},{key:"findTextEndRange",value:function(a,b,c){for(var d,e,f,g,h,i,j,k=this.splitTextNodeIntoRanges(a),l=0;l<k.length;l++){if(e=k[l],f=e.getBoundingClientRect(),this.horizontal&&"ltr"===this.direction){if(g=f.left,h=f.right,g>c&&d)return d;if(h>c)return e}else if(this.horizontal&&"rtl"===this.direction){if(g=f.left,(h=f.right)<b&&d)return d;if(g<b)return e}else{if(i=f.top,j=f.bottom,i>c&&d)return d;if(j>c)return e}d=e}return k[k.length-1]}},{key:"splitTextNodeIntoRanges",value:function(a,b){var c,d=[],e=a.textContent||"",f=e.trim(),g=a.ownerDocument,h=b||" ",i=f.indexOf(h);if(-1===i||a.nodeType!=Node.TEXT_NODE)return c=g.createRange(),c.selectNodeContents(a),[c];for(c=g.createRange(),c.setStart(a,0),c.setEnd(a,i),d.push(c),c=!1;-1!=i;)(i=f.indexOf(h,i+1))>0&&(c&&(c.setEnd(a,i),d.push(c)),c=g.createRange(),c.setStart(a,i+1));return c&&(c.setEnd(a,f.length),d.push(c)),d}},{key:"rangePairToCfiPair",value:function(a,b){var c=b.start,d=b.end;return c.collapse(!0),d.collapse(!1),{start:new h.default(c,a).toString(),end:new h.default(d,a).toString()}}},{key:"rangeListToCfiList",value:function(a,b){for(var c,d=[],e=0;e<b.length;e++)c=this.rangePairToCfiPair(a,b[e]),d.push(c);return d}},{key:"getBounds",value:function(a){var b=void 0;if(a.nodeType==Node.TEXT_NODE){var c=document.createRange();c.selectNodeContents(a),b=c.getBoundingClientRect()}else b=a.getBoundingClientRect();return b}},{key:"axis",value:function(a){return a&&(this.horizontal="horizontal"===a),this.horizontal}}]),a}();b.default=i,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(0),j=c(1),k=d(j),l=c(13),m=d(l),n=c(3),o=c(53),p=function(){function a(b,c){e(this,a),this.settings=(0,i.extend)({ignoreClass:"",axis:c.layout&&"scrolled"===c.layout.props.flow?"vertical":"horizontal",direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0},c||{}),this.id="epubjs-view-"+(0,i.uuid)(),this.section=b,this.index=b.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new k.default,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}return f(a,[{key:"container",value:function(a){var b=document.createElement("div");return b.classList.add("epub-view"),b.style.height="0px",b.style.width="0px",b.style.overflow="hidden",b.style.position="relative",b.style.display="block",b.style.flex=a&&"horizontal"==a?"none":"initial",b}},{key:"create",value:function(){return this.iframe?this.iframe:(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,i.bounds)(this.element),"srcdoc"in this.iframe?this.supportsSrcdoc=!0:this.supportsSrcdoc=!1,this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write"),this.iframe)}},{key:"render",value:function(a,b){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(a)),this.sectionRender.then(function(a){return this.load(a)}.bind(this)).then(function(){var a=this;this.layout.format(this.contents);var b=this.contents.writingMode(),c=0===b.indexOf("vertical")?"vertical":"horizontal";return this.setAxis(c),this.emit(n.EVENTS.VIEWS.AXIS,c),this.addListeners(),new Promise(function(b,c){a.expand(),b()})}.bind(this),function(a){return this.emit(n.EVENTS.VIEWS.LOAD_ERROR,a),new Promise(function(b,c){c(a)})}.bind(this)).then(function(){this.emit(n.EVENTS.VIEWS.RENDERED,this.section)}.bind(this))}},{key:"reset",value:function(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}},{key:"size",value:function(a,b){var c=a||this.settings.width,d=b||this.settings.height;"pre-paginated"===this.layout.name?this.lock("both",c,d):"horizontal"===this.settings.axis?this.lock("height",c,d):this.lock("width",c,d),this.settings.width=c,this.settings.height=d}},{key:"lock",value:function(a,b,c){var d,e=(0,i.borders)(this.element);d=this.iframe?(0,i.borders)(this.iframe):{width:0,height:0},"width"==a&&(0,i.isNumber)(b)&&(this.lockedWidth=b-e.width-d.width),"height"==a&&(0,i.isNumber)(c)&&(this.lockedHeight=c-e.height-d.height),"both"===a&&(0,i.isNumber)(b)&&(0,i.isNumber)(c)&&(this.lockedWidth=b-e.width-d.width,this.lockedHeight=c-e.height-d.height),this.displayed&&this.iframe&&this.expand()}},{key:"expand",value:function(a){var b,c=this.lockedWidth,d=this.lockedHeight;this.iframe&&!this._expanding&&(this._expanding=!0,"pre-paginated"===this.layout.name?(c=this.layout.columnWidth,d=this.layout.height):"horizontal"===this.settings.axis?(c=this.contents.textWidth(),c%this.layout.pageWidth>0&&(c=Math.ceil(c/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(b=c/this.layout.delta,this.layout.divisor>1&&"reflowable"===this.layout.name&&b%2>0&&(c+=this.layout.gap+this.layout.columnWidth))):"vertical"===this.settings.axis&&(d=this.contents.textHeight()),(this._needsReframe||c!=this._width||d!=this._height)&&this.reframe(c,d),this._expanding=!1)}},{key:"reframe",value:function(a,b){var c;(0,i.isNumber)(a)&&(this.element.style.width=a+"px",this.iframe.style.width=a+"px",this._width=a),(0,i.isNumber)(b)&&(this.element.style.height=b+"px",this.iframe.style.height=b+"px",this._height=b),c={width:a,height:b,widthDelta:this.prevBounds?a-this.prevBounds.width:a,heightDelta:this.prevBounds?b-this.prevBounds.height:b},this.pane&&this.pane.render(),this.onResize(this,c),this.emit(n.EVENTS.VIEWS.RESIZED,c),this.prevBounds=c,this.elementBounds=(0,i.bounds)(this.element)}},{key:"load",value:function(a){var b=new i.defer,c=b.promise;if(!this.iframe)return b.reject(new Error("No Iframe Available")),c;if(this.iframe.onload=function(a){this.onLoad(a,b)}.bind(this),"blobUrl"===this.settings.method)this.blobUrl=(0,i.createBlobUrl)(a,"application/xhtml+xml"),this.iframe.src=this.blobUrl;else if("srcdoc"===this.settings.method)this.iframe.srcdoc=a;else{if(this.document=this.iframe.contentDocument,!this.document)return b.reject(new Error("No Document Available")),c;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(a),this.iframe.contentDocument.close()}return c}},{key:"onLoad",value:function(a,b){var c=this;this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new m.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var d=this.document.querySelector("link[rel='canonical']");d?d.setAttribute("href",this.section.canonical):(d=this.document.createElement("link"),d.setAttribute("rel","canonical"),d.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(d)),this.contents.on(n.EVENTS.CONTENTS.EXPAND,function(){c.displayed&&c.iframe&&(c.expand(),c.contents&&c.layout.format(c.contents))}),this.contents.on(n.EVENTS.CONTENTS.RESIZE,function(a){c.displayed&&c.iframe&&(c.expand(),c.contents&&c.layout.format(c.contents))}),b.resolve(this.contents)}},{key:"setLayout",value:function(a){this.layout=a,this.contents&&(this.layout.format(this.contents),this.expand())}},{key:"setAxis",value:function(a){"scrolled"===this.layout.props.flow&&(a="vertical"),this.settings.axis=a,this.element.style.flex="horizontal"==a?"none":"initial",this.size()}},{key:"addListeners",value:function(){}},{key:"removeListeners",value:function(a){}},{key:"display",value:function(a){var b=new i.defer;return this.displayed?b.resolve(this):this.render(a).then(function(){this.emit(n.EVENTS.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,b.resolve(this)}.bind(this),function(a){b.reject(a,this)}),b.promise}},{key:"show",value:function(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible"),this.emit(n.EVENTS.VIEWS.SHOWN,this)}},{key:"hide",value:function(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(n.EVENTS.VIEWS.HIDDEN,this)}},{key:"offset",value:function(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"position",value:function(){return this.element.getBoundingClientRect()}},{key:"locationOf",value:function(a){var b=(this.iframe.getBoundingClientRect(),this.contents.locationOf(a,this.settings.ignoreClass));return{left:b.left,top:b.top}}},{key:"onDisplayed",value:function(a){}},{key:"onResize",value:function(a,b){}},{key:"bounds",value:function(a){return!a&&this.elementBounds||(this.elementBounds=(0,i.bounds)(this.element)),this.elementBounds}},{key:"highlight",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2];if(this.contents){var e=this.contents.range(a),f=function(){b.emit(n.EVENTS.VIEWS.MARK_CLICKED,a,c)};c.epubcfi=a,this.pane||(this.pane=new o.Pane(this.iframe,this.element));var g=new o.Highlight(e,"epubjs-hl",c,{fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"}),h=this.pane.addMark(g);return this.highlights[a]={mark:h,element:h.element,listeners:[f,d]},h.element.setAttribute("ref","epubjs-hl"),h.element.addEventListener("click",f),h.element.addEventListener("touchstart",f),d&&(h.element.addEventListener("click",d),h.element.addEventListener("touchstart",d)),h}}},{key:"underline",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2];if(this.contents){var e=this.contents.range(a),f=function(){b.emit(n.EVENTS.VIEWS.MARK_CLICKED,a,c)};c.epubcfi=a,this.pane||(this.pane=new o.Pane(this.iframe,this.element));var g=new o.Underline(e,"epubjs-ul",c,{stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"}),h=this.pane.addMark(g);return this.underlines[a]={mark:h,element:h.element,listeners:[f,d]},h.element.setAttribute("ref","epubjs-ul"),h.element.addEventListener("click",f),h.element.addEventListener("touchstart",f),d&&(h.element.addEventListener("click",d),h.element.addEventListener("touchstart",d)),h}}},{key:"mark",value:function(a){var b=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},d=arguments[2];if(this.contents){if(a in this.marks){return this.marks[a]}var e=this.contents.range(a);if(e){var f=e.commonAncestorContainer,g=1===f.nodeType?f:f.parentNode,h=function(d){b.emit(n.EVENTS.VIEWS.MARK_CLICKED,a,c)};e.collapsed&&1===f.nodeType?(e=new Range,e.selectNodeContents(f)):e.collapsed&&(e=new Range,e.selectNodeContents(g));var i=void 0,j=void 0,k=void 0;if("pre-paginated"===this.layout.name||"horizontal"!==this.settings.axis){var l=e.getBoundingClientRect();i=l.top,j=l.right}else for(var m=e.getClientRects(),o=void 0,p=0;p!=m.length;p++)o=m[p],(!k||o.left<k)&&(k=o.left,j=k+this.layout.columnWidth-this.layout.gap,i=o.top);var q=this.document.createElement("a");return q.setAttribute("ref","epubjs-mk"),q.style.position="absolute",q.style.top=i+"px",q.style.left=j+"px",q.dataset.epubcfi=a,c&&Object.keys(c).forEach(function(a){q.dataset[a]=c[a]}),d&&(q.addEventListener("click",d),q.addEventListener("touchstart",d)),q.addEventListener("click",h),q.addEventListener("touchstart",h),this.element.appendChild(q),this.marks[a]={element:q,listeners:[h,d]},g}}}},{key:"unhighlight",value:function(a){var b=void 0;a in this.highlights&&(b=this.highlights[a],this.pane.removeMark(b.mark),b.listeners.forEach(function(a){a&&b.element.removeEventListener("click",a)}),delete this.highlights[a])}},{key:"ununderline",value:function(a){var b=void 0;a in this.underlines&&(b=this.underlines[a],this.pane.removeMark(b.mark),b.listeners.forEach(function(a){a&&b.element.removeEventListener("click",a)}),delete this.underlines[a])}},{key:"unmark",value:function(a){var b=void 0;a in this.marks&&(b=this.marks[a],this.element.removeChild(b.element),b.listeners.forEach(function(a){a&&b.element.removeEventListener("click",a)}),delete this.marks[a])}},{key:"destroy",value:function(){for(var a in this.highlights)this.unhighlight(a);for(var b in this.underlines)this.ununderline(b);for(var c in this.marks)this.unmark(c);this.blobUrl&&(0,i.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),a}();(0,h.default)(p.prototype),b.default=p,a.exports=b.default},function(a,b,c){function d(a,b,c){function d(b){var c=s,d=t;return s=t=void 0,y=b,v=a.apply(d,c)}function k(a){return y=a,w=setTimeout(n,b),z?d(a):v}function l(a){var c=a-x,d=a-y,e=b-c;return A?j(e,u-d):e}function m(a){var c=a-x,d=a-y;return void 0===x||c>=b||c<0||A&&d>=u}function n(){var a=f();if(m(a))return o(a);w=setTimeout(n,l(a))}function o(a){return w=void 0,B&&s?d(a):(s=t=void 0,v)}function p(){void 0!==w&&clearTimeout(w),y=0,s=x=t=w=void 0}function q(){return void 0===w?v:o(f())}function r(){var a=f(),c=m(a);if(s=arguments,t=this,x=a,c){if(void 0===w)return k(x);if(A)return w=setTimeout(n,b),d(x)}return void 0===w&&(w=setTimeout(n,b)),v}var s,t,u,v,w,x,y=0,z=!1,A=!1,B=!0;if("function"!=typeof a)throw new TypeError(h);return b=g(b)||0,e(c)&&(z=!!c.leading,A="maxWait"in c,u=A?i(g(c.maxWait)||0,b):u,B="trailing"in c?!!c.trailing:B),r.cancel=p,r.flush=q,r}var e=c(15),f=c(58),g=c(60),h="Expected a function",i=Math.max,j=Math.min;a.exports=d},function(a,b,c){var d=c(59),e="object"==typeof self&&self&&self.Object===Object&&self,f=d||e||Function("return this")();a.exports=f},function(a,b,c){var d=c(22),e=d.Symbol;a.exports=e},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(0),j=c(14),k=d(j),l=c(3),m=c(21),n=d(m),o=function(a){function b(a){e(this,b);var c=f(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name="continuous",c.settings=(0,i.extend)(c.settings||{},{infinite:!0,overflow:void 0,axis:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,i.extend)(c.settings,a.settings||{}),"undefined"!=a.settings.gap&&0===a.settings.gap&&(c.settings.gap=a.settings.gap),c.viewSettings={ignoreClass:c.settings.ignoreClass,axis:c.settings.axis,flow:c.settings.flow,layout:c.layout,width:0,height:0,forceEvenPages:!1},c.scrollTop=0,c.scrollLeft=0,c}return g(b,a),h(b,[{key:"display",value:function(a,b){return k.default.prototype.display.call(this,a,b).then(function(){return this.fill()}.bind(this))}},{key:"fill",value:function(a){var b=this,c=a||new i.defer;return this.q.enqueue(function(){return b.check()}).then(function(a){a?b.fill(c):c.resolve()}),c.promise}},{key:"moveTo",value:function(a){var b=0,c=0;this.isPaginated?(b=Math.floor(a.left/this.layout.delta)*this.layout.delta,this.settings.offset):(c=a.top,a.top,this.settings.offset),(b>0||c>0)&&this.scrollBy(b,c,!0)}},{key:"afterResized",value:function(a){this.emit(l.EVENTS.MANAGERS.RESIZE,a.section)}},{key:"removeShownListeners",value:function(a){a.onDisplayed=function(){}}},{key:"add",value:function(a){var b=this,c=this.createView(a);return this.views.append(c),c.on(l.EVENTS.VIEWS.RESIZED,function(a){c.expanded=!0}),c.on(l.EVENTS.VIEWS.AXIS,function(a){b.updateAxis(a)}),c.onDisplayed=this.afterDisplayed.bind(this),c.onResize=this.afterResized.bind(this),c.display(this.request)}},{key:"append",value:function(a){var b=this.createView(a);return b.on(l.EVENTS.VIEWS.RESIZED,function(a){b.expanded=!0}),this.views.append(b),b.onDisplayed=this.afterDisplayed.bind(this),b}},{key:"prepend",value:function(a){var b=this,c=this.createView(a);return c.on(l.EVENTS.VIEWS.RESIZED,function(a){b.counter(a),c.expanded=!0}),this.views.prepend(c),c.onDisplayed=this.afterDisplayed.bind(this),c}},{key:"counter",value:function(a){"vertical"===this.settings.axis?this.scrollBy(0,a.heightDelta,!0):this.scrollBy(a.widthDelta,0,!0)}},{key:"update",value:function(a){for(var b,c=this.bounds(),d=this.views.all(),e=d.length,f=[],g=void 0!==a?a:this.settings.offset||0,h=new i.defer,j=[],k=0;k<e;k++)if(b=d[k],!0===this.isVisible(b,g,g,c)){if(b.displayed)b.show();else{var l=b.display(this.request).then(function(a){a.show()},function(a){b.hide()});j.push(l)}f.push(b)}else this.q.enqueue(b.destroy.bind(b)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return j.length?Promise.all(j).catch(function(a){h.reject(a)}):(h.resolve(),h.promise)}},{key:"check",value:function(a,b){var c=this,d=new i.defer,e=[],f="horizontal"===this.settings.axis,g=this.settings.offset||0;a&&f&&(g=a),b&&!f&&(g=b);var h=this._bounds,j="rtl"===this.settings.direction,k=f&&j?-1:1,l=f?this.scrollLeft:this.scrollTop*k,m=f?h.width:h.height,n=f?this.container.scrollWidth:this.container.scrollHeight,o=function(){var a=c.views.first(),b=a&&a.section.prev();b&&e.push(c.prepend(b))},p=function(){var a=c.views.last(),b=a&&a.section.next();b&&e.push(c.append(b))};l+m+g>=n&&(f&&j?o():p()),l-g<0&&(f&&j?p():o());var q=e.map(function(a){return a.displayed});return e.length?Promise.all(q).then(function(){if("pre-paginated"===c.layout.name&&c.layout.props.spread)return c.check()}).then(function(){return c.update(g)},function(a){return a}):(this.q.enqueue(function(){this.update()}.bind(this)),d.resolve(!1),d.promise)}},{key:"trim",value:function(){for(var a=new i.defer,b=this.views.displayed(),c=b[0],d=b[b.length-1],e=this.views.indexOf(c),f=this.views.indexOf(d),g=this.views.slice(0,e),h=this.views.slice(f+1),j=0;j<g.length-1;j++)this.erase(g[j],g);for(var k=1;k<h.length;k++)this.erase(h[k]);return a.resolve(),a.promise}},{key:"erase",value:function(a,b){var c,d;this.settings.height?(c=this.container.scrollTop,d=this.container.scrollLeft):(c=window.scrollY,d=window.scrollX);var e=a.bounds();this.views.remove(a),b&&("vertical"===this.settings.axis?this.scrollTo(0,c-e.height,!0):this.scrollTo(d-e.width,0,!0))}},{key:"addEventListeners",value:function(a){window.addEventListener("unload",function(a){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:"addScrollListeners",value:function(){var a;this.tick=i.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(a=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(a=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),a.addEventListener("scroll",this.onScroll.bind(this)),this._scrolled=(0,n.default)(this.scrolled.bind(this),30),this.didScroll=!1}},{key:"removeEventListeners",value:function(){var a;a=this.settings.height?this.container:window,a.removeEventListener("scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function(){var a=void 0,b=void 0,c="rtl"===this.settings.direction?-1:1;this.settings.height?(a=this.container.scrollTop,b=this.container.scrollLeft):(a=window.scrollY*c,b=window.scrollX*c),this.scrollTop=a,this.scrollLeft=b,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=Math.abs(a-this.prevScrollTop),this.scrollDeltaHorz+=Math.abs(b-this.prevScrollLeft),this.prevScrollTop=a,this.prevScrollLeft=b,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.didScroll=!1}},{key:"scrolled",value:function(){this.q.enqueue(function(){this.check()}.bind(this)),this.emit(l.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(l.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this))}},{key:"next",value:function(){var a=(this.settings.direction,"pre-paginated"===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta);this.views.length&&(this.isPaginated&&"horizontal"===this.settings.axis?this.scrollBy(a,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"prev",value:function(){var a=(this.settings.direction,"pre-paginated"===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta);this.views.length&&(this.isPaginated&&"horizontal"===this.settings.axis?this.scrollBy(-a,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"updateAxis",value:function(a,b){this.isPaginated||(a="vertical"),(b||a!==this.settings.axis)&&(this.settings.axis=a,this.stage&&this.stage.axis(a),this.viewSettings.axis=a,this.mapping&&this.mapping.axis(a),this.layout&&("vertical"===a?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)),this.settings.infinite="vertical"===a)}}]),b}(k.default);b.default=o,a.exports=b.default},function(a,b,c){"use strict";(function(d){function e(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function f(a){return a&&a.__esModule?a:{default:a}}function g(a,b){return new i.default(a,b)}Object.defineProperty(b,"__esModule",{value:!0});var h=c(26),i=f(h),j=c(18),k=f(j),l=c(1),m=f(l),n=c(13),o=f(n),p=c(0),q=e(p);c(69);var r=c(20),s=(f(r),c(14)),t=(f(s),c(24));f(t);g.VERSION="0.3",void 0!==d&&(d.EPUBJS_VERSION=g.VERSION),g.Book=i.default,g.Rendition=k.default,g.Contents=o.default,g.CFI=m.default,g.utils=q,b.default=g,a.exports=b.default}).call(b,c(8))},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(0),j=c(5),k=d(j),l=c(4),m=d(l),n=c(42),o=d(n),p=c(44),q=d(p),r=c(45),s=d(r),t=c(46),u=d(t),v=c(47),w=d(v),x=c(48),y=d(x),z=c(49),A=d(z),B=c(18),C=d(B),D=c(67),E=d(D),F=c(11),G=d(F),H=c(1),I=d(H),J=c(3),K="META-INF/container.xml",L="0.3",M={BINARY:"binary",BASE64:"base64",EPUB:"epub",OPF:"opf",MANIFEST:"json",DIRECTORY:"directory"},N=function(){function a(b,c){var d=this;e(this,a),void 0===c&&"string"!=typeof b&&b instanceof Blob==!1&&(c=b,b=void 0),this.settings=(0,i.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0}),(0,i.extend)(this.settings,c),this.opening=new i.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new i.defer,spine:new i.defer,metadata:new i.defer,cover:new i.defer,navigation:new i.defer,pageList:new i.defer,resources:new i.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||G.default,this.spine=new o.default,this.locations=new q.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,b&&this.open(b,this.settings.openAs).catch(function(a){var c=new Error("Cannot load book at "+b);d.emit(J.EVENTS.BOOK.OPEN_FAILED,c)})}return f(a,[{key:"open",value:function(a,b){var c,d=b||this.determineType(a);return d===M.BINARY?(this.archived=!0,this.url=new k.default("/",""),c=this.openEpub(a)):d===M.BASE64?(this.archived=!0,this.url=new k.default("/",""),c=this.openEpub(a,d)):d===M.EPUB?(this.archived=!0,this.url=new k.default("/",""),c=this.request(a,"binary").then(this.openEpub.bind(this))):d==M.OPF?(this.url=new k.default(a),c=this.openPackaging(this.url.Path.toString())):d==M.MANIFEST?(this.url=new k.default(a),c=this.openManifest(this.url.Path.toString())):(this.url=new k.default(a),c=this.openContainer(K).then(this.openPackaging.bind(this))),c}},{key:"openEpub",value:function(a,b){var c=this;return this.unarchive(a,b||this.settings.encoding).then(function(){return c.openContainer(K)}).then(function(a){return c.openPackaging(a)})}},{key:"openContainer",value:function(a){var b=this;return this.load(a).then(function(a){return b.container=new s.default(a),b.resolve(b.container.packagePath)})}},{key:"openPackaging",value:function(a){var b=this;return this.path=new m.default(a),this.load(a).then(function(a){return b.packaging=new u.default(a),b.unpack(b.packaging)})}},{key:"openManifest",value:function(a){var b=this;return this.path=new m.default(a),this.load(a).then(function(a){return b.packaging=new u.default,b.packaging.load(a),b.unpack(b.packaging)})}},{key:"load",value:function(a){var b;return this.archived?(b=this.resolve(a),this.archive.request(b)):(b=this.resolve(a),this.request(b,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:"resolve",value:function(a,b){if(a){var c=a;return a.indexOf("://")>-1?a:(this.path&&(c=this.path.resolve(a)),0!=b&&this.url&&(c=this.url.resolve(c)),c)}}},{key:"canonical",value:function(a){return a?this.settings.canonical?this.settings.canonical(a):this.resolve(a,!0):""}},{key:"determineType",value:function(a){var b,c,d;return"base64"===this.settings.encoding?M.BASE64:"string"!=typeof a?M.BINARY:(b=new k.default(a),c=b.path(),d=c.extension,d?"epub"===d?M.EPUB:"opf"===d?M.OPF:"json"===d?M.MANIFEST:void 0:M.DIRECTORY)}},{key:"unpack",value:function(a){var b=this;this.package=a,this.spine.unpack(this.package,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new y.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.package).then(function(){b.loading.navigation.resolve(b.navigation)}),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&"none"!=this.settings.replacements?this.replacements().then(function(){b.opening.resolve(b)}).catch(function(a){console.error(a)}):this.opening.resolve(this)}},{key:"loadNavigation",value:function(a){var b=this,c=a.navPath||a.ncxPath,d=a.toc;return d?new Promise(function(c,e){b.navigation=new w.default(d),a.pageList&&(b.pageList=new A.default(a.pageList)),c(b.navigation)}):c?this.load(c,"xml").then(function(a){return b.navigation=new w.default(a),b.pageList=new A.default(a),b.navigation}):new Promise(function(a,c){b.navigation=new w.default,b.pageList=new A.default,a(b.navigation)})}},{key:"section",value:function(a){return this.spine.get(a)}},{key:"renderTo",value:function(a,b){return this.rendition=new C.default(this,b),this.rendition.attachTo(a),this.rendition}},{key:"setRequestCredentials",value:function(a){this.settings.requestCredentials=a}},{key:"setRequestHeaders",value:function(a){this.settings.requestHeaders=a}},{key:"unarchive",value:function(a,b){return this.archive=new E.default,this.archive.open(a,b)}},{key:"coverUrl",value:function(){var a=this;return this.loaded.cover.then(function(b){return a.archived?a.resources.get(a.cover):a.cover})}},{key:"replacements",value:function(){var a=this;return this.spine.hooks.serialize.register(function(b,c){c.output=a.resources.substitute(b,c.url)}),this.resources.replacements().then(function(){return a.resources.replaceCss()})}},{key:"getRange",value:function(a){var b=new I.default(a),c=this.spine.get(b.spinePos),d=this.load.bind(this);return c?c.load(d).then(function(a){return b.toRange(c.document)}):new Promise(function(a,b){b("CFI could not be found")})}},{key:"key",value:function(a){var b=a||this.package.metadata.identifier||this.url.filename;return"epubjs:"+L+":"+b}},{key:"destroy",value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}]),a}();(0,h.default)(N.prototype),b.default=N,a.exports=b.default},function(a,b,c){"use strict";var d,e=c(28),f=c(36),g=c(37),h=c(38);d=a.exports=function(a,b){var c,d,g,i,j;return arguments.length<2||"string"!=typeof a?(i=b,b=a,a=null):i=arguments[2],null==a?(c=g=!0,d=!1):(c=h.call(a,"c"),d=h.call(a,"e"),g=h.call(a,"w")),j={value:b,configurable:c,enumerable:d,writable:g},i?e(f(i),j):j},d.gs=function(a,b,c){var d,i,j,k;return"string"!=typeof a?(j=c,c=b,b=a,a=null):j=arguments[3],null==b?b=void 0:g(b)?null==c?c=void 0:g(c)||(j=c,c=void 0):(j=b,b=c=void 0),null==a?(d=!0,i=!1):(d=h.call(a,"c"),i=h.call(a,"e")),k={get:b,set:c,configurable:d,enumerable:i},j?e(f(j),k):k}},function(a,b,c){"use strict";a.exports=c(29)()?Object.assign:c(30)},function(a,b,c){"use strict";a.exports=function(){var a,b=Object.assign;return"function"==typeof b&&(a={foo:"raz"},b(a,{bar:"dwa"},{trzy:"trzy"}),a.foo+a.bar+a.trzy==="razdwatrzy")}},function(a,b,c){"use strict";var d=c(31),e=c(35),f=Math.max;a.exports=function(a,b){var c,g,h,i=f(arguments.length,2);for(a=Object(e(a)),h=function(d){try{a[d]=b[d]}catch(a){c||(c=a)}},g=1;g<i;++g)b=arguments[g],d(b).forEach(h);if(void 0!==c)throw c;return a}},function(a,b,c){"use strict";a.exports=c(32)()?Object.keys:c(33)},function(a,b,c){"use strict";a.exports=function(){try{return Object.keys("primitive"),!0}catch(a){return!1}}},function(a,b,c){"use strict";var d=c(9),e=Object.keys;a.exports=function(a){return e(d(a)?Object(a):a)}},function(a,b,c){"use strict";a.exports=function(){}},function(a,b,c){"use strict";var d=c(9);a.exports=function(a){if(!d(a))throw new TypeError("Cannot use null or undefined");return a}},function(a,b,c){"use strict";var d=c(9),e=Array.prototype.forEach,f=Object.create,g=function(a,b){var c;for(c in a)b[c]=a[c]};a.exports=function(a){var b=f(null);return e.call(arguments,function(a){d(a)&&g(Object(a),b)}),b}},function(a,b,c){"use strict";a.exports=function(a){return"function"==typeof a}},function(a,b,c){"use strict";a.exports=c(39)()?String.prototype.contains:c(40)},function(a,b,c){"use strict";var d="razdwatrzy";a.exports=function(){return"function"==typeof d.contains&&(!0===d.contains("dwa")&&!1===d.contains("foo"))}},function(a,b,c){"use strict";var d=String.prototype.indexOf;a.exports=function(a){return d.call(this,a,arguments[1])>-1}},function(a,b,c){"use strict";a.exports=function(a){if("function"!=typeof a)throw new TypeError(a+" is not a function");return a}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(1),h=d(g),i=c(10),j=d(i),k=c(43),l=d(k),m=c(7),n=function(){function a(){e(this,a),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new j.default,this.hooks.content=new j.default,this.hooks.content.register(m.replaceBase),this.hooks.content.register(m.replaceCanonical),this.hooks.content.register(m.replaceMeta),this.epubcfi=new h.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return f(a,[{key:"unpack",value:function(a,b,c){var d=this;this.items=a.spine,this.manifest=a.manifest,this.spineNodeIndex=a.spineNodeIndex,this.baseUrl=a.baseUrl||a.basePath||"",this.length=this.items.length,this.items.forEach(function(a,e){var f,g=d.manifest[a.idref];a.index=e,a.cfiBase=d.epubcfi.generateChapterComponent(d.spineNodeIndex,a.index,a.idref),a.href&&(a.url=b(a.href,!0),a.canonical=c(a.href)),g&&(a.href=g.href,a.url=b(a.href,!0),a.canonical=c(a.href),g.properties.length&&a.properties.push.apply(a.properties,g.properties)),"yes"===a.linear?(a.prev=function(){for(var b=a.index;b>0;){var c=this.get(b-1);if(c&&c.linear)return c;b-=1}}.bind(d),a.next=function(){for(var b=a.index;b<this.spineItems.length-1;){var c=this.get(b+1);if(c&&c.linear)return c;b+=1}}.bind(d)):(a.prev=function(){},a.next=function(){}),f=new l.default(a,d.hooks),d.append(f)}),this.loaded=!0}},{key:"get",value:function(a){var b=0;if(void 0===a)for(;b<this.spineItems.length;){var c=this.spineItems[b];if(c&&c.linear)break;b+=1}else if(this.epubcfi.isCfiString(a)){var d=new h.default(a);b=d.spinePos}else"number"==typeof a||!1===isNaN(a)?b=a:"string"==typeof a&&0===a.indexOf("#")?b=this.spineById[a.substring(1)]:"string"==typeof a&&(a=a.split("#")[0],b=this.spineByHref[a]||this.spineByHref[encodeURI(a)]);return this.spineItems[b]||null}},{key:"append",value:function(a){var b=this.spineItems.length;return a.index=b,this.spineItems.push(a),this.spineByHref[decodeURI(a.href)]=b,this.spineByHref[encodeURI(a.href)]=b,this.spineByHref[a.href]=b,this.spineById[a.idref]=b,b}},{key:"prepend",value:function(a){return this.spineByHref[a.href]=0,this.spineById[a.idref]=0,this.spineItems.forEach(function(a,b){a.index=b}),0}},{key:"remove",value:function(a){var b=this.spineItems.indexOf(a);if(b>-1)return delete this.spineByHref[a.href],delete this.spineById[a.idref],this.spineItems.splice(b,1)}},{key:"each",value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:"first",value:function(){var a=0;do{var b=this.get(a);if(b&&b.linear)return b;a+=1}while(a<this.spineItems.length)}},{key:"last",value:function(){var a=this.spineItems.length-1;do{var b=this.get(a);if(b&&b.linear)return b;a-=1}while(a>=0)}},{key:"destroy",value:function(){this.each(function(a){return a.destroy()}),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),a}();b.default=n,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(1),i=d(h),j=c(10),k=d(j),l=c(7),m=function(){function a(b,c){e(this,a),this.idref=b.idref,this.linear="yes"===b.linear,this.properties=b.properties,this.index=b.index,this.href=b.href,this.url=b.url,this.canonical=b.canonical,this.next=b.next,this.prev=b.prev,this.cfiBase=b.cfiBase,c?this.hooks=c:(this.hooks={},this.hooks.serialize=new k.default(this),this.hooks.content=new k.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return f(a,[{key:"load",value:function(a){var b=a||this.request||c(11),d=new g.defer,e=d.promise;return this.contents?d.resolve(this.contents):b(this.url).then(function(a){return this.document=a,this.contents=a.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){d.resolve(this.contents)}.bind(this)).catch(function(a){d.reject(a)}),e}},{key:"base",value:function(){return(0,l.replaceBase)(this.document,this)}},{key:"render",value:function(a){var b=new g.defer,d=b.promise;return this.output,this.load(a).then(function(a){var b,d="undefined"!=typeof navigator&&navigator.userAgent||"",e=d.indexOf("Trident")>=0;b="undefined"==typeof XMLSerializer||e?c(16).XMLSerializer:XMLSerializer;var f=new b;return this.output=f.serializeToString(a),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){b.resolve(this.output)}.bind(this)).catch(function(a){b.reject(a)}),d}},{key:"find",value:function(a){var b=this,c=[],d=a.toLowerCase(),e=function(a){for(var e,f,g,h=a.textContent.toLowerCase(),i=b.document.createRange(),j=-1,k=150;-1!=f;)f=h.indexOf(d,j+1),-1!=f&&(i=b.document.createRange(),i.setStart(a,f),i.setEnd(a,f+d.length),e=b.cfiFromRange(i),a.textContent.length<k?g=a.textContent:(g=a.textContent.substring(f-k/2,f+k/2),g="..."+g+"..."),c.push({cfi:e,excerpt:g})),j=f};return(0,g.sprint)(b.document,function(a){e(a)}),c}},{key:"reconcileLayoutSettings",value:function(a){var b={layout:a.layout,spread:a.spread,orientation:a.orientation};return this.properties.forEach(function(a){var c,d,e=a.replace("rendition:",""),f=e.indexOf("-");-1!=f&&(c=e.slice(0,f),d=e.slice(f+1),b[c]=d)}),b}},{key:"cfiFromRange",value:function(a){return new i.default(a,this.cfiBase).toString()}},{key:"cfiFromElement",value:function(a){return new i.default(a,this.cfiBase).toString()}},{key:"unload",value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:"destroy",value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),a}();b.default=m,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(12),i=d(h),j=c(1),k=d(j),l=c(3),m=c(2),n=d(m),o=function(){function a(b,c,d){e(this,a),this.spine=b,this.request=c,this.pause=d||100,this.q=new i.default(this),this.epubcfi=new k.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}return f(a,[{key:"generate",value:function(a){return a&&(this.break=a),this.q.pause(),this.spine.each(function(a){a.linear&&this.q.enqueue(this.process.bind(this),a)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:"createRange",value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:"process",value:function(a){return a.load(this.request).then(function(b){var c=new g.defer,d=this.parse(b,a.cfiBase);return this._locations=this._locations.concat(d),a.unload(),this.processingTimeout=setTimeout(function(){return c.resolve(d)},this.pause),c.promise}.bind(this))}},{key:"parse",value:function(a,b,c){var d,e,f=[],h=a.ownerDocument,i=(0,g.qs)(h,"body"),j=0,l=c||this.break,m=function(a){var c,g=a.length,h=0;if(0===a.textContent.trim().length)return!1;for(0==j&&(d=this.createRange(),d.startContainer=a,d.startOffset=0),c=l-j,c>g&&(j+=g,h=g);h<g;)if(c=l-j,0===j&&(h+=1,d=this.createRange(),d.startContainer=a,d.startOffset=h),h+c>=g)j+=g-h,h=g;else{h+=c,d.endContainer=a,d.endOffset=h;var i=new k.default(d,b).toString();f.push(i),j=0}e=a};if((0,g.sprint)(i,m.bind(this)),d&&d.startContainer&&e){d.endContainer=e,d.endOffset=e.length;var n=new k.default(d,b).toString();f.push(n),j=0}return f}},{key:"locationFromCfi",value:function(a){var b=void 0;return k.default.prototype.isCfiString(a)&&(a=new k.default(a)),0===this._locations.length?-1:(b=(0,g.locationOf)(a,this._locations,this.epubcfi.compare),b>this.total?this.total:b)}},{key:"percentageFromCfi",value:function(a){if(0===this._locations.length)return null;var b=this.locationFromCfi(a);return this.percentageFromLocation(b)}},{key:"percentageFromLocation",value:function(a){return a&&this.total?a/this.total:0}},{key:"cfiFromLocation",value:function(a){var b=-1;return"number"!=typeof a&&(a=parseInt(a)),a>=0&&a<this._locations.length&&(b=this._locations[a]),b}},{key:"cfiFromPercentage",value:function(a){var b=void 0;if(a>1&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),a>=1){var c=new k.default(this._locations[this.total]);return c.collapse(),c.toString()}return b=Math.ceil(this.total*a),this.cfiFromLocation(b)}},{key:"load",value:function(a){return this._locations="string"==typeof a?JSON.parse(a):a,this.total=this._locations.length-1,this._locations}},{key:"save",value:function(){return JSON.stringify(this._locations)}},{key:"getCurrent",value:function(){return this._current}},{key:"setCurrent",value:function(a){var b;if("string"==typeof a)this._currentCfi=a;else{if("number"!=typeof a)return;this._current=a}0!==this._locations.length&&("string"==typeof a?(b=this.locationFromCfi(a),this._current=b):b=a,this.emit(l.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(b)}))}},{key:"length",value:function(){return this._locations.length}},{key:"destroy",value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:"currentLocation",get:function(){return this._current},set:function(a){this.setCurrent(a)}}]),a}();(0,n.default)(o.prototype),b.default=o,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=d(g),i=c(0),j=function(){function a(b){e(this,a),this.packagePath="",this.directory="",this.encoding="",b&&this.parse(b)}return f(a,[{key:"parse",value:function(a){var b;if(!a)throw new Error("Container File Not Found");if(!(b=(0,i.qs)(a,"rootfile")))throw new Error("No RootFile Found");this.packagePath=b.getAttribute("full-path"),this.directory=h.default.dirname(this.packagePath),this.encoding=a.xmlEncoding}},{key:"destroy",value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),a}();b.default=j,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=function(){function a(b){d(this,a),this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},b&&this.parse(b)}return e(a,[{key:"parse",value:function(a){var b,c,d;if(!a)throw new Error("Package File Not Found");if(!(b=(0,f.qs)(a,"metadata")))throw new Error("No Metadata Found");if(!(c=(0,f.qs)(a,"manifest")))throw new Error("No Manifest Found");if(!(d=(0,f.qs)(a,"spine")))throw new Error("No Spine Found");return this.manifest=this.parseManifest(c),this.navPath=this.findNavPath(c),this.ncxPath=this.findNcxPath(c,d),this.coverPath=this.findCoverPath(a),this.spineNodeIndex=(0,f.indexOfElementNode)(d),this.spine=this.parseSpine(d,this.manifest),this.metadata=this.parseMetadata(b),this.metadata.direction=d.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:"parseMetadata",value:function(a){var b={};return b.title=this.getElementText(a,"title"),b.creator=this.getElementText(a,"creator"),b.description=this.getElementText(a,"description"),b.pubdate=this.getElementText(a,"date"),b.publisher=this.getElementText(a,"publisher"),b.identifier=this.getElementText(a,"identifier"),b.language=this.getElementText(a,"language"),b.rights=this.getElementText(a,"rights"),b.modified_date=this.getPropertyText(a,"dcterms:modified"),b.layout=this.getPropertyText(a,"rendition:layout"),b.orientation=this.getPropertyText(a,"rendition:orientation"),b.flow=this.getPropertyText(a,"rendition:flow"),b.viewport=this.getPropertyText(a,"rendition:viewport"),b}},{key:"parseManifest",value:function(a){var b={},c=(0,f.qsa)(a,"item");return Array.prototype.slice.call(c).forEach(function(a){var c=a.getAttribute("id"),d=a.getAttribute("href")||"",e=a.getAttribute("media-type")||"",f=a.getAttribute("properties")||"";b[c]={href:d,type:e,properties:f.length?f.split(" "):[]}}),b}},{key:"parseSpine",value:function(a,b){var c=[],d=(0,f.qsa)(a,"itemref");return Array.prototype.slice.call(d).forEach(function(a,b){var d=a.getAttribute("idref"),e=a.getAttribute("properties")||"",f=e.length?e.split(" "):[],g={idref:d,linear:a.getAttribute("linear")||"yes",properties:f,index:b};c.push(g)}),c}},{key:"findNavPath",value:function(a){var b=(0,f.qsp)(a,"item",{properties:"nav"});return!!b&&b.getAttribute("href")}},{key:"findNcxPath",value:function(a,b){var c,d=(0,f.qsp)(a,"item",{"media-type":"application/x-dtbncx+xml"});return d||(c=b.getAttribute("toc"))&&(d=a.getElementById(c)),!!d&&d.getAttribute("href")}},{key:"findCoverPath",value:function(a){if("2.0"===(0,f.qs)(a,"package").getAttribute("version")){var b=(0,f.qsp)(a,"meta",{name:"cover"});if(b){var c=b.getAttribute("content"),d=a.getElementById(c);return d?d.getAttribute("href"):""}return!1}var e=(0,f.qsp)(a,"item",{properties:"cover-image"});return e?e.getAttribute("href"):""}},{key:"getElementText",value:function(a,b){var c,d=a.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",b);return d&&0!==d.length?(c=d[0],c.childNodes.length?c.childNodes[0].nodeValue:""):""}},{key:"getPropertyText",value:function(a,b){var c=(0,f.qsp)(a,"meta",{property:b});return c&&c.childNodes.length?c.childNodes[0].nodeValue:""}},{key:"load",value:function(a){var b=this;return this.metadata=a.metadata,this.spine=a.spine.map(function(a,b){return a.index=b,a}),a.resources.forEach(function(a,c){b.manifest[c]=a,a.rel&&"cover"===a.rel[0]&&(b.coverPath=a.href)}),this.spineNodeIndex=0,this.toc=a.toc.map(function(a,b){return a.label=a.title,a}),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:"destroy",value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),a}();b.default=g,a.exports=b.default},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(0),g=function(){function a(b){d(this,a),this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,b&&this.parse(b)}return e(a,[{key:"parse",value:function(a){var b=a.nodeType,c=void 0,d=void 0;b&&(c=(0,f.qs)(a,"html"),d=(0,f.qs)(a,"ncx")),b?c?(this.toc=this.parseNav(a),this.landmarks=this.parseLandmarks(a)):d&&(this.toc=this.parseNcx(a)):this.toc=this.load(a),this.length=0,this.unpack(this.toc)}},{key:"unpack",value:function(a){for(var b,c=0;c<a.length;c++)b=a[c],b.href&&(this.tocByHref[b.href]=c),b.id&&(this.tocById[b.id]=c),this.length++,b.subitems.length&&this.unpack(b.subitems)}},{key:"get",value:function(a){var b;return a?(0===a.indexOf("#")?b=this.tocById[a.substring(1)]:a in this.tocByHref&&(b=this.tocByHref[a]),this.toc[b]):this.toc}},{key:"landmark",value:function(a){var b;return a?(b=this.landmarksByType[a],this.landmarks[b]):this.landmarks}},{key:"parseNav",value:function(a){var b,c,d,e=(0,f.querySelectorByType)(a,"nav","toc"),g=e?(0,f.qsa)(e,"li"):[],h=g.length,i={},j=[];if(!g||0===h)return j;for(b=0;b<h;++b)(c=this.navItem(g[b]))&&(i[c.id]=c,c.parent?(d=i[c.parent],d.subitems.push(c)):j.push(c));return j}},{key:"navItem",value:function(a){var b=a.getAttribute("id")||void 0,c=(0,f.filterChildren)(a,"a",!0);if(c){var d=c.getAttribute("href")||"",e=c.textContent||"",g=[],h=(0,f.getParentByTagName)(a,"li"),i=void 0;for(h&&(i=h.getAttribute("id"));!i&&h;)(h=(0,f.getParentByTagName)(h,"li"))&&(i=h.getAttribute("id"));return{id:b,href:d,label:e,subitems:g,parent:i}}}},{key:"parseLandmarks",value:function(a){var b,c,d=(0,f.querySelectorByType)(a,"nav","landmarks"),e=d?(0,f.qsa)(d,"li"):[],g=e.length,h=[];if(!e||0===g)return h;for(b=0;b<g;++b)(c=this.landmarkItem(e[b]))&&(h.push(c),this.landmarksByType[c.type]=b);return h}},{key:"landmarkItem",value:function(a){var b=(0,f.filterChildren)(a,"a",!0);if(b){var c=b.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0;return{href:b.getAttribute("href")||"",label:b.textContent||"",type:c}}}},{key:"parseNcx",value:function(a){var b,c,d,e=(0,f.qsa)(a,"navPoint"),g=e.length,h={},i=[];if(!e||0===g)return i;for(b=0;b<g;++b)c=this.ncxItem(e[b]),h[c.id]=c,c.parent?(d=h[c.parent],d.subitems.push(c)):i.push(c);return i}},{key:"ncxItem",value:function(a){var b,c=a.getAttribute("id")||!1,d=(0,f.qs)(a,"content"),e=d.getAttribute("src"),g=(0,f.qs)(a,"navLabel"),h=g.textContent?g.textContent:"",i=[],j=a.parentNode;return j&&"navPoint"===j.nodeName&&(b=j.getAttribute("id")),{id:c,href:e,label:h,subitems:i,parent:b}}},{key:"load",value:function(a){var b=this;return a.map(function(a){return a.label=a.title,a.children&&(a.subitems=b.load(a.children)),a})}},{key:"forEach",value:function(a){return this.toc.forEach(a)}}]),a}();b.default=g,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(7),h=c(0),i=c(5),j=d(i),k=c(17),l=d(k),m=c(4),n=d(m),o=c(6),p=d(o),q=function(){function a(b,c){e(this,a),this.settings={replacements:c&&c.replacements||"base64",archive:c&&c.archive,resolver:c&&c.resolver,request:c&&c.request},this.manifest=b,this.resources=Object.keys(b).map(function(a){return b[a]}),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return f(a,[{key:"split",value:function(){this.html=this.resources.filter(function(a){if("application/xhtml+xml"===a.type||"text/html"===a.type)return!0}),this.assets=this.resources.filter(function(a){if("application/xhtml+xml"!==a.type&&"text/html"!==a.type)return!0}),this.css=this.resources.filter(function(a){if("text/css"===a.type)return!0})}},{key:"splitUrls",value:function(){this.urls=this.assets.map(function(a){return a.href}.bind(this)),this.cssUrls=this.css.map(function(a){return a.href})}},{key:"createUrl",value:function(a){var b=new j.default(a),c=l.default.lookup(b.filename);return this.settings.archive?this.settings.archive.createUrl(a,{base64:"base64"===this.settings.replacements}):"base64"===this.settings.replacements?this.settings.request(a,"blob").then(function(a){return(0,h.blob2base64)(a)}).then(function(a){return(0,h.createBase64Url)(a,c)}):this.settings.request(a,"blob").then(function(a){return(0,h.createBlobUrl)(a,c)})}},{key:"replacements",value:function(){var a=this;if("none"===this.settings.replacements)return new Promise(function(a){a(this.urls)}.bind(this));var b=this.urls.map(function(b){var c=a.settings.resolver(b);return a.createUrl(c).catch(function(a){return console.error(a),null})});return Promise.all(b).then(function(b){return a.replacementUrls=b.filter(function(a){return"string"==typeof a}),b})}},{key:"replaceCss",value:function(a,b){var c=[];return a=a||this.settings.archive,b=b||this.settings.resolver,this.cssUrls.forEach(function(d){var e=this.createCssFile(d,a,b).then(function(a){var b=this.urls.indexOf(d);b>-1&&(this.replacementUrls[b]=a)}.bind(this));c.push(e)}.bind(this)),Promise.all(c)}},{key:"createCssFile",value:function(a){var b,c=this;if(p.default.isAbsolute(a))return new Promise(function(a){a()});var d,e=this.settings.resolver(a);d=this.settings.archive?this.settings.archive.getText(e):this.settings.request(e,"text");var f=this.urls.map(function(a){var b=c.settings.resolver(a);return new n.default(e).relative(b)});return d?d.then(function(a){return a=(0,g.substitute)(a,f,c.replacementUrls),b="base64"===c.settings.replacements?(0,h.createBase64Url)(a,"text/css"):(0,h.createBlobUrl)(a,"text/css")},function(a){return new Promise(function(a){a()})}):new Promise(function(a){a()})}},{key:"relativeTo",value:function(a,b){return b=b||this.settings.resolver,this.urls.map(function(c){var d=b(c);return new n.default(a).relative(d)}.bind(this))}},{key:"get",value:function(a){var b=this.urls.indexOf(a);if(-1!==b)return this.replacementUrls.length?new Promise(function(a,c){a(this.replacementUrls[b])}.bind(this)):this.createUrl(a)}},{key:"substitute",value:function(a,b){var c;return c=b?this.relativeTo(b):this.urls,(0,g.substitute)(a,c,this.replacementUrls)}},{key:"destroy",value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),a}();b.default=q,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(1),h=d(g),i=c(0),j=function(){function a(b){e(this,a),this.pages=[],this.locations=[],this.epubcfi=new h.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,b&&(this.pageList=this.parse(b)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return f(a,[{key:"parse",value:function(a){var b=(0,i.qs)(a,"html"),c=(0,i.qs)(a,"ncx");if(b)return this.parseNav(a)}},{key:"parseNav",value:function(a){var b,c,d=(0,i.querySelectorByType)(a,"nav","page-list"),e=d?(0,i.qsa)(d,"li"):[],f=e.length,g=[];if(!e||0===f)return g;for(b=0;b<f;++b)c=this.item(e[b]),g.push(c);return g}},{key:"item",value:function(a){var b,c,d,e=(0,i.qs)(a,"a"),f=e.getAttribute("href")||"",g=e.textContent||"",h=parseInt(g),j=f.indexOf("epubcfi");return-1!=j?(b=f.split("#"),c=b[0],d=b.length>1&&b[1],{cfi:d,href:f,packageUrl:c,page:h}):{href:f,page:h}}},{key:"process",value:function(a){a.forEach(function(a){this.pages.push(a.page),a.cfi&&this.locations.push(a.cfi)},this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:"pageFromCfi",value:function(a){var b=-1;if(0===this.locations.length)return-1;var c=(0,i.indexOfSorted)(a,this.locations,this.epubcfi.compare);return-1!=c?b=this.pages[c]:(c=(0,i.locationOf)(a,this.locations,this.epubcfi.compare),void 0!==(b=c-1>=0?this.pages[c-1]:this.pages[0])||(b=-1)),b}},{key:"cfiFromPage",value:function(a){var b=-1;"number"!=typeof a&&(a=parseInt(a));var c=this.pages.indexOf(a);return-1!=c&&(b=this.locations[c]),b}},{key:"pageFromPercentage",value:function(a){return Math.round(this.totalPages*a)}},{key:"percentageFromPage",value:function(a){var b=(a-this.firstPage)/this.totalPages;return Math.round(1e3*b)/1e3}},{key:"percentageFromCfi",value:function(a){var b=this.pageFromCfi(a);return this.percentageFromPage(b)}},{key:"destroy",value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),a}();b.default=j,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(3),i=c(2),j=d(i),k=function(){function a(b){e(this,a),this.settings=b,this.name=b.layout||"reflowable",this._spread="none"!==b.spread,this._minSpreadWidth=b.minSpreadWidth||800,this._evenSpreads=b.evenSpreads||!1,"scrolled"===b.flow||"scrolled-continuous"===b.flow||"scrolled-doc"===b.flow?this._flow="scrolled":this._flow="paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return f(a,[{key:"flow",value:function(a){return void 0!==a&&(this._flow="scrolled"===a||"scrolled-continuous"===a||"scrolled-doc"===a?"scrolled":"paginated",this.update({flow:this._flow})),this._flow}},{key:"spread",value:function(a,b){return a&&(this._spread="none"!==a,this.update({spread:this._spread})),b>=0&&(this._minSpreadWidth=b),this._spread}},{key:"calculate",value:function(a,b,c){var d,e,f,g,h=1,i=c||0,j=a,k=b,l=Math.floor(j/12);h=this._spread&&j>=this._minSpreadWidth?2:1,"reflowable"!==this.name||"paginated"!==this._flow||c>=0||(i=l%2==0?l:l-1),"pre-paginated"===this.name&&(i=0),h>1?(d=j/h-i,f=d+i):(d=j,f=j),"pre-paginated"===this.name&&h>1&&(j=d),e=d*h+i,g=j,this.width=j,this.height=k,this.spreadWidth=e,this.pageWidth=f,this.delta=g,this.columnWidth=d,this.gap=i,this.divisor=h,this.update({width:j,height:k,spreadWidth:e,pageWidth:f,delta:g,columnWidth:d,gap:i,divisor:h})}},{key:"format",value:function(a){return"pre-paginated"===this.name?a.fit(this.columnWidth,this.height):"paginated"===this._flow?a.columns(this.width,this.height,this.columnWidth,this.gap):a.size(this.width,null)}},{key:"count",value:function(a,b){var c=void 0,d=void 0;return"pre-paginated"===this.name?(c=1,d=1):"paginated"===this._flow?(b=b||this.delta,c=Math.ceil(a/b),d=c*this.divisor):(b=b||this.height,c=Math.ceil(a/b),d=c),{spreads:c,pages:d}}},{key:"update",value:function(a){var b=this;if(Object.keys(a).forEach(function(c){b.props[c]===a[c]&&delete a[c]}),Object.keys(a).length>0){var c=(0,g.extend)(this.props,a);this.emit(h.EVENTS.LAYOUT.UPDATED,c,a)}}}]),a}();(0,j.default)(k.prototype),b.default=k,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(5),i=d(h),j=function(){function a(b){e(this,a),this.rendition=b,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return g(a,[{key:"register",value:function(){if(0!==arguments.length)return 1===arguments.length&&"object"===f(arguments[0])?this.registerThemes(arguments[0]):1===arguments.length&&"string"==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&"string"==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&"object"===f(arguments[1])?this.registerRules(arguments[0],arguments[1]):void 0}},{key:"default",value:function(a){if(a)return"string"==typeof a?this.registerUrl("default",a):"object"===(void 0===a?"undefined":f(a))?this.registerRules("default",a):void 0}},{key:"registerThemes",value:function(a){for(var b in a)a.hasOwnProperty(b)&&("string"==typeof a[b]?this.registerUrl(b,a[b]):this.registerRules(b,a[b]))}},{key:"registerUrl",value:function(a,b){var c=new i.default(b);this._themes[a]={url:c.toString()},this._injected[a]&&this.update(a)}},{key:"registerRules",value:function(a,b){this._themes[a]={rules:b},this._injected[a]&&this.update(a)}},{key:"select",value:function(a){var b,c=this._current;this._current=a,this.update(a),b=this.rendition.getContents(),b.forEach(function(b){b.removeClass(c),b.addClass(a)})}},{key:"update",value:function(a){var b=this;this.rendition.getContents().forEach(function(c){b.add(a,c)})}},{key:"inject",value:function(a){var b,c=[],d=this._themes;for(var e in d)!d.hasOwnProperty(e)||e!==this._current&&"default"!==e||(b=d[e],(b.rules&&Object.keys(b.rules).length>0||b.url&&-1===c.indexOf(b.url))&&this.add(e,a),this._injected.push(e));"default"!=this._current&&a.addClass(this._current)}},{key:"add",value:function(a,b){var c=this._themes[a];c&&b&&(c.url?b.addStylesheet(c.url):c.serialized||c.rules&&(b.addStylesheetRules(c.rules),c.injected=!0))}},{key:"override",value:function(a,b,c){var d=this,e=this.rendition.getContents();this._overrides[a]={value:b,priority:!0===c},e.forEach(function(b){b.css(a,d._overrides[a].value,d._overrides[a].priority)})}},{key:"overrides",value:function(a){var b=this._overrides;for(var c in b)b.hasOwnProperty(c)&&a.css(c,b[c].value,b[c].priority)}},{key:"fontSize",value:function(a){this.override("font-size",a)}},{key:"font",value:function(a){this.override("font-family",a,!0)}},{key:"destroy",value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),a}();b.default=j,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(2),h=d(g),i=c(1),j=d(i),k=function(){function a(b){e(this,a),this.rendition=b,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}return f(a,[{key:"add",value:function(a,b,c,d){var e=encodeURI(b),f=new j.default(b),g=f.spinePos,h=new l({type:a,cfiRange:b,data:c,sectionIndex:g,cb:d});return this._annotations[e]=h,g in this._annotationsBySectionIndex?this._annotationsBySectionIndex[g].push(e):this._annotationsBySectionIndex[g]=[e],this.rendition.views().forEach(function(a){h.sectionIndex===a.index&&h.attach(a)}),h}},{key:"remove",value:function(a,b){var c=this,d=encodeURI(a);if(d in this._annotations){var e=this._annotations[d];if(b&&e.type!==b)return;this.rendition.views().forEach(function(a){c._removeFromAnnotationBySectionIndex(e.sectionIndex,d),e.sectionIndex===a.index&&e.detach(a)}),delete this._annotations[d]}}},{key:"_removeFromAnnotationBySectionIndex",value:function(a,b){this._annotationsBySectionIndex[a]=this._annotationsAt(a).filter(function(a){return a!==b})}},{key:"_annotationsAt",value:function(a){return this._annotationsBySectionIndex[a]}},{key:"highlight",value:function(a,b,c){this.add("highlight",a,b,c)}},{key:"underline",value:function(a,b,c){this.add("underline",a,b,c)}},{key:"mark",value:function(a,b,c){this.add("mark",a,b,c)}},{key:"each",value:function(){return this._annotations.forEach.apply(this._annotations,arguments)}},{key:"inject",value:function(a){var b=this,c=a.index;if(c in this._annotationsBySectionIndex){this._annotationsBySectionIndex[c].forEach(function(c){b._annotations[c].attach(a)})}}},{key:"clear",value:function(a){var b=this,c=a.index;if(c in this._annotationsBySectionIndex){this._annotationsBySectionIndex[c].forEach(function(c){b._annotations[c].detach(a)})}}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),a}(),l=function(){function a(b){var c=b.type,d=b.cfiRange,f=b.data,g=b.sectionIndex,h=b.cb;e(this,a),this.type=c,this.cfiRange=d,this.data=f,this.sectionIndex=g,this.mark=void 0,this.cb=h}return f(a,[{key:"update",value:function(a){this.data=a}},{key:"attach",value:function(a){var b=this.cfiRange,c=this.data,d=this.type,e=(this.mark,this.cb),f=void 0;return"highlight"===d?f=a.highlight(b,c,e):"underline"===d?f=a.underline(b,c,e):"mark"===d&&(f=a.mark(b,c,e)),this.mark=f,f}},{key:"detach",value:function(a){var b=this.cfiRange,c=this.type,d=void 0;return a&&("highlight"===c?d=a.unhighlight(b):"underline"===c?d=a.ununderline(b):"mark"===c&&(d=a.unmark(b))),this.mark=void 0,d}},{key:"text",value:function(){}}]),a}();(0,h.default)(l.prototype),b.default=k,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==(void 0===b?"undefined":k(b))&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+(void 0===b?"undefined":k(b)));a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function g(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function h(a,b){var c=b.getBoundingClientRect(),d=a.getBoundingClientRect();return{top:d.top-c.top,left:d.left-c.left,height:a.scrollHeight,width:a.scrollWidth}}function i(a,b){a.style.top=b.top+"px",a.style.left=b.left+"px",a.style.height=b.height+"px",a.style.width=b.width+"px"}function j(a,b){return b.right<=a.right&&b.left>=a.left&&b.top>=a.top&&b.bottom<=a.bottom}var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};Object.defineProperty(b,"__esModule",{value:!0}),b.Underline=b.Highlight=b.Mark=b.Pane=void 0;var l=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n=c(54),o=d(n),p=c(55),q=d(p),r=(b.Pane=function(){function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body;g(this,a),this.target=b,this.element=o.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),q.default.proxyMouse(this.target,this.marks),this.container=c,this.container.appendChild(this.element),this.render()}return m(a,[{key:"addMark",value:function(a){var b=o.default.createElement("g");return this.element.appendChild(b),a.bind(b,this.container),this.marks.push(a),a.render(),a}},{key:"removeMark",value:function(a){var b=this.marks.indexOf(a);if(-1!==b){var c=a.unbind();this.element.removeChild(c),this.marks.splice(b,1)}}},{key:"render",value:function(){i(this.element,h(this.target,this.container));var a=!0,b=!1,c=void 0;try{for(var d,e=this.marks[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){d.value.render()}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}}]),a}(),b.Mark=function(){function a(){g(this,a),this.element=null}return m(a,[{key:"bind",value:function(a,b){this.element=a,this.container=b}},{key:"unbind",value:function(){var a=this.element;return this.element=null,a}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(a){this.element&&this.element.dispatchEvent(a)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var a=[],b=this.element.firstChild;b;)a.push(b.getBoundingClientRect()),b=b.nextSibling;return a}},{key:"filteredRanges",value:function(){var a=Array.from(this.range.getClientRects());return a.filter(function(b){for(var c=0;c<a.length;c++){if(a[c]===b)return!0;if(j(a[c],b))return!1}return!0})}}]),a}()),s=b.Highlight=function(a){function b(a,c,d,f){g(this,b);var h=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return h.range=a,h.className=c,h.data=d||{},h.attributes=f||{},h}return f(b,a),m(b,[{key:"bind",value:function(a,c){l(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"bind",this).call(this,a,c);for(var d in this.data)this.data.hasOwnProperty(d)&&(this.element.dataset[d]=this.data[d]);for(var d in this.attributes)this.attributes.hasOwnProperty(d)&&this.element.setAttribute(d,this.attributes[d]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var a=this.element.ownerDocument.createDocumentFragment(),b=this.filteredRanges(),c=this.element.getBoundingClientRect(),d=this.container.getBoundingClientRect(),e=0,f=b.length;e<f;e++){var g=b[e],h=o.default.createElement("rect");h.setAttribute("x",g.left-c.left+d.left),h.setAttribute("y",g.top-c.top+d.top),h.setAttribute("height",g.height),h.setAttribute("width",g.width),a.appendChild(h)}this.element.appendChild(a)}}]),b}(r);b.Underline=function(a){function b(a,c,d,f){return g(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d,f))}return f(b,a),m(b,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var a=this.element.ownerDocument.createDocumentFragment(),b=this.filteredRanges(),c=this.element.getBoundingClientRect(),d=this.container.getBoundingClientRect(),e=0,f=b.length;e<f;e++){var g=b[e],h=o.default.createElement("rect");h.setAttribute("x",g.left-c.left+d.left),h.setAttribute("y",g.top-c.top+d.top),h.setAttribute("height",g.height),h.setAttribute("width",g.width),h.setAttribute("fill","none");var i=o.default.createElement("line");i.setAttribute("x1",g.left-c.left+d.left),i.setAttribute("x2",g.left-c.left+d.left+g.width),i.setAttribute("y1",g.top-c.top+d.top+g.height-1),i.setAttribute("y2",g.top-c.top+d.top+g.height-1),i.setAttribute("stroke-width",1),i.setAttribute("stroke","black"),i.setAttribute("stroke-linecap","square"),a.appendChild(h),a.appendChild(i)}this.element.appendChild(a)}}]),b}(s)},function(a,b,c){"use strict";function d(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}Object.defineProperty(b,"__esModule",{value:!0}),b.createElement=d,b.default={createElement:d}},function(a,b,c){"use strict";function d(a,b){function c(c){for(var d=b.length-1;d>=0;d--){var g=b[d],h=c.clientX,i=c.clientY;if(c.touches&&c.touches.length&&(h=c.touches[0].clientX,i=c.touches[0].clientY),f(g,a,h,i)){g.dispatchEvent(e(c));break}}}if("iframe"===a.nodeName||"IFRAME"===a.nodeName)try{this.target=a.contentDocument}catch(b){this.target=a}else this.target=a;for(var d=["mouseup","mousedown","click","touchstart"],g=0;g<d.length;g++){var h=d[g];this.target.addEventListener(h,function(a){return c(a)},!1)}}function e(a){var b=Object.assign({},a,{bubbles:!1});try{return new MouseEvent(a.type,b)}catch(d){var c=document.createEvent("MouseEvents");return c.initMouseEvent(a.type,!1,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget),c}}function f(a,b,c,d){function e(a,b,c){var d=a.top-f.top,e=a.left-f.left,g=d+a.height,h=e+a.width;return d<=c&&e<=b&&g>c&&h>b}var f=b.getBoundingClientRect();if(!e(a.getBoundingClientRect(),c,d))return!1;for(var g=a.getClientRects(),h=0,i=g.length;h<i;h++)if(e(g[h],c,d))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0}),b.proxyMouse=d,b.clone=e,b.default={proxyMouse:d}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(57),i=d(h),j=function(){function a(b){e(this,a),this.settings=b||{},this.id="epubjs-container-"+(0,g.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return f(a,[{key:"create",value:function(a){var b=a.height,c=a.width,d=a.overflow||!1,e=a.axis||"vertical",f=a.direction;a.height&&(0,g.isNumber)(a.height)&&(b=a.height+"px"),a.width&&(0,g.isNumber)(a.width)&&(c=a.width+"px");var h=document.createElement("div");return h.id=this.id,h.classList.add("epub-container"),h.style.wordSpacing="0",h.style.lineHeight="0",h.style.verticalAlign="top",h.style.position="relative","horizontal"===e&&(h.style.display="flex",h.style.flexDirection="row",h.style.flexWrap="nowrap"),c&&(h.style.width=c),b&&(h.style.height=b),d&&(h.style.overflow=d),f&&(h.dir=f,h.style.direction=f),f&&this.settings.fullsize&&(document.body.style.direction=f),h}},{key:"wrap",value:function(a){var b=document.createElement("div");return b.style.visibility="hidden",b.style.overflow="hidden",b.style.width="0",b.style.height="0",b.appendChild(a),b}},{key:"getElement",value:function(a){var b;if((0,g.isElement)(a)?b=a:"string"==typeof a&&(b=document.getElementById(a)),!b)throw new Error("Not an Element");return b}},{key:"attachTo",value:function(a){var b,c=this.getElement(a);if(c)return b=this.settings.hidden?this.wrapper:this.container,c.appendChild(b),this.element=c,c}},{key:"getContainer",value:function(){return this.container}},{key:"onResize",value:function(a){(0,g.isNumber)(this.settings.width)&&(0,g.isNumber)(this.settings.height)||(this.resizeFunc=(0,i.default)(a,50),window.addEventListener("resize",this.resizeFunc,!1))}},{key:"onOrientationChange",value:function(a){this.orientationChangeFunc=a,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}},{key:"size",value:function(a,b){var c;null===a&&(c=this.element.getBoundingClientRect(),c.width&&(a=c.width,this.container.style.width=c.width+"px")),null===b&&(c=c||this.element.getBoundingClientRect(),c.height&&(b=c.height,this.container.style.height=c.height+"px")),(0,g.isNumber)(a)||(c=this.container.getBoundingClientRect(),a=c.width),(0,g.isNumber)(b)||(c=c||this.container.getBoundingClientRect(),b=c.height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};var d=(0,g.windowBounds)();return a||(a=d.width),!this.settings.fullsize&&b||(b=d.height),{width:a-this.containerPadding.left-this.containerPadding.right,height:b-this.containerPadding.top-this.containerPadding.bottom}}},{key:"bounds",value:function(){var a=void 0;return"visible"!==this.container.style.overflow&&(a=this.container&&this.container.getBoundingClientRect()),a&&a.width&&a.height?a:(0,g.windowBounds)()}},{key:"getSheet",value:function(){var a=document.createElement("style");return a.appendChild(document.createTextNode("")),document.head.appendChild(a),a.sheet}},{key:"addStyleRules",value:function(a,b){var c="#"+this.id+" ",d="";this.sheet||(this.sheet=this.getSheet()),b.forEach(function(a){for(var b in a)a.hasOwnProperty(b)&&(d+=b+":"+a[b]+";")}),this.sheet.insertRule(c+a+" {"+d+"}",0)}},{key:"axis",value:function(a){"horizontal"===a?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block"}},{key:"direction",value:function(a){this.container&&(this.container.dir=a,this.container.style.direction=a),this.settings.fullsize&&(document.body.style.direction=a)}},{key:"destroy",value:function(){this.element&&(this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}]),a}();b.default=j,a.exports=b.default},function(a,b,c){function d(a,b,c){var d=!0,h=!0;if("function"!=typeof a)throw new TypeError(g);return f(c)&&(d="leading"in c?!!c.leading:d,h="trailing"in c?!!c.trailing:h),e(a,b,{leading:d,maxWait:b,trailing:h})}var e=c(21),f=c(15),g="Expected a function";a.exports=d},function(a,b,c){var d=c(22),e=function(){return d.Date.now()};a.exports=e},function(a,b,c){(function(b){var c="object"==typeof b&&b&&b.Object===Object&&b;a.exports=c}).call(b,c(8))},function(a,b,c){function d(a){if("number"==typeof a)return a;if(f(a))return g;if(e(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=e(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(h,"");var c=j.test(a);return c||k.test(a)?l(a.slice(2),c?2:8):i.test(a)?g:+a}var e=c(15),f=c(61),g=NaN,h=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,j=/^0b[01]+$/i,k=/^0o[0-7]+$/i,l=parseInt;a.exports=d},function(a,b,c){function d(a){return"symbol"==typeof a||f(a)&&e(a)==g}var e=c(62),f=c(65),g="[object Symbol]";a.exports=d},function(a,b,c){function d(a){return null==a?void 0===a?i:h:j&&j in Object(a)?f(a):g(a)}var e=c(23),f=c(63),g=c(64),h="[object Null]",i="[object Undefined]",j=e?e.toStringTag:void 0;a.exports=d},function(a,b,c){function d(a){var b=g.call(a,i),c=a[i];try{a[i]=void 0;var d=!0}catch(a){}var e=h.call(a);return d&&(b?a[i]=c:delete a[i]),e}var e=c(23),f=Object.prototype,g=f.hasOwnProperty,h=f.toString,i=e?e.toStringTag:void 0;a.exports=d},function(a,b){function c(a){return e.call(a)}var d=Object.prototype,e=d.toString;a.exports=c},function(a,b){function c(a){return null!=a&&"object"==typeof a}a.exports=c},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=function(){function a(b){d(this,a),this.container=b,this._views=[],this.length=0,this.hidden=!1}return e(a,[{key:"all",value:function(){return this._views}},{key:"first",value:function(){return this._views[0]}},{key:"last",value:function(){return this._views[this._views.length-1]}},{key:"indexOf",value:function(a){return this._views.indexOf(a)}},{key:"slice",value:function(){return this._views.slice.apply(this._views,arguments)}},{key:"get",value:function(a){return this._views[a]}},{key:"append",value:function(a){return this._views.push(a),this.container&&this.container.appendChild(a.element),this.length++,a}},{key:"prepend",value:function(a){return this._views.unshift(a),this.container&&this.container.insertBefore(a.element,this.container.firstChild),this.length++,a}},{key:"insert",value:function(a,b){return this._views.splice(b,0,a),this.container&&(b<this.container.children.length?this.container.insertBefore(a.element,this.container.children[b]):this.container.appendChild(a.element)),this.length++,a}},{key:"remove",value:function(a){var b=this._views.indexOf(a);b>-1&&this._views.splice(b,1),this.destroy(a),this.length--}},{key:"destroy",value:function(a){a.displayed&&a.destroy(),this.container&&this.container.removeChild(a.element),a=null}},{key:"forEach",value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:"clear",value:function(){var a,b=this.length;if(this.length){for(var c=0;c<b;c++)a=this._views[c],this.destroy(a);this._views=[],this.length=0}}},{key:"find",value:function(a){for(var b,c=this.length,d=0;d<c;d++)if(b=this._views[d],b.displayed&&b.section.index==a.index)return b}},{key:"displayed",value:function(){for(var a,b=[],c=this.length,d=0;d<c;d++)a=this._views[d],a.displayed&&b.push(a);return b}},{key:"show",value:function(){for(var a,b=this.length,c=0;c<b;c++)a=this._views[c],a.displayed&&a.show();this.hidden=!1}},{key:"hide",value:function(){for(var a,b=this.length,c=0;c<b;c++)a=this._views[c],a.displayed&&a.hide();this.hidden=!0}}]),a}();b.default=f,a.exports=b.default},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(0),h=c(11),i=d(h),j=c(17),k=d(j),l=c(4),m=d(l),n=function(){function a(){e(this,a),this.zip=void 0,this.urlCache={},this.checkRequirements()}return f(a,[{key:"checkRequirements",value:function(){try{if("undefined"==typeof JSZip){var a=c(68);this.zip=new a}else this.zip=new JSZip}catch(a){throw new Error("JSZip lib not loaded")}}},{key:"open",value:function(a,b){return this.zip.loadAsync(a,{base64:b})}},{key:"openUrl",value:function(a,b){return(0,i.default)(a,"binary").then(function(a){return this.zip.loadAsync(a,{base64:b})}.bind(this))}},{key:"request",value:function(a,b){var c,d=new g.defer,e=new m.default(a);return b||(b=e.extension),c="blob"==b?this.getBlob(a):this.getText(a),c?c.then(function(a){var c=this.handleResponse(a,b);d.resolve(c)}.bind(this)):d.reject({message:"File not found in the epub: "+a,stack:(new Error).stack}),d.promise}},{key:"handleResponse",value:function(a,b){return"json"==b?JSON.parse(a):(0,g.isXml)(b)?(0,g.parse)(a,"text/xml"):"xhtml"==b?(0,g.parse)(a,"application/xhtml+xml"):"html"==b||"htm"==b?(0,g.parse)(a,"text/html"):a}},{key:"getBlob",value:function(a,b){var c=window.decodeURIComponent(a.substr(1)),d=this.zip.file(c);if(d)return b=b||k.default.lookup(d.name),d.async("uint8array").then(function(a){return new Blob([a],{type:b})})}},{key:"getText",value:function(a,b){var c=window.decodeURIComponent(a.substr(1)),d=this.zip.file(c);if(d)return d.async("string").then(function(a){return a})}},{key:"getBase64",value:function(a,b){var c=window.decodeURIComponent(a.substr(1)),d=this.zip.file(c);if(d)return b=b||k.default.lookup(d.name),d.async("base64").then(function(a){return"data:"+b+";base64,"+a})}},{key:"createUrl",value:function(a,b){var c,d,e=new g.defer,f=window.URL||window.webkitURL||window.mozURL,h=b&&b.base64;return a in this.urlCache?(e.resolve(this.urlCache[a]),e.promise):(h?(d=this.getBase64(a))&&d.then(function(b){this.urlCache[a]=b,e.resolve(b)}.bind(this)):(d=this.getBlob(a))&&d.then(function(b){c=f.createObjectURL(b),this.urlCache[a]=c,e.resolve(c)}.bind(this)),d||e.reject({message:"File not found in the epub: "+a,stack:(new Error).stack}),e.promise)}},{key:"revokeUrl",value:function(a){var b=window.URL||window.webkitURL||window.mozURL,c=this.urlCache[a];c&&b.revokeObjectURL(c)}},{key:"destroy",value:function(){var a=window.URL||window.webkitURL||window.mozURL;for(var b in this.urlCache)a.revokeObjectURL(b);this.zip=void 0,this.urlCache={}}}]),a}();b.default=n,a.exports=b.default},function(a,c){if(void 0===b){var d=new Error('Cannot find module "jszip"');throw d.code="MODULE_NOT_FOUND",d}a.exports=b},function(a,b,c){"use strict";(function(a,c){var d,e,f,g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(h,i){h||(h=window||a),"object"===g(c)&&c.exports?c.exports=i(h):(e=[],d=i,void 0!==(f="function"==typeof d?d.apply(b,e):d)&&(c.exports=f))}(void 0,function(a){function b(a){return void 0!==l[a]}function c(){h.call(this),this._isInvalid=!0}function d(a){return""==a&&c.call(this),a.toLowerCase()}function e(a){var b=a.charCodeAt(0);return b>32&&b<127&&-1==[34,35,60,62,63,96].indexOf(b)?a:encodeURIComponent(a)}function f(a){var b=a.charCodeAt(0);return b>32&&b<127&&-1==[34,35,60,62,96].indexOf(b)?a:encodeURIComponent(a)}function g(a,g,h){function i(a){t.push(a)}var j=g||"scheme start",k=0,q="",r=!1,s=!1,t=[];a:for(;(a[k-1]!=n||0==k)&&!this._isInvalid;){var u=a[k];switch(j){case"scheme start":if(!u||!o.test(u)){if(g){i("Invalid scheme.");break a}q="",j="no scheme";continue}q+=u.toLowerCase(),j="scheme";break;case"scheme":if(u&&p.test(u))q+=u.toLowerCase();else{if(":"!=u){if(g){if(n==u)break a;i("Code point not allowed in scheme: "+u);break a}q="",k=0,j="no scheme";continue}if(this._scheme=q,q="",g)break a;b(this._scheme)&&(this._isRelative=!0),j="file"==this._scheme?"relative":this._isRelative&&h&&h._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==u?(this._query="?",j="query"):"#"==u?(this._fragment="#",j="fragment"):n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._schemeData+=e(u));break;case"no scheme":if(h&&b(h._scheme)){j="relative";continue}i("Missing scheme."),c.call(this);break;case"relative or authority":if("/"!=u||"/"!=a[k+1]){i("Expected /, got: "+u),j="relative";continue}j="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=h._scheme),n==u){this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query=h._query,this._username=h._username,this._password=h._password;break a}if("/"==u||"\\"==u)"\\"==u&&i("\\ is an invalid code point."),j="relative slash";else if("?"==u)this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query="?",this._username=h._username,this._password=h._password,j="query";else{if("#"!=u){var v=a[k+1],w=a[k+2];("file"!=this._scheme||!o.test(u)||":"!=v&&"|"!=v||n!=w&&"/"!=w&&"\\"!=w&&"?"!=w&&"#"!=w)&&(this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password,this._path=h._path.slice(),this._path.pop()),j="relative path";continue}this._host=h._host,this._port=h._port,this._path=h._path.slice(),this._query=h._query,this._fragment="#",this._username=h._username,this._password=h._password,j="fragment"}break;case"relative slash":if("/"!=u&&"\\"!=u){"file"!=this._scheme&&(this._host=h._host,this._port=h._port,this._username=h._username,this._password=h._password),j="relative path";continue}"\\"==u&&i("\\ is an invalid code point."),j="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=u){i("Expected '/', got: "+u),j="authority ignore slashes";continue}j="authority second slash";break;case"authority second slash":if(j="authority ignore slashes","/"!=u){i("Expected '/', got: "+u);continue}break;case"authority ignore slashes":if("/"!=u&&"\\"!=u){j="authority";continue}i("Expected authority, got: "+u);break;case"authority":if("@"==u){r&&(i("@ already seen."),q+="%40"),r=!0;for(var x=0;x<q.length;x++){var y=q[x];if("\t"!=y&&"\n"!=y&&"\r"!=y)if(":"!=y||null!==this._password){var z=e(y);null!==this._password?this._password+=z:this._username+=z}else this._password="";else i("Invalid whitespace in authority.")}q=""}else{if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){k-=q.length,q="",j="host";continue}q+=u}break;case"file host":if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){2!=q.length||!o.test(q[0])||":"!=q[1]&&"|"!=q[1]?0==q.length?j="relative path start":(this._host=d.call(this,q),q="",j="relative path start"):j="relative path";continue}"\t"==u||"\n"==u||"\r"==u?i("Invalid whitespace in file host."):q+=u;break;case"host":case"hostname":if(":"!=u||s){if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u){if(this._host=d.call(this,q),q="",j="relative path start",g)break a;continue}"\t"!=u&&"\n"!=u&&"\r"!=u?("["==u?s=!0:"]"==u&&(s=!1),q+=u):i("Invalid code point in host/hostname: "+u)}else if(this._host=d.call(this,q),q="",j="port","hostname"==g)break a;break;case"port":if(/[0-9]/.test(u))q+=u;else{if(n==u||"/"==u||"\\"==u||"?"==u||"#"==u||g){if(""!=q){var A=parseInt(q,10);A!=l[this._scheme]&&(this._port=A+""),q=""}if(g)break a;j="relative path start";continue}"\t"==u||"\n"==u||"\r"==u?i("Invalid code point in port: "+u):c.call(this)}break;case"relative path start":if("\\"==u&&i("'\\' not allowed in path."),j="relative path","/"!=u&&"\\"!=u)continue;break;case"relative path":if(n!=u&&"/"!=u&&"\\"!=u&&(g||"?"!=u&&"#"!=u))"\t"!=u&&"\n"!=u&&"\r"!=u&&(q+=e(u));else{"\\"==u&&i("\\ not allowed in relative path.");var B;(B=m[q.toLowerCase()])&&(q=B),".."==q?(this._path.pop(),"/"!=u&&"\\"!=u&&this._path.push("")):"."==q&&"/"!=u&&"\\"!=u?this._path.push(""):"."!=q&&("file"==this._scheme&&0==this._path.length&&2==q.length&&o.test(q[0])&&"|"==q[1]&&(q=q[0]+":"),this._path.push(q)),q="","?"==u?(this._query="?",j="query"):"#"==u&&(this._fragment="#",j="fragment")}break;case"query":g||"#"!=u?n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._query+=f(u)):(this._fragment="#",j="fragment");break;case"fragment":n!=u&&"\t"!=u&&"\n"!=u&&"\r"!=u&&(this._fragment+=u)}k++}}function h(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function i(a,b){void 0===b||b instanceof i||(b=new i(String(b))),this._url=a,h.call(this);var c=a.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");g.call(this,c,null,b)}var j=!1;if(!a.forceJURL)try{var k=new URL("b","http://a");k.pathname="c%20d",j="http://a/c%20d"===k.href}catch(a){}if(j)return a.URL;var l=Object.create(null);l.ftp=21,l.file=0,l.gopher=70,l.http=80,l.https=443,l.ws=80,l.wss=443;var m=Object.create(null);m["%2e"]=".",m[".%2e"]="..",m["%2e."]="..",m["%2e%2e"]="..";var n=void 0,o=/[a-zA-Z]/,p=/[a-zA-Z0-9\+\-\.]/;i.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var a="";return""==this._username&&null==this._password||(a=this._username+(null!=this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+a+this.host:"")+this.pathname+this._query+this._fragment},set href(a){h.call(this),g.call(this,a)},get protocol(){return this._scheme+":"},set protocol(a){this._isInvalid||g.call(this,a+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"host")},get hostname(){return this._host},set hostname(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"hostname")},get port(){return this._port},set port(a){!this._isInvalid&&this._isRelative&&g.call(this,a,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(a){!this._isInvalid&&this._isRelative&&(this._path=[],g.call(this,a,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(a){!this._isInvalid&&this._isRelative&&(this._query="?","?"==a[0]&&(a=a.slice(1)),g.call(this,a,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(a){this._isInvalid||(this._fragment="#","#"==a[0]&&(a=a.slice(1)),g.call(this,a,"fragment"))},get origin(){var a;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"file":return"file://";case"data":case"javascript":case"mailto":return"null"}return a=this.host,a?this._scheme+"://"+a:""}};var q=a.URL;return q&&(i.createObjectURL=function(a){return q.createObjectURL.apply(q,arguments)},i.revokeObjectURL=function(a){q.revokeObjectURL(a)}),i})}).call(b,c(8),c(70)(a))},function(a,b){a.exports=function(a){return a.webpackPolyfill||(a.deprecate=function(){},a.paths=[],a.children||(a.children=[]),Object.defineProperty(a,"loaded",{enumerable:!0,get:function(){return a.l}}),Object.defineProperty(a,"id",{enumerable:!0,get:function(){return a.i}}),a.webpackPolyfill=1),a}}])});