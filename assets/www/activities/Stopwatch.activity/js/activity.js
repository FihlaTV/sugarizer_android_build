/*! Sugarizer 2019-01-12 */
define(["sugar-web/activity/activity","mustache","sugar-web/env"],function(a,b,c){requirejs(["domReady!"],function(d){function e(a,b,c){return c=c||"0",b=b||2,a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function f(a,c){this.elem=document.createElement("li"),document.getElementById("stopwatch-list").appendChild(this.elem),this.template='<p class="counter">00:00:00</p><div class="buttons-group"><button class="start-stop-button start"></button><button class="reset-button"></button><button class="mark-button"></button><button class="clear-marks-button"></button></div><p class="marks"></p><button class="remove"></button>',this.elem.innerHTML=b.render(this.template,{}),this.counterElem=this.elem.querySelector(".counter"),this.marksElem=this.elem.querySelector(".marks"),this.running=!1,this.previousTime=Date.now(),this.tenthsOfSecond=0,this.seconds=0,this.minutes=0,c?(this.marks=c,this.updateMarks()):this.marks=[],a&&(this.minutes=parseInt(a.split(":")[0]),this.seconds=parseInt(a.split(":")[1]),this.tenthsOfSecond=parseInt(a.split(":")[2]),this.updateView());var d=this;this.startStopButton=this.elem.querySelector(".start-stop-button"),this.startStopButton.onclick=function(){d.onStartStopClicked()},this.resetButton=this.elem.querySelector(".reset-button"),this.resetButton.onclick=function(){d.onResetClicked()},this.markButton=this.elem.querySelector(".mark-button"),this.markButton.onclick=function(){d.onMarkClicked()},this.clearButton=this.elem.querySelector(".clear-marks-button"),this.clearButton.onclick=function(){d.onClearMarksClicked()},this.removeButton=this.elem.querySelector(".remove"),this.removeButton.onclick=function(){d.onRemoveClicked()}}a.setup();var g=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;f.prototype.onStartStopClicked=function(){this.running?this.running=!1:(this.running=!0,this.tick()),this.updateButtons()},f.prototype.onResetClicked=function(){this.tenthsOfSecond=0,this.seconds=0,this.minutes=0,this.running?this.onStartStopClicked():this.running=!1,this.updateView()},f.prototype.onMarkClicked=function(){this.marks.push(e(this.minutes)+":"+e(this.seconds)+":"+e(this.tenthsOfSecond)),this.updateMarks()},f.prototype.onClearMarksClicked=function(){this.marks=[],this.updateMarks()},f.prototype.onRemoveClicked=function(){document.getElementById("stopwatch-list").removeChild(this.elem)},f.prototype.tick=function(){if(this.running){var a=Date.now();a-this.previousTime>100&&(this.previousTime=a,this.update(),this.updateView()),g(this.tick.bind(this))}},f.prototype.update=function(){this.tenthsOfSecond+=1,10==this.tenthsOfSecond&&(this.tenthsOfSecond=0,this.seconds+=1),60==this.seconds&&(this.seconds=0,this.minutes+=1)},f.prototype.updateView=function(){this.counterElem.innerHTML=e(this.minutes)+":"+e(this.seconds)+":"+e(this.tenthsOfSecond)},f.prototype.updateMarks=function(){this.marksElem.innerHTML="";for(var a=0;a<this.marks.length;a++)this.marksElem.innerHTML+=this.marks[a],a!==this.marks.length-1&&(this.marksElem.innerHTML+=" - ")},f.prototype.updateButtons=function(){this.running?(this.startStopButton.classList.add("stop"),this.startStopButton.classList.remove("start")):(this.startStopButton.classList.add("start"),this.startStopButton.classList.remove("stop"))},document.getElementById("add-stopwatch").onclick=function(){new f},c.getEnvironment(function(b,c){if(currentenv=c,c.objectId)a.getDatastoreObject().loadAsText(function(a,b,c){if(null==a&&null!=c){stopwatchData=JSON.parse(c);var d;for(d=0;d<Object.keys(stopwatchData).length;d++)counter=stopwatchData[d].counter,marks=stopwatchData[d].marks,new f(counter,marks)}});else for(var d=0;d<5;d++)new f})}),document.getElementById("stop-button").addEventListener("click",function(b){var c=document.getElementById("stopwatch-list").getElementsByTagName("li");stopwatchDict={};var d;for(d=0;d<c.length;d++)stopwatchDict[d]={},stopwatchDict[d].counter=c[d].getElementsByClassName("counter")[0].innerHTML,stopwatchDict[d].marks=c[d].getElementsByClassName("marks")[0].innerHTML.split(" - ");stopwatchJSON=JSON.stringify(stopwatchDict),a.getDatastoreObject().setDataAsText(stopwatchJSON),a.getDatastoreObject().save()})});