/*! Sugarizer 2019-01-12 */
define(["sugar-web/activity/activity","webL10n","sugar-web/graphics/palette","sugar-web/graphics/presencepalette"],function(a,b,c,d){var a=requirejs("sugar-web/activity/activity");requirejs(["domReady!"],function(b){function c(a){var b;do{b=a,a=a.replace(g,"")}while(a!==b);return a.replace(/</g,"&lt;")}function e(){l=a.getPresenceObject(function(a,b){if(a)return j.innerHTML=l10n_s.get("Error"),void(j.className="error");m=b.getUserInfo(),j.innerHTML=l10n_s.get("Connected"),j.className="open",h.readOnly=!1,window.top.sugar.environment.sharedId||b.createSharedActivity("org.sugarlabs.ChatPrototype",function(a){}),b.onConnectionClosed(function(a){console.log(l10n_s.get("ConnectionClosed")),j.innerHTML=l10n_s.get("DisconnectedFromWebSocket"),j.className="closed"}),b.onSharedActivityUserChanged(function(a){var b=a.user.name.replace("<","&lt;").replace(">","&gt;");i.innerHTML+='<li class="received" style = "color:blue">'+b+" "+(a.move>0?l10n_s.get("Join"):l10n_s.get("Leave"))+" "+l10n_s.get("Chat")+"</li>"}),b.onDataReceived(function(a){var b=a.content,c=a.user.name.replace("<","&lt;").replace(">","&gt;"),d=a.user.colorvalue,e='<span style = "color:'+d.stroke+'">'+c+"</span>";myElem=document.createElement("li"),myElem.class="received",myElem.style.background=d.fill,myElem.innerHTML=e+b,myElem.style.color=d.stroke,i.appendChild(myElem),k.scrollTop=k.scrollHeight})})}a.setup();var f="(?:[^\"'>]|\"[^\"]*\"|'[^']*')*",g=new RegExp("<(?:!--(?:(?:-*[^->])*--+|-?)|script\\b"+f+">[\\s\\S]*?</script\\s*|style\\b"+f+">[\\s\\S]*?</style\\s*|/?[a-z]"+f+")>","gi"),h=(document.getElementById("message-form"),document.getElementById("message")),i=document.getElementById("messages"),j=document.getElementById("status"),k=document.getElementById("content");document.getElementById("status").innerHTML=l10n_s.get("status"),h.placeholder=l10n_s.get("WriteYourMessage");var l,m=null,n=document.getElementById("network-button");d=new d.PresencePalette(n,void 0),d.addEventListener("shared",e),window.top.sugar.environment.sharedId&&(e(),d.setShared(!0)),h.onkeydown=function(a){if(13===a.keyCode){var b=c(h.value),d={user:m,content:b};return l.sendMessage(l.getSharedInfo().id,d),h.placeholder=l10n_s.get("WriteYourMessage"),h.value="",h.setSelectionRange(0,0),!1}};for(var o,p=document.getElementById("smiley-button"),q=[[128513,128515],[128517,128519],[128521,128528]],r=0;r<q.length;r++)for(var s=q[r],t=s[0];t<s[1];t++)o=document.createElement("option"),o.value=t,o.innerHTML="&#"+t+";",p.appendChild(o);for(var u,v=document.getElementById("sad-button"),w=[[128531,128533],[128545,128551],[128555,128558]],r=0;r<w.length;r++)for(var s=w[r],t=s[0];t<s[1];t++)u=document.createElement("option"),u.value=t,u.innerHTML="&#"+t+";",v.appendChild(u);for(var x,y=document.getElementById("others-button"),z=[[128568,128573],[128582,128588]],r=0;r<z.length;r++)for(var s=z[r],t=s[0];t<s[1];t++)x=document.createElement("option"),x.value=t,x.innerHTML="&#"+t+";",y.appendChild(x)})});