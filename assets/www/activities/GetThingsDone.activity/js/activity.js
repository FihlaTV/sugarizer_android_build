/*! Sugarizer 2016-12-28 */
define(["sugar-web/activity/activity","webL10n","sugar-web/datastore","activity/model","activity/view","activity/controller"],function(a,b,c,d,e,f){require(["domReady!"],function(b){function c(){this.model=new d.Model,this.view=new e.View,this.controller=new f.Controller(this.model,this.view)}function g(a,b,c){i.controller.loadItems(JSON.parse(c))}function h(a){for(var b=a;"LI"!==b.nodeName;)b=b.parentNode;return b.dataset.id}var i;a.setup(),document.getElementById("new-todo").placeholder=l10n_s.get("new-todo");var j=document.getElementById("stop-button");j.addEventListener("click",function(b){console.log("writing...");var c=JSON.stringify(i.model.items);a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?console.log("write done."):console.log("write failed.")})}),i=new c;var k=a.getDatastoreObject();k.loadAsText(g);var l=document.getElementById("new-todo");l.addEventListener("keypress",function(a){if(a.keyCode===i.controller.ENTER_KEY){var b=i.controller.addItem(a.target.value);b&&(a.target.value="")}});var m=document.getElementById("new-todo-button");m.addEventListener("click",function(a){var b=i.controller.addItem(l.value);b&&(l.value="")});var n=document.getElementById("todo-list");n.addEventListener("click",function(a){var b=a.target;b.className.indexOf("remove")>-1&&i.controller.removeItem(h(b)),b.className.indexOf("toggle")>-1&&i.controller.toggleComplete(h(b),b)})})});