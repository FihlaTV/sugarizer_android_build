/*! Sugarizer 2018-05-08 */
define(["sugar-web/activity/activity","webL10n","sugar-web/datastore","activity/model","activity/view","activity/controller"],function(a,b,c,d,e,f){require(["domReady!"],function(b){function c(){this.model=new d.Model,this.view=new e.View,this.controller=new f.Controller(this.model,this.view)}function g(a,b,c){i.controller.loadItems(JSON.parse(c))}function h(a){for(var b=a;"LI"!==b.nodeName;)b=b.parentNode;return b.dataset.id}var i;a.setup(),document.getElementById("new-todo").placeholder=l10n_s.get("new-todo");var j=document.getElementById("stop-button");j.addEventListener("click",function(b){console.log("writing...");var c=JSON.stringify(i.model.items);a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?console.log("write done."):console.log("write failed.")})});var k;document.allowDrop=function(a){a.preventDefault()},document.drag=function(a){k=a.target,a.dataTransfer.setData("text/plain",a.target.id)},document.drop=function(a){a.preventDefault();var b=k.childNodes[0].childNodes[1],c=parseInt(k.dataset.id),d=a.target,e=a.target.parentNode.parentNode,f=parseInt(e.dataset.id),g=d.innerText;d.innerText=b.innerText,b.innerText=g;var h=e.className;e.className=k.className,k.className=h,e.childNodes[0].childNodes[0].hasAttribute("checked")?k.childNodes[0].childNodes[0].hasAttribute("checked")||(e.childNodes[0].childNodes[0].removeAttribute("checked"),k.childNodes[0].childNodes[0].setAttribute("checked",null)):k.childNodes[0].childNodes[0].hasAttribute("checked")&&(e.childNodes[0].childNodes[0].hasAttribute("checked")||(k.childNodes[0].childNodes[0].removeAttribute("checked"),e.childNodes[0].childNodes[0].setAttribute("checked",null)));var j=i.controller.model.items.map(function(a){return a.id}).indexOf(c),l=i.controller.model.items.map(function(a){return a.id}).indexOf(f);i.controller.model.items[j].title=b.innerText,i.controller.model.items[l].title=d.innerText;var m=parseInt(i.controller.model.items[l].completed);i.controller.model.items[l].completed=i.controller.model.items[j].completed,i.controller.model.items[j].completed=m},i=new c;var l=a.getDatastoreObject();l.loadAsText(g);var m=document.getElementById("new-todo");m.addEventListener("keypress",function(a){if(a.keyCode===i.controller.ENTER_KEY){var b=i.controller.addItem(a.target.value);b&&(a.target.value="")}});var n=document.getElementById("new-todo-button");n.addEventListener("click",function(a){var b=i.controller.addItem(m.value);b&&(m.value="")});var o=document.getElementById("todo-list");o.addEventListener("click",function(a){var b=a.target;b.className.indexOf("remove")>-1&&i.controller.removeItem(h(b)),b.className.indexOf("toggle")>-1&&i.controller.toggleComplete(h(b),b)})})});