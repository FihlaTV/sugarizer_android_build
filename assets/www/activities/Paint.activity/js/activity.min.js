/*! Sugarizer 2018-06-12 */
define(["sugar-web/activity/activity","activity/paint-activity","activity/paint-app","sugar-web/graphics/presencepalette","activity/palettes/color-palette","activity/palettes/stamp-palette","activity/palettes/text-palette","activity/palettes/drawings-palette","activity/palettes/filters-palette","activity/buttons/size-button","activity/buttons/clear-button","activity/buttons/undo-button","activity/buttons/redo-button","activity/modes/modes-pen","activity/modes/modes-eraser","activity/modes/modes-bucket","activity/modes/modes-text","activity/modes/modes-stamp","activity/modes/modes-copy","activity/modes/modes-paste","activity/collaboration","activity/buttons/insertimage-button"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){window.PaintApp=c,PaintApp.libs.activity=a,PaintApp.palettes.presencePalette=d,PaintApp.palettes.colorPalette=e,PaintApp.palettes.stampPalette=f,PaintApp.palettes.textPalette=g,PaintApp.palettes.drawingsPalette=h,PaintApp.palettes.filtersPalette=i,PaintApp.buttons.sizeButton=j,PaintApp.buttons.clearButton=k,PaintApp.buttons.undoButton=l,PaintApp.buttons.redoButton=m,PaintApp.buttons.insertImageButton=v,PaintApp.modes.Pen=n,PaintApp.modes.Eraser=o,PaintApp.modes.Bucket=p,PaintApp.modes.Text=q,PaintApp.modes.Stamp=r,PaintApp.modes.Copy=s,PaintApp.modes.Paste=t,PaintApp.collaboration=u,require(["domReady!","sugar-web/datastore","paper-core","mustache","lzstring","humane"],function(b,c,d,e,f,g){PaintApp.libs.mustache=e,PaintApp.libs.humane=g,PaintApp.libs.lzstring=f,a.setup(),initGui(),document.getElementById("stop-button").addEventListener("click",function(b){var c={width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())},d=JSON.stringify(c);a.getDatastoreObject().setDataAsText(d),a.getDatastoreObject().save(function(a){})}),window.top.sugar&&window.top.sugar.environment&&window.top.sugar.environment.sharedId||a.getDatastoreObject().loadAsText(function(a,b,c){if(null!=c){var d=JSON.parse(c);PaintApp.clearCanvas(),img=new Image,img.onload=function(){PaintApp.elements.canvas.getContext("2d").drawImage(img,0,0,d.width,d.height),PaintApp.saveCanvas()},img.src=PaintApp.collaboration.decompress(d.src)}}),window.top&&window.top.sugar&&window.top.sugar.environment&&window.top.sugar.environment.sharedId&&(PaintApp.data.isHost=!1,PaintApp.buttons.undoButton.hideGui(),PaintApp.buttons.redoButton.hideGui(),PaintApp.displayUndoRedoButtons(),PaintApp.collaboration.shareActivity())})});