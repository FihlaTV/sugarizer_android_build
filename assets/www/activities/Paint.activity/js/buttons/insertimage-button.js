/*! Sugarizer 2019-01-12 */
define(["sugar-web/graphics/journalchooser","sugar-web/datastore"],function(a,b){function c(){var a=document.getElementById("insertimage-button");PaintApp.elements.insertImageButton=a,a.addEventListener("click",d)}function d(){a.show(function(a){if(a){new b.DatastoreObject(a.objectId).loadAsText(function(a,b,c){var d=document.createElement("img");d.src=c,d.onload=function(){var a=PaintApp.elements.canvas.getContext("2d"),b=d.width,c=d.height,e=PaintApp.elements.canvas.getBoundingClientRect().width,f=PaintApp.elements.canvas.getBoundingClientRect().height,g=Math.min(e/b,f/c),h=g*b,i=g*c;if(a.clearRect(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),a.drawImage(d,0,0,h,i),PaintApp.saveCanvas(),PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(a){}}})}},{mimetype:"image/png"},{mimetype:"image/jpeg"})}return{initGui:c}});